import{a3 as he,c2 as K,cA as be,cB as fe,a5 as ke,d as W,b8 as ye,fj as xe,fk as Ve,cp as _e,a1 as Ie,fl as Ae,r as b,fm as Re,O as Te,K as p,S as me,V as Se,U as Ce,c as le,o as w,w as g,b as i,c9 as Le,e as k,a8 as ve,a7 as v,u as a,fn as $e,a6 as I,q as E,a2 as q,aN as Be,E as V,cI as Me,F as re,dd as Pe,de as De,fo as Ye,fc as Fe,a9 as Xe,fp as He,fq as je,v as Ke,c6 as qe,c7 as We,fr as Ze,c5 as $,fs as Ge,cb as T,aa as ze,cS as Qe,ft as Ue,cQ as Je,cc as j,cK as ea,t as aa,bS as pe,cf as ta,cd as sa,fu as na,fv as oa,fw as la,e6 as ra,$ as ia,eA as ca}from"./index-BUAqAxXK.js";import{t as de}from"./throttle-DoyiiBsa.js";const Ee=he({urlList:{type:K(Array),default:()=>be([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:K(String)}}),ua={close:()=>!0,switch:c=>fe(c),rotate:c=>fe(c)},da=W({name:"ElImageViewer"}),fa=W({...da,props:Ee,emits:ua,setup(c,{expose:N,emit:f}){var A;const n=c,m={CONTAIN:{name:"contain",icon:ye(Ve)},ORIGINAL:{name:"original",icon:ye(xe)}},{t:B}=_e(),s=Ie("image-viewer"),{nextZIndex:M}=Ae(),O=b(),o=b([]),S=Re(),C=b(!0),y=b(n.initialIndex),h=Te(m.CONTAIN),r=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),P=b((A=n.zIndex)!=null?A:M()),D=p(()=>{const{urlList:t}=n;return t.length<=1}),Z=p(()=>y.value===0),G=p(()=>y.value===n.urlList.length-1),Y=p(()=>n.urlList[y.value]),ie=p(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!n.infinite&&Z.value)]),Q=p(()=>[s.e("btn"),s.e("next"),s.is("disabled",!n.infinite&&G.value)]),F=p(()=>{const{scale:t,deg:d,offsetX:l,offsetY:_,enableTransition:L}=r.value;let z=l/t,x=_/t;const H=d*Math.PI/180,ge=Math.cos(H),we=Math.sin(H);z=z*ge+x*we,x=x*ge-l/t*we;const ue={transform:`scale(${t}) rotate(${d}deg) translate(${z}px, ${x}px)`,transition:L?"transform .3s":""};return h.value.name===m.CONTAIN.name&&(ue.maxWidth=ue.maxHeight="100%"),ue});function R(){U(),f("close")}function ce(){const t=de(l=>{switch(l.code){case T.esc:n.closeOnPressEscape&&R();break;case T.space:se();break;case T.left:ne();break;case T.up:u("zoomIn");break;case T.right:e();break;case T.down:u("zoomOut");break}}),d=de(l=>{const _=l.deltaY||l.deltaX;u(_<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});S.run(()=>{$(document,"keydown",t),$(document,"wheel",d)})}function U(){S.stop()}function J(){C.value=!1}function ee(t){C.value=!1,t.target.alt=B("el.image.error")}function ae(t){if(C.value||t.button!==0||!O.value)return;r.value.enableTransition=!1;const{offsetX:d,offsetY:l}=r.value,_=t.pageX,L=t.pageY,z=de(H=>{r.value={...r.value,offsetX:d+H.pageX-_,offsetY:l+H.pageY-L}}),x=$(document,"mousemove",z);$(document,"mouseup",()=>{x()}),t.preventDefault()}function te(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function se(){if(C.value)return;const t=Ge(m),d=Object.values(m),l=h.value.name,L=(d.findIndex(z=>z.name===l)+1)%t.length;h.value=m[t[L]],te()}function X(t){const d=n.urlList.length;y.value=(t+d)%d}function ne(){Z.value&&!n.infinite||X(y.value-1)}function e(){G.value&&!n.infinite||X(y.value+1)}function u(t,d={}){if(C.value)return;const{minScale:l,maxScale:_}=n,{zoomRate:L,rotateDeg:z,enableTransition:x}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...d};switch(t){case"zoomOut":r.value.scale>l&&(r.value.scale=Number.parseFloat((r.value.scale/L).toFixed(3)));break;case"zoomIn":r.value.scale<_&&(r.value.scale=Number.parseFloat((r.value.scale*L).toFixed(3)));break;case"clockwise":r.value.deg+=z,f("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=z,f("rotate",r.value.deg);break}r.value.enableTransition=x}function oe(t){var d;((d=t.detail)==null?void 0:d.focusReason)==="pointer"&&t.preventDefault()}function Oe(){n.closeOnPressEscape&&R()}return me(Y,()=>{Se(()=>{const t=o.value[0];t!=null&&t.complete||(C.value=!0)})}),me(y,t=>{te(),f("switch",t)}),Ce(()=>{ce()}),N({setActiveItem:X}),(t,d)=>(w(),le(a(Ze),{to:"body",disabled:!t.teleported},{default:g(()=>[i(Le,{name:"viewer-fade",appear:""},{default:g(()=>[k("div",{ref_key:"wrapper",ref:O,tabindex:-1,class:v(a(s).e("wrapper")),style:ve({zIndex:P.value})},[i(a($e),{loop:"",trapped:"","focus-trap-el":O.value,"focus-start-el":"container",onFocusoutPrevented:oe,onReleaseRequested:Oe},{default:g(()=>[k("div",{class:v(a(s).e("mask")),onClick:Be(l=>t.hideOnClickModal&&R(),["self"])},null,10,["onClick"]),I(" CLOSE "),k("span",{class:v([a(s).e("btn"),a(s).e("close")]),onClick:R},[i(a(V),null,{default:g(()=>[i(a(Me))]),_:1})],2),I(" ARROW "),a(D)?I("v-if",!0):(w(),E(re,{key:0},[k("span",{class:v(a(ie)),onClick:ne},[i(a(V),null,{default:g(()=>[i(a(Pe))]),_:1})],2),k("span",{class:v(a(Q)),onClick:e},[i(a(V),null,{default:g(()=>[i(a(De))]),_:1})],2)],64)),I(" ACTIONS "),k("div",{class:v([a(s).e("btn"),a(s).e("actions")])},[k("div",{class:v(a(s).e("actions__inner"))},[i(a(V),{onClick:l=>u("zoomOut")},{default:g(()=>[i(a(Ye))]),_:1},8,["onClick"]),i(a(V),{onClick:l=>u("zoomIn")},{default:g(()=>[i(a(Fe))]),_:1},8,["onClick"]),k("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(V),{onClick:se},{default:g(()=>[(w(),le(Xe(a(h).icon)))]),_:1}),k("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(V),{onClick:l=>u("anticlockwise")},{default:g(()=>[i(a(He))]),_:1},8,["onClick"]),i(a(V),{onClick:l=>u("clockwise")},{default:g(()=>[i(a(je))]),_:1},8,["onClick"])],2)],2),I(" CANVAS "),k("div",{class:v(a(s).e("canvas"))},[(w(!0),E(re,null,Ke(t.urlList,(l,_)=>qe((w(),E("img",{ref_for:!0,ref:L=>o.value[_]=L,key:l,src:l,style:ve(a(F)),class:v(a(s).e("img")),crossorigin:t.crossorigin,onLoad:J,onError:ee,onMousedown:ae},null,46,["src","crossorigin"])),[[We,_===y.value]])),128))],2),q(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ma=ke(fa,[["__file","image-viewer.vue"]]);const Ne=ze(ma),va=he({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:K([String,Object])},previewSrcList:{type:K(Array),default:()=>be([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:K(String)}}),pa={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>fe(c),close:()=>!0,show:()=>!0},ga=W({name:"ElImage",inheritAttrs:!1}),wa=W({...ga,props:va,emits:pa,setup(c,{emit:N}){const f=c;let A="";const{t:n}=_e(),m=Ie("image"),B=Qe(),s=p(()=>Ue(Object.entries(B).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),M=Je({excludeListeners:!0,excludeKeys:p(()=>Object.keys(s.value))}),O=b(),o=b(!1),S=b(!0),C=b(!1),y=b(),h=b(),r=j&&"loading"in HTMLImageElement.prototype;let P,D;const Z=p(()=>[m.e("inner"),Y.value&&m.e("preview"),S.value&&m.is("loading")]),G=p(()=>{const{fit:e}=f;return j&&e?{objectFit:e}:{}}),Y=p(()=>{const{previewSrcList:e}=f;return ea(e)&&e.length>0}),ie=p(()=>{const{previewSrcList:e,initialIndex:u}=f;let oe=u;return u>e.length-1&&(oe=0),oe}),Q=p(()=>f.loading==="eager"?!1:!r&&f.loading==="lazy"||f.lazy),F=()=>{j&&(S.value=!0,o.value=!1,O.value=f.src)};function R(e){S.value=!1,o.value=!1,N("load",e)}function ce(e){S.value=!1,o.value=!0,N("error",e)}function U(){la(y.value,h.value)&&(F(),ae())}const J=oa(U,200,!0);async function ee(){var e;if(!j)return;await Se();const{scrollContainer:u}=f;ta(u)?h.value=u:sa(u)&&u!==""?h.value=(e=document.querySelector(u))!=null?e:void 0:y.value&&(h.value=na(y.value)),h.value&&(P=$(h,"scroll",J),setTimeout(()=>U(),100))}function ae(){!j||!h.value||!J||(P==null||P(),h.value=void 0)}function te(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function se(){Y.value&&(D=$("wheel",te,{passive:!1}),A=document.body.style.overflow,document.body.style.overflow="hidden",C.value=!0,N("show"))}function X(){D==null||D(),document.body.style.overflow=A,C.value=!1,N("close")}function ne(e){N("switch",e)}return me(()=>f.src,()=>{Q.value?(S.value=!0,o.value=!1,ae(),ee()):F()}),Ce(()=>{Q.value?ee():F()}),(e,u)=>(w(),E("div",pe({ref_key:"container",ref:y},a(s),{class:[a(m).b(),e.$attrs.class]}),[o.value?q(e.$slots,"error",{key:0},()=>[k("div",{class:v(a(m).e("error"))},aa(a(n)("el.image.error")),3)]):(w(),E(re,{key:1},[O.value!==void 0?(w(),E("img",pe({key:0},a(M),{src:O.value,loading:e.loading,style:a(G),class:a(Z),crossorigin:e.crossorigin,onClick:se,onLoad:R,onError:ce}),null,16,["src","loading","crossorigin"])):I("v-if",!0),S.value?(w(),E("div",{key:1,class:v(a(m).e("wrapper"))},[q(e.$slots,"placeholder",{},()=>[k("div",{class:v(a(m).e("placeholder"))},null,2)])],2)):I("v-if",!0)],64)),a(Y)?(w(),E(re,{key:2},[C.value?(w(),le(a(Ne),{key:0,"z-index":e.zIndex,"initial-index":a(ie),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:X,onSwitch:ne},{default:g(()=>[e.$slots.viewer?(w(),E("div",{key:0},[q(e.$slots,"viewer")])):I("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):I("v-if",!0)],64)):I("v-if",!0)],16))}});var ya=ke(wa,[["__file","image.vue"]]);const Ia=ze(ya),ha={...Ee,teleported:{type:Boolean,default:!0},modelValue:Boolean,customClass:String,customStyle:Object,transitionName:{type:String,default:"ele-image-viewer-fade"},keepAlive:Boolean},ba={"update:modelValue":c=>!0,close:()=>!0,switch:c=>!0,rotate:c=>!0},Sa=W({name:"EleImageViewer",__name:"index",props:ha,emits:ba,setup(c,{expose:N,emit:f}){const A=c,n=f,m=b(null),B=p(()=>{const o=ra(A,["modelValue","customClass","customStyle","transitionName","keepAlive"]);return o.teleported=!1,o}),s=()=>{n("update:modelValue",!1),n("close")},M=o=>{n("switch",o)},O=o=>{n("rotate",o)};return ia(()=>{s()}),N({imageViewerRef:m}),(o,S)=>(w(),le(ca,{to:"body",disabled:!o.teleported},[i(Le,{name:o.transitionName,appear:!0},{default:g(()=>[o.modelValue?(w(),E("div",{key:0,class:v(["ele-image-viewer",o.customClass]),style:ve(o.customStyle)},[i(a(Ne),pe(B.value,{ref_key:"imageViewerRef",ref:m,onClose:s,onSwitch:M,onRotate:O}),{default:g(()=>[q(o.$slots,"default")]),_:3},16)],6)):I("",!0)]),_:3},8,["name"])],8,["disabled"]))}});export{Ia as E,Sa as _};
