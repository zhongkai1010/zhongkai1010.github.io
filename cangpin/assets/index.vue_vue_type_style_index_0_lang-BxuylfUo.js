import{d as ee,r as w,K as Z,q as L,o as I,e as y,a6 as N,a2 as X,a7 as re,t as Y,aO as J,c as K,w as P,F as me,v as pe,aK as Ie,bU as H,eu as Ge,a8 as be,i as ne,bV as qe,a as Re,O as ot,S as we,L as We,bY as Fe,bZ as Le,u as _,as as Ne,f3 as it,V as Te,b as g,f4 as st,E as ke,f5 as at,f6 as rt,au as Ae,f7 as ct,bS as ut,eh as dt,aw as mt,az as Ke,eg as pt,s as Pe,f8 as ft,f0 as vt,aE as Ve,b3 as gt,aL as Ue,bR as ht,b7 as yt,aF as kt,ba as xe,ay as bt,av as Ye,b0 as he,b1 as _e,b2 as Xe,aD as De,aP as He,aJ as Qe,aS as Ct,bP as xt,cm as It,b9 as wt,aI as Pt,f9 as Mt}from"./index-Cam4GZdG.js";import{_ as St}from"./index-CCjuhjea.js";import{_ as Tt}from"./index-_pVDOVR1.js";import{E as Je}from"./tree-gdPj6LXH.js";import{_ as Vt}from"./index-BR0AXWrc.js";import{_ as Et}from"./index-0hW3V56y.js";import{E as Ze}from"./upload-BBXkbiPG.js";import{E as $t}from"./progress-DFy42Qwb.js";import{u as _t}from"./index-cvVrsbDC.js";import{E as Dt,_ as Ot}from"./index-BZsjeet3.js";import{V as Ft}from"./vuedraggable.umd-DyfeE9Kd.js";import{E as Lt}from"./tree-select-Cy8YOmHx.js";import{u as Rt}from"./message-box-CeYd_SCF.js";const At={class:"ele-file-list-item-icon"},Ut=["src"],Bt=["title"],jt=ee({name:"FileGridItem",__name:"file-grid-item",props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,ctxMenuDropdownVisible:Boolean},emits:{click:e=>!0,checkChange:e=>!0,contextOpen:e=>!0},setup(e,{emit:h}){const t=e,a=h,c=w(null),C=Z(()=>t.selectionType==="checkbox"||t.selectionType==="radio"),k=Z(()=>!C.value||!t.item?!1:t.selectionType==="checkbox"?!!(t.selections&&t.selections.some(o=>o.key===t.item.key)):!!(t.current&&t.current.key===t.item.key)),m=Z(()=>{var o,s,l;if(t.item.thumbnail)return t.item.thumbnail;if(t.icons){if(t.item.isDirectory)return(o=t.icons.find(i=>i.type==="dir"))==null?void 0:o.icon;if(t.item.name){const i=(s=t.icons.find(v=>v.suffixes?!!v.suffixes.find(x=>!!t.item.name.endsWith(x)):!1))==null?void 0:s.icon;if(i)return i}return(l=t.icons.find(i=>i.type==="file"))==null?void 0:l.icon}}),D=()=>{a("click",t.item)},V=()=>{a("checkChange",t.item)},d=o=>{c.value!=null&&a("contextOpen",{item:t.item,triggerEl:c.value,e:o})};return(o,s)=>(I(),L("div",{class:re(["ele-file-list-item",{"is-checked":k.value},{"is-active":e.ctxMenuDropdownVisible}]),onClick:J(D,["stop"])},[y("div",{class:"ele-file-list-item-body",onContextmenu:d},[y("div",At,[X(o.$slots,"icon",{icon:m.value,item:e.item},()=>[y("img",{src:m.value,class:re({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,Ut)])]),X(o.$slots,"title",{item:e.item},()=>[y("div",{title:e.item.name,class:"ele-file-list-item-title"},Y(e.item.name),9,Bt)])],32),C.value?(I(),L("div",{key:0,class:"ele-file-list-item-checkbox",onClick:J(V,["stop"])},s[1]||(s[1]=[y("i",{class:"ele-file-list-checkbox is-checked"},null,-1)]))):N("",!0),y("div",{ref_key:"dropdownTriggerRef",ref:c,class:"ele-file-list-item-dropdown",onClick:s[0]||(s[0]=J(()=>{},["stop"]))},null,512)],2))}}),zt={key:0,class:"ele-file-list-header"},Gt={class:"ele-file-list-body"},qt=ee({name:"FileGrid",__name:"file-grid",props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,checkAllText:String,selectedText:String,ctxMenuDropdownVisible:Boolean,contextMenuFileItem:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextOpen:e=>!0},setup(e,{emit:h}){const t=e,a=h,c=Z(()=>!t.selections||!t.selections.length?t.checkAllText:t.selectedText?t.selectedText.replace(/\{\s*total\s*\}/g,String(t.selections.length)):""),C=()=>{a("checkAllChange")},k=V=>{a("itemClick",V)},m=V=>{a("itemCheckChange",V)},D=V=>{a("itemContextOpen",V)};return(V,d)=>(I(),K(Ge,{class:"ele-file-list"},{default:P(()=>[e.selectionType==="checkbox"?(I(),L("div",zt,[y("div",{class:"ele-file-list-selection",onClick:J(C,["stop"])},[y("i",{class:re(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}])},null,2),y("div",null,Y(c.value),1)])])):N("",!0),y("div",Gt,[(I(!0),L(me,null,pe(e.data,o=>(I(),K(jt,{key:o.key,item:o,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible&&e.contextMenuFileItem===o,onClick:k,onCheckChange:m,onContextOpen:D},Ie({_:2},[pe(Object.keys(V.$slots),s=>({name:s,fn:P(l=>[X(V.$slots,s,H({ref_for:!0},l||{}))])}))]),1032,["item","selectionType","selections","current","icons","ctxMenuDropdownVisible"]))),128))])]),_:3}))}}),Wt={key:0,class:"ele-file-list-item-checkbox"},Nt={class:"ele-file-list-item-name"},Kt={class:"ele-file-list-item-icon"},Yt=["src"],Xt=["title"],Ht={key:0,class:"ele-file-list-item-tools"},Qt=ee({name:"FileTableItem",__name:"file-table-item",props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,columns:Array,ctxMenuDropdownVisible:Boolean},emits:{click:e=>!0,checkChange:e=>!0,contextOpen:e=>!0},setup(e,{emit:h}){const t=e,a=h,c=w(null),C=Z(()=>t.selectionType==="checkbox"||t.selectionType==="radio"),k=Z(()=>!C.value||!t.item?!1:t.selectionType==="checkbox"?!!(t.selections&&t.selections.some(o=>o.key===t.item.key)):!!(t.current&&t.current.key===t.item.key)),m=Z(()=>{var o,s,l;if(t.item.thumbnail)return t.item.thumbnail;if(t.icons){if(t.item.isDirectory)return(o=t.icons.find(i=>i.type==="dir"))==null?void 0:o.icon;if(t.item.name){const i=(s=t.icons.find(v=>v.suffixes?!!v.suffixes.find(x=>!!t.item.name.endsWith(x)):!1))==null?void 0:s.icon;if(i)return i}return(l=t.icons.find(i=>i.type==="file"))==null?void 0:l.icon}}),D=()=>{a("click",t.item)},V=()=>{a("checkChange",t.item)},d=o=>{c.value!=null&&a("contextOpen",{item:t.item,triggerEl:c.value,e:o})};return(o,s)=>(I(),L("div",{class:re(["ele-file-list-item",{"is-checked":k.value},{"is-active":e.ctxMenuDropdownVisible}]),onClick:J(D,["stop"])},[y("div",{class:"ele-file-list-item-body",onContextmenu:d},[C.value?(I(),L("div",Wt,[y("i",{class:re(["ele-file-list-checkbox",{"is-radio":e.selectionType==="radio"},{"is-checked":k.value}]),onClick:J(V,["stop"])},null,2)])):N("",!0),y("div",Nt,[y("div",Kt,[X(o.$slots,"icon",{icon:m.value,item:e.item},()=>[y("img",{src:m.value,class:re({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,Yt)]),X(o.$slots,"title",{item:e.item},()=>[y("div",{title:e.item.name,class:"ele-file-list-item-title"},Y(e.item.name),9,Xt)])]),o.$slots.tool?(I(),L("div",Ht,[X(o.$slots,"tool",{item:e.item})])):N("",!0)]),(I(!0),L(me,null,pe(e.columns,l=>(I(),L("div",{key:l.prop,style:be(l.style),class:"ele-file-list-item-cell"},[l.slot&&!["icon","title","tool","contextMenu"].includes(l.slot)&&o.$slots[l.slot]?X(o.$slots,l.slot,{key:0,item:e.item,col:l}):e.item&&l&&l.prop?(I(),L(me,{key:1},[ne(Y(e.item[l.prop]),1)],64)):N("",!0)],4))),128))],32),y("div",{ref_key:"dropdownTriggerRef",ref:c,class:"ele-file-list-item-dropdown",onClick:s[0]||(s[0]=J(()=>{},["stop"]))},null,512)],2))}}),ze=ee({name:"FileSort",__name:"file-sort",props:{sort:String,order:String,name:{type:String,required:!0}},setup(e){return(h,t)=>(I(),L("i",{class:re(["ele-file-list-item-sort",{"is-asc":e.name===e.sort&&e.order==="asc"},{"is-desc":e.name===e.sort&&e.order==="desc"}])},null,2))}}),Jt={class:"ele-file-list-header"},Zt={class:"ele-file-list-item"},el={class:"ele-file-list-item-body"},tl={key:0,class:"ele-file-list-item-checkbox"},ll=["onClick"],nl={class:"ele-file-list-body"},ol=ee({name:"FileTable",__name:"file-table",props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,nameText:String,sizeText:String,timeText:String,sortable:Boolean,sort:String,order:String,columns:Array,ctxMenuDropdownVisible:Boolean,contextMenuFileItem:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextOpen:e=>!0,sortChange:e=>!0},setup(e,{emit:h}){const t=e,a=h,c=Z(()=>t.columns?t.columns:[{title:t.sizeText,prop:"length",style:{width:"120px",flexShrink:0},sortable:t.sortable},{title:t.timeText,prop:"updateTime",style:{width:"180px",flexShrink:0},sortable:t.sortable}]),C=()=>{a("checkAllChange")},k=d=>{a("itemClick",d)},m=d=>{a("itemCheckChange",d)},D=(d,o)=>{o?o.sortable&&a("sortChange",d):t.sortable&&a("sortChange",d)},V=d=>{a("itemContextOpen",d)};return(d,o)=>(I(),K(Ge,{class:"ele-file-list-table"},{default:P(()=>[y("div",Jt,[y("div",Zt,[y("div",el,[e.selectionType==="checkbox"||e.selectionType==="radio"?(I(),L("div",tl,[e.selectionType==="checkbox"?(I(),L("i",{key:0,class:re(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}]),onClick:J(C,["stop"])},null,2)):N("",!0)])):N("",!0),y("div",{class:re(["ele-file-list-item-name",{"is-sortable":e.sortable}]),onClick:o[0]||(o[0]=s=>D("name"))},[y("span",null,Y(e.nameText),1),e.sortable?(I(),K(ze,{key:0,sort:e.sort,order:e.order,name:"name"},null,8,["sort","order"])):N("",!0)],2),(I(!0),L(me,null,pe(c.value,s=>(I(),L("div",{key:s.prop,style:be(s.headerStyle||s.style),class:re(["ele-file-list-item-cell",{"is-sortable":s.sortable}]),onClick:l=>D(s.prop,s)},[y("span",null,[s.headerSlot&&!["icon","title","tool","contextMenu"].includes(s.headerSlot)&&d.$slots[s.headerSlot]?X(d.$slots,s.headerSlot,{key:0,col:s}):(I(),L(me,{key:1},[ne(Y(s.title),1)],64))]),s.sortable?(I(),K(ze,{key:0,sort:e.sort,order:e.order,name:s.prop},null,8,["sort","order","name"])):N("",!0)],14,ll))),128))])])]),y("div",nl,[(I(!0),L(me,null,pe(e.data,s=>(I(),K(Qt,{key:s.key,item:s,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,columns:c.value,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible&&e.contextMenuFileItem===s,onClick:k,onCheckChange:m,onContextOpen:V},Ie({_:2},[pe(Object.keys(d.$slots),l=>({name:l,fn:P(i=>[X(d.$slots,l,H({ref_for:!0},i||{}))])}))]),1032,["item","selectionType","selections","current","icons","columns","ctxMenuDropdownVisible"]))),128))])]),_:3}))}}),Be=[{icon:"/ele-file-list/ic_file_misc_sm.png",type:"file"},{icon:"/ele-file-list/ic_file_folder_sm.png",type:"dir"},{icon:"/ele-file-list/ic_file_code_sm.png",suffixes:[".java",".js",".css",".vue",".ts",".tsx",".scss",".less",".c",".cpp",".cs",".jsp",".php",".asp",".py",".go",".kt",".lua"]},{icon:"/ele-file-list/ic_file_htm_sm.png",suffixes:[".html",".htm"]},{icon:"/ele-file-list/ic_file_text_sm.png",suffixes:[".txt"]},{icon:"/ele-file-list/ic_file_pdf_sm.png",suffixes:[".pdf"]},{icon:"/ele-file-list/ic_file_word_sm.png",suffixes:[".doc",".docx"]},{icon:"/ele-file-list/ic_file_excel_sm.png",suffixes:[".xls",".xlsx"]},{icon:"/ele-file-list/ic_file_ppt_sm.png",suffixes:[".ppt",".pptx"]},{icon:"/ele-file-list/ic_file_visio_sm.png",suffixes:[".vsd"]},{icon:"/ele-file-list/ic_file_ps_sm.png",suffixes:[".psd"]},{icon:"/ele-file-list/ic_file_cad_sm.png",suffixes:[".dwg"]},{icon:"/ele-file-list/ic_file_flash_sm.png",suffixes:[".swf"]},{icon:"/ele-file-list/ic_file_music_sm.png",suffixes:[".mp3",".wav"]},{icon:"/ele-file-list/ic_file_video_sm.png",suffixes:[".mp4",".rmvb",".flv",".avi",".3gp"]},{icon:"/ele-file-list/ic_file_picture_sm.png",suffixes:[".png",".jpg",".jpeg",".gif",".bmp"]},{icon:"/ele-file-list/ic_file_fonts_sm.png",suffixes:[".ttf",".woff"]},{icon:"/ele-file-list/ic_file_bt_sm.png",suffixes:[".torrent"]},{icon:"/ele-file-list/ic_file_android_sm.png",suffixes:[".apk"]},{icon:"/ele-file-list/ic_file_exe_sm.png",suffixes:[".exe"]},{icon:"/ele-file-list/ic_file_ipa_sm.png",suffixes:[".ipa",".dmg"]},{icon:"/ele-file-list/ic_file_zip_sm.png",suffixes:[".zip",".rar",".7z"]}],il=Be.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),sl=Be.map(e=>({...e,icon:e.icon.replace("/ele-file-list/","https://cdn.eleadmin.com/20200609/")})),al=sl.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),rl={data:{type:Array,required:!0},selectionType:String,selections:Array,current:Object,grid:{type:Boolean,default:!0},sortable:Boolean,sort:String,order:String,icons:{type:Array,default:()=>al},smallIcons:Array,columns:Array,boxChoose:Boolean,contextMenus:[Array,Function],contextMenuProps:Object,locale:Object},cl={itemClick:e=>!0,sortChange:e=>!0,"update:selections":e=>!0,"update:current":e=>!0,itemContextMenu:e=>!0,itemContextOpen:(e,h)=>!0},ul=".ele-file-list-body>.ele-file-list-item",dl=ee({name:"EleFileList",__name:"index",props:rl,emits:cl,setup(e,{emit:h}){const t=e,a=h,{lang:c}=qe("fileList",t),C=Re({top:"0px",left:"0px",width:"0px",height:"0px",display:"none"}),k=w(null),m=ot([]),D=w(),V=w(!1),d=w(null),o=Z(()=>!!(t.data&&t.data.length&&t.selections&&t.selections.length&&!t.data.some(u=>{var n,p;return!((p=(n=t.selections)==null?void 0:n.some)!=null&&p.call(n,O=>u.key===O.key))}))),s=Z(()=>!!(!o.value&&t.selections&&t.selections.length)),l=u=>{a("update:selections",u)},i=u=>{a("update:current",u)},v=()=>{if(t.selectionType!=="checkbox")return;if(o.value||t.data==null||!t.data.length){if(!t.selections){l([]);return}const n=t.selections.filter(p=>t.data?!t.data.some(O=>O.key===p.key):!0);l(n);return}if(!t.selections){l([...t.data]);return}const u=t.selections.concat(t.data.filter(n=>t.selections?!t.selections.some(p=>p.key===n.key):!0));l(u)},x=u=>{if(t.selectionType==="radio"){i(t.current&&t.current.key===u.key?null:u);return}if(t.selectionType==="checkbox"){if(!t.selections||!t.selections.length){l([u]);return}if(!t.selections.some(n=>n.key===u.key)){l(t.selections.concat([u]));return}l(t.selections.filter(n=>n.key!==u.key))}},T=u=>{a("itemClick",u)},R=u=>{const n={sort:u};t.order&&u===t.sort?n.order=t.order==="asc"?"desc":null:n.order="asc",a("sortChange",n)},B=u=>{if(d.value!=null){const n={key:u,item:d.value};a("itemContextMenu",n)}},j=u=>{V.value=u,u&&k.value!=null&&d.value!=null&&a("itemContextOpen",k.value,d.value)},z=u=>typeof t.contextMenus=="function"?t.contextMenus(u):t.contextMenus,ce=()=>{k.value&&k.value.handleClose()},oe=(u,n)=>{d.value!=null&&d.value===u||(ce(),Te(()=>{d.value=u,m.value=z(u)||[],D.value=n,m.value.length&&Te(()=>{k.value&&k.value.handleOpen()})}))},te=u=>{if(t.contextMenus!=null){if(u.e.preventDefault(),u.e.stopPropagation(),D.value!==u.triggerEl){oe(u.item,u.triggerEl);return}m.value.length&&k.value&&k.value.handleOpen()}},fe=u=>{if(!t.boxChoose||t.selectionType!=="checkbox")return;const n=u.clientX,p=u.clientY,O=u.currentTarget,A=O.getBoundingClientRect(),q=Array.from(O.querySelectorAll(ul)),ve=it(le=>{const ue=Math.max(le.clientX,A.left),Q=Math.max(le.clientY,A.top),r=Math.min(ue,n)-A.left,f=Math.min(Q,p)-A.top,M=Math.min(Math.abs(ue-n),O.clientWidth-r),S=Math.min(Math.abs(Q-p),O.clientHeight-f);if(C.left=r+"px",C.top=f+"px",C.width=M+"px",C.height=S+"px",C.display="block",M<6||S<6){q.forEach(E=>{E.classList.remove("is-active")});return}u.stopPropagation(),u.preventDefault(),le.stopPropagation(),le.preventDefault(),q.forEach(E=>{const U=E.offsetLeft+E.clientWidth,$=E.offsetTop+E.clientHeight;U>r&&$>f&&E.offsetLeft<r+M&&E.offsetTop<f+S?E.classList.add("is-active"):E.classList.remove("is-active")})},60),ge=le=>{C.display="none";const ue=Math.max(le.clientX,A.left),Q=Math.max(le.clientY,A.top),r=Math.min(ue,n)-A.left,f=Math.min(Q,p)-A.top,M=Math.min(Math.abs(ue-n),O.clientWidth-r),S=Math.min(Math.abs(Q-p),O.clientHeight-f);if(M>6&&S>6){const E=[];q.forEach((U,$)=>{U.classList.contains("is-active")&&(U.classList.remove("is-active"),t.data&&t.data[$]&&E.push(t.data[$]))}),E.length&&l(E)}document.removeEventListener("mousemove",ve),document.removeEventListener("mouseup",ge)};document.addEventListener("mousemove",ve),document.addEventListener("mouseup",ge)};return we([()=>t.grid,()=>t.data],()=>{ce(),D.value=null,d.value=null},{deep:!0}),We(()=>{d.value=null}),(u,n)=>(I(),L("div",{class:"ele-file-list-group",onMousedown:fe},[u.grid?(I(),K(qt,{key:0,data:u.data,icons:u.icons,selectionType:u.selectionType,selections:u.selections,current:u.current,isCheckAll:o.value,isIndeterminate:s.value,checkAllText:_(c).selectAll,selectedText:_(c).selectTips,ctxMenuDropdownVisible:V.value,contextMenuFileItem:d.value,onCheckAllChange:v,onItemClick:T,onItemCheckChange:x,onItemContextOpen:te},Ie({_:2},[pe(Object.keys(u.$slots),p=>({name:p,fn:P(O=>[X(u.$slots,p,Fe(Le(O||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","checkAllText","selectedText","ctxMenuDropdownVisible","contextMenuFileItem"])):(I(),K(ol,{key:1,data:u.data,icons:u.icons,selectionType:u.selectionType,selections:u.selections,current:u.current,isCheckAll:o.value,isIndeterminate:s.value,nameText:_(c).fileName,sizeText:_(c).fileSize,timeText:_(c).fileTimestamp,sortable:u.sortable,sort:u.sort,order:u.order,columns:u.columns,ctxMenuDropdownVisible:V.value,contextMenuFileItem:d.value,onCheckAllChange:v,onItemClick:T,onItemCheckChange:x,onItemContextOpen:te,onSortChange:R},Ie({_:2},[pe(Object.keys(u.$slots),p=>({name:p,fn:P(O=>[X(u.$slots,p,Fe(Le(O||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","nameText","sizeText","timeText","sortable","sort","order","columns","ctxMenuDropdownVisible","contextMenuFileItem"])),y("div",{class:"ele-file-list-selector",style:be(C)},null,4),u.contextMenus?(I(),K(Ne,H({key:2,persistent:!1,placement:"bottom-start",popperClass:"ele-file-list-item-context",validateEvent:!1},u.contextMenuProps||{},{ref_key:"ctxMenuDropdownRef",ref:k,componentType:"pro",preventContextmenu:!0,trigger:"click",virtualTriggering:!0,virtualRef:D.value,disabled:!m.value.length,items:m.value,onCommand:B,onVisibleChange:j}),null,16,["virtualRef","disabled","items"])):N("",!0)],32))}}),ml=["title"],pl={key:0,class:"ele-upload-thumbnail"},fl={class:"ele-upload-thumbnail-text"},vl={key:0,class:"ele-upload-progress"},gl={class:"ele-upload-text"},hl=["title"],yl={class:"ele-upload-tool-text"},kl={key:1,class:"ele-upload-tools"},bl=["title"],Cl={class:"ele-upload-tool-text"},xl=["title"],Il={class:"ele-upload-tool-text"},wl=["title"],Pl={key:3,class:"ele-upload-handle"},Ml=ee({name:"ListItem",__name:"list-item",props:{item:{type:Object,required:!0},readonly:Boolean,disabled:Boolean,sortable:Boolean,imageProps:Object,progressProps:Object,imageObjectUrls:Array,tools:Boolean,listType:String,locale:{type:Object,required:!0}},emits:{itemClick:e=>!0,remove:e=>!0,edit:e=>!0,preview:e=>!0,retry:e=>!0},setup(e,{emit:h}){const t=e,a=h,c=Z(()=>{var o;if(t.item.thumbnail&&t.item.thumbnail!==!0)return t.item.thumbnail;if(t.item.url)return t.item.url;if(!(!t.item.file||!t.imageObjectUrls))return(o=t.imageObjectUrls.find(s=>s.file===t.item.file))==null?void 0:o.url}),C=Z(()=>{const o=t.item.progress;return!o||o<0?0:o>100?100:o}),k=()=>{a("itemClick",t.item)},m=()=>{a("remove",t.item)},D=()=>{a("edit",t.item)},V=()=>{a("preview",t.item)},d=()=>{a("retry",t.item)};return(o,s)=>(I(),L("div",{title:e.item.name,class:"ele-upload-item",onClick:k},[X(o.$slots,"thumbnail",{item:e.item,imageUrl:c.value},()=>[e.listType==="file"||e.item.thumbnail===!1||!c.value?(I(),L("div",pl,[g(_(ke),{class:"ele-upload-thumbnail-icon"},{default:P(()=>[g(_(st))]),_:1}),y("div",fl,Y(e.item.name||e.item.url),1)])):(I(),K(_(Dt),H({key:1,fit:"contain",class:"ele-upload-image"},e.imageProps||{},{src:c.value}),null,16,["src"]))]),e.item.status==="uploading"||e.item.status==="exception"?(I(),L("div",vl,[X(o.$slots,"progress",{item:e.item},()=>[y("div",gl,Y(e.item.status=="exception"?e.locale.exception:e.locale.uploading),1),g(_($t),H({showText:!1,strokeWidth:e.listType==="file"?2:void 0,status:e.item.status==="exception"?"exception":void 0,class:"ele-upload-progress-bar"},e.progressProps||{},{percentage:C.value}),null,16,["strokeWidth","status","percentage"]),!e.disabled&&e.item.status==="exception"?(I(),L("div",{key:0,title:e.locale.retry,class:"ele-upload-tool ele-upload-retry",onClick:J(d,["stop"])},[g(_(ke),{class:"ele-upload-tool-icon"},{default:P(()=>[g(_(at))]),_:1}),y("div",yl,Y(e.locale.retry),1)],8,hl)):N("",!0)])])):e.tools&&!e.readonly&&!e.disabled&&!e.item.readonly?(I(),L("div",kl,[y("div",{title:e.locale.preview,class:"ele-upload-tool",onClick:J(V,["stop"])},[g(_(ke),{class:"ele-upload-tool-icon"},{default:P(()=>[g(_(rt))]),_:1}),y("div",Cl,Y(e.locale.preview),1)],8,bl),y("div",{title:e.locale.edit,class:"ele-upload-tool",onClick:J(D,["stop"])},[g(_(ke),{class:"ele-upload-tool-icon"},{default:P(()=>[g(_(Ae))]),_:1}),y("div",Il,Y(e.locale.edit),1)],8,xl)])):N("",!0),!e.readonly&&!e.disabled&&!e.item.readonly?(I(),L("div",{key:2,title:e.locale.remove,class:"ele-upload-tool ele-upload-remove",onClick:J(m,["stop"])},[X(o.$slots,"remove",{item:e.item},()=>[g(_(ke),{class:"ele-upload-tool-icon"},{default:P(()=>[g(_(ct))]),_:1})])],8,wl)):N("",!0),e.sortable?(I(),L("div",Pl)):N("",!0)],8,ml))}}),Sl={modelValue:Array,readonly:Boolean,disabled:Boolean,preview:{type:Boolean,default:!0},limit:Number,multiple:Boolean,drag:Boolean,accept:{type:String,default:"image/png,image/jpeg"},itemStyle:[Object,Boolean],buttonStyle:{type:[Object,Boolean],default:null},sortable:{type:[Boolean,Object],default:!0},imageProps:Object,progressProps:Object,previewProps:Object,tools:Boolean,listType:String,beforeUploadClick:Function,beforeItemEdit:Function,beforePreview:Function,locale:Object},Tl={"update:modelValue":e=>!0,itemClick:e=>!0,upload:e=>!0,remove:e=>!0,retry:e=>!0,editUpload:e=>!0,preview:e=>!0},Vl={class:"ele-upload-hidden"},El=["accept"],$l=ee({name:"EleUploadList",__name:"index",props:Sl,emits:Tl,setup(e,{expose:h,emit:t}){const a=["default","icon"],c=e,C=t,{lang:k}=qe("upload",c),m=w(!1),D=w([]),V=w(0),d=w([]),o=w(null);let s=null;const l=Z(()=>!c.readonly&&!(typeof c.limit=="number"&&c.limit>0&&c.modelValue!=null&&c.modelValue.length>=c.limit)),i=n=>({key:"ele"+dt(16,10)+String(Date.now()),name:n.name,status:void 0,progress:0,file:n}),v=(n,p)=>{if(n&&n.url)return n.url;const O=n==null?void 0:n.file;if(O!=null&&O.type.startsWith("image")){const A=d.value.find(ve=>ve.file===O);if(A!=null)return A.url;const q=URL.createObjectURL(O);return d.value.push({file:O,url:q}),q}},x=n=>{if(!(c.beforePreview&&c.beforePreview(n)===!1)&&c.modelValue!=null){const p=[];c.modelValue.forEach(A=>{const q=v(A);q&&A.thumbnail!==!1&&p.push({item:A,url:q})});const O=p.findIndex(A=>A.item.key===n.key);if(O!==-1){const A=p.map(q=>q.url);T(A,O)}}},T=(n,p)=>{D.value=n,V.value=p,m.value=!0},R=n=>{C("update:modelValue",n)},B=n=>{if(l.value&&!c.disabled){const p=i(n);C("upload",p)}return!1},j=n=>{c.preview&&x(n),C("itemClick",n)},z=n=>{C("remove",n)},ce=n=>{if(c.beforeItemEdit&&c.beforeItemEdit(n)===!1)return;const p=o.value;p!=null&&(s=n,p.value="",p&&p.click())},oe=n=>{x(n),C("preview",n)},te=n=>{C("retry",n)},fe=n=>{var p;const O=(p=n.target.files)==null?void 0:p[0];if(O!=null&&s!=null){const A={item:s,newItem:i(O)};s=null,C("editUpload",A)}},u=n=>{c.beforeUploadClick&&c.beforeUploadClick(n)===!1&&(n.stopPropagation(),n.preventDefault())};return we(()=>c.modelValue,()=>{c.modelValue!=null&&c.modelValue.forEach(n=>{v(n)})},{immediate:!0,deep:!0}),We(()=>{d.value.forEach(n=>{URL.revokeObjectURL(n.url)}),d.value=[]}),h({openImagePreview:T}),(n,p)=>(I(),K(_(Ft),H({itemKey:"key",animation:300,setData:()=>{},handle:".ele-upload-handle",class:["ele-upload-list",{"is-file-list":n.listType==="file"},{"is-disabled":n.disabled}]},!n.sortable||n.sortable===!0?{}:n.sortable,{modelValue:n.modelValue||[],"onUpdate:modelValue":R}),{item:P(({element:O})=>[g(Ml,{item:O,readonly:n.readonly,disabled:n.disabled,sortable:n.sortable&&!n.readonly&&!n.disabled&&n.limit!==1,imageProps:n.imageProps,progressProps:n.progressProps,imageObjectUrls:d.value,tools:n.tools,listType:n.listType,locale:_(k),style:be(n.itemStyle),onItemClick:j,onRemove:z,onEdit:ce,onPreview:oe,onRetry:te},Ie({_:2},[pe(Object.keys(n.$slots).filter(A=>!a.includes(A)),A=>({name:A,fn:P(q=>[X(n.$slots,A,Fe(Le(q||{})))])}))]),1032,["item","readonly","disabled","sortable","imageProps","progressProps","imageObjectUrls","tools","listType","locale","style"])]),footer:P(()=>[l.value&&n.buttonStyle!==!1?(I(),L("div",{key:0,style:be(typeof n.buttonStyle=="boolean"?void 0:n.buttonStyle),class:"ele-upload-item ele-upload-button"},[g(_(Ze),{action:"",drag:n.drag,accept:n.accept,multiple:n.multiple,disabled:n.disabled,showFileList:!1,beforeUpload:B},{default:P(()=>[y("div",{class:"ele-upload-button-inner",onClick:u},[X(n.$slots,"icon",{},()=>[g(_(ke),{class:"ele-upload-icon"},{default:P(()=>[g(_(ut))]),_:1})])])]),_:3},8,["drag","accept","multiple","disabled"])],4)):N("",!0),y("div",Vl,[n.tools?(I(),L("input",{key:0,ref_key:"uploadInputRef",ref:o,type:"file",accept:n.accept,class:"ele-upload-input",onChange:fe},null,40,El)):N("",!0),g(Ot,H({infinite:!1},n.previewProps||{},{modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=O=>m.value=O),urlList:D.value,initialIndex:V.value}),null,16,["modelValue","urlList","initialIndex"])])]),_:3},16,["class","modelValue"]))}}),$e="/cangpin/ele-file-list/ic_file_folder.png",_l=["title"],Dl=ee({__name:"file-group",props:{groupData:{}},emits:["groupSelect","addBtnClick","moreIconClick","hideGroupCtxMenu"],setup(e,{expose:h,emit:t}){const a=t,c=w(null),C=d=>{a("groupSelect",d,!0)},k=()=>{a("addBtnClick")},m=(d,o)=>{a("moreIconClick",d.currentTarget,o)},D=(d,o)=>{var l,i;if(o.id===0||o.id===-1){a("hideGroupCtxMenu");return}const s=(i=(l=pt(d.currentTarget,"el-tree-node__content"))==null?void 0:l.querySelector)==null?void 0:i.call(l,".file-picker-tree-more");s&&s.click()};return h({setSelectedGroup:d=>{var o,s;(s=(o=c.value)==null?void 0:o.setCurrentKey)==null||s.call(o,d.id)}}),(d,o)=>{const s=ke,l=Je,i=Ke;return I(),L(me,null,[g(l,{ref_key:"treeRef",ref:c,data:d.groupData,highlightCurrent:!0,nodeKey:"id",props:{label:"name"},expandOnClickNode:!1,defaultExpandAll:!0,class:"file-picker-left",onNodeClick:C,onNodeContextmenu:D},{default:P(v=>[o[0]||(o[0]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1)),y("span",{class:"el-tree-node__label",title:v.data.name},Y(v.data.name),9,_l),v.data.id!==0&&v.data.id!==-1?(I(),K(s,{key:0,class:"file-picker-tree-more",onClick:J(x=>m(x,v.data),["stop"])},{default:P(()=>[g(_(mt),{style:{transform:"scale(1.1)"}})]),_:2},1032,["onClick"])):N("",!0)]),_:1},8,["data"]),g(i,{type:"primary",underline:!1,class:"file-picker-left-add",onClick:k},{default:P(()=>o[1]||(o[1]=[ne(" 添加分组 ")])),_:1})],64)}}});async function Ol(e){const h=await Pe.get("/system/user-file/page",{params:e});return h.data.code===0?h.data.data:Promise.reject(new Error(h.data.message))}async function Fl(e){const h=await Pe.get("/system/user-file",{params:e});return h.data.code===0&&h.data.data?h.data.data:Promise.reject(new Error(h.data.message))}async function et(e){const h=await Pe.post("/system/user-file",e);return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}async function tt(e){const h=await Pe.put("/system/user-file",e);return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}async function Ll(e){const h=await Pe.delete("/system/user-file/"+e);return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}async function dn(e){const h=await Pe.delete("/system/user-file/batch",{data:e});return h.data.code===0?h.data.message:Promise.reject(new Error(h.data.message))}const Rl={class:"file-picker-right"},Al={class:"file-picker-right-header"},Ul={class:"file-picker-right-title"},Bl={key:1},jl=ee({__name:"file-selections",props:{fileSelections:{},limit:{},selectionListProps:{},baseIndex:{}},emits:["clearSelections","removeItem"],setup(e,{expose:h,emit:t}){const a=e,c=t,{mobileDevice:C}=ft(),k=w(null),m=w([]),D=Re({zIndex:a.baseIndex}),V=l=>{const i=a.fileSelections.find(v=>v.key===l.key);i&&c("removeItem",i)},d=()=>{c("clearSelections")},o=()=>{const l=[];return m.value.forEach(i=>{const v=a.fileSelections.find(x=>x.key===i.key);v&&l.push(v)}),l},s=(l,i)=>{k.value&&k.value.openImagePreview(l,i)};return we(()=>a.fileSelections,l=>{if(!l||!l.length){m.value.length&&(m.value=[]);return}const i=m.value.filter(v=>l.some(x=>x.key===v.key));l.forEach(v=>{i.some(x=>x.key===v.key)||i.push({key:v.key,name:v.name,url:v.thumbnail,status:"done"})}),vt(m.value.map(v=>v.key),i.map(v=>v.key),!0)&&(m.value=i)},{immediate:!0,deep:!0}),we(()=>a.baseIndex,l=>{D.zIndex=l}),h({getSelections:o,openImagePreview:s}),(l,i)=>{const v=Ke,x=$l;return I(),L("div",Rl,[y("div",Al,[y("div",Ul,[i[2]||(i[2]=y("span",null,"已选择 ",-1)),y("span",null,Y(l.fileSelections.length),1),l.limit?(I(),L(me,{key:0},[i[1]||(i[1]=y("span",null," / ",-1)),y("span",null,Y(l.limit),1)],64)):(I(),L("span",Bl," 个"))]),g(v,{type:"danger",underline:!1,class:"file-picker-right-clear",onClick:d},{default:P(()=>i[3]||(i[3]=[ne(" 清空 ")])),_:1})]),g(x,H({limit:l.limit,previewProps:D},l.selectionListProps||{},{ref_key:"uploadListRef",ref:k,modelValue:m.value,"onUpdate:modelValue":i[0]||(i[0]=T=>m.value=T),buttonStyle:!1,sortable:!_(C),onRemove:V}),null,16,["limit","previewProps","modelValue","sortable"])])}}}),zl={class:"file-picker-main"},Gl={class:"file-picker-body"},ql={class:"file-picker-toolbar"},Wl={class:"file-picker-search"},Nl=ee({__name:"file-list",props:{limit:{},fileLimit:{},accept:{},params:{},fileListProps:{},selectionListProps:{},emptyProps:{},paginationProps:{},baseIndex:{},messageIns:{}},emits:["queryStart","queryDone","renameFile","moveFile","removeFile","fileItemContextOpen"],setup(e,{expose:h,emit:t}){const a=e,c=t,C=w(),k=w([]),m=w([]),D=w(),V=w(1),d=w(""),o=w(1),s=w(24),l=w(0),i=w(!1),v=[{icon:ht,value:0,iconStyle:{transform:"scale(0.9)"}},{icon:yt,value:1}],x=w(),T=Re({menuStyle:{minWidth:"120px"},iconProps:{size:15},popperOptions:{strategy:"fixed"},zIndex:a.baseIndex}),R=(r,f)=>{var M,S;if(a.limit&&a.limit>1&&(f?r.length>=a.limit:r.length>a.limit))return(S=(M=a.messageIns)==null?void 0:M.error)==null||S.call(M,`最多只能选择 ${a.limit} 个`),!1},B=r=>{if(R(r)!==!1){m.value=r;return}a.limit&&a.limit>1&&(m.value=r.slice(0,a.limit))},j=()=>{m.value=[],D.value=void 0},z=()=>x.value?(x.value.getSelections()||[]).map(f=>f.userFile):[],ce=r=>{if(a.limit===1){j();return}const f=m.value.findIndex(M=>M.key===r.key);f!==-1&&m.value.splice(f,1)},oe=()=>{Q({page:1})},te=r=>{o.value!==r&&(o.value=r,Q())},fe=r=>{if(s.value!==r){o.value=1,s.value=r;const f=Math.ceil(l.value/r);f&&o.value>f&&(o.value=f),Q()}},u=r=>{if(a.limit===1){D.value=r;return}const f=m.value.findIndex(M=>M.key===r.key);if(f!==-1){m.value.splice(f,1);return}R(m.value,!0)!==!1&&m.value.push(r)},n=r=>{const{key:f,item:M}=r,S=M.userFile;if(f==="preview"){if(!M.thumbnail){window.open(M.url);return}const E=k.value.filter(W=>!!W.thumbnail),U=E.map(W=>W.url),$=E.indexOf(M);$!==-1&&x.value&&x.value.openImagePreview(U,$)}else f==="rename"?c("renameFile",S,!0):f==="move"?c("moveFile",S,!0):f==="remove"&&c("removeFile",S,!0)},p=r=>{const f=[{title:"重命名",command:"rename",icon:xe(Ae)},{title:"移动到",command:"move",icon:xe(bt)},{title:"删除",command:"remove",icon:xe(Ye),divided:!0,danger:!0}];return r.thumbnail?(f[0].divided=!0,f.unshift({title:"预览",command:"preview"})):(f[0].divided=!0,f.unshift({title:"打开",command:"preview"})),f},O=()=>{c("fileItemContextOpen")},A=r=>{var f,M,S,E,U,$;if(r){if(a.accept==="image/*"){if(!r.type.startsWith("image")){(M=(f=a.messageIns)==null?void 0:f.error)==null||M.call(f,"只能选择图片");return}}else if(a.accept===".xls,.xlsx"&&!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(r.type)){(E=(S=a.messageIns)==null?void 0:S.error)==null||E.call(S,"只能选择 excel 文件");return}if(a.fileLimit&&r.size/1024/1024>a.fileLimit){($=(U=a.messageIns)==null?void 0:U.error)==null||$.call(U,`大小不能超过 ${a.fileLimit}MB`);return}return!0}},q=r=>{var f,M;if(A(r)){const S=(M=(f=a.messageIns)==null?void 0:f.loading)==null?void 0:M.call(f,{message:"上传中..",plain:!0,mask:!0});_t(r).then(E=>{et({name:E.name,isDirectory:0,parentId:C.value,path:E.path,length:E.length,contentType:E.contentType}).then(()=>{var U,$,W;(U=S==null?void 0:S.close)==null||U.call(S),(W=($=a.messageIns)==null?void 0:$.success)==null||W.call($,"上传成功"),Q()}).catch(U=>{var $,W,Ce;($=S==null?void 0:S.close)==null||$.call(S),(Ce=(W=a.messageIns)==null?void 0:W.error)==null||Ce.call(W,U.message)})}).catch(E=>{var U,$,W;(U=S==null?void 0:S.close)==null||U.call(S),(W=($=a.messageIns)==null?void 0:$.error)==null||W.call($,E.message)})}return!1},ve=r=>{const M=r.currentTarget.scrollTop;i.value=M>1},ge=()=>{c("queryDone")},le=r=>typeof r.contentType=="string"&&r.contentType.startsWith("image/")&&r.url,ue=r=>r==null?"-":r<1024?r+"B":r<1024*1024?(r/1024).toFixed(1)+"KB":r<1024*1024*1024?(r/1024/1024).toFixed(1)+"M":(r/1024/1024/1024).toFixed(1)+"G",Q=r=>{c("queryStart"),r&&(r.page!=null&&(o.value=r.page),r.parentId!=null&&(C.value=r.parentId),r.name!=null&&(d.value=r.name));const f=C.value;Ol({page:o.value,limit:s.value,parentId:f===-1?void 0:f,name:d.value,isDirectory:0,...a.params||{}}).then(M=>{var S,E,U;if(!((S=M==null?void 0:M.list)!=null&&S.length)&&(M!=null&&M.count)){const $=Math.ceil(M.count/s.value);if($&&o.value>$){Q({page:$});return}}l.value=(M==null?void 0:M.count)||0,k.value=((U=(E=M==null?void 0:M.list)==null?void 0:E.map)==null?void 0:U.call(E,$=>({key:$.id,name:$.name,url:$.url,thumbnail:le($)?$.url:void 0,length:ue($.length),updateTime:$.updateTime,isDirectory:$.isDirectory===1,userFile:$})))||[],ge()}).catch(M=>{var S,E;k.value=[],(E=(S=a.messageIns)==null?void 0:S.error)==null||E.call(S,M.message),ge()})};return we(()=>a.limit,()=>{j()}),we(()=>a.baseIndex,r=>{T.zIndex=r}),h({queryData:Q,clearSelections:j,getSelections:z}),(r,f)=>{const M=Ve,S=Ze,E=Ue,U=Et,$=dl,W=Vt,Ce=kt;return I(),L("div",zl,[y("div",Gl,[y("div",ql,[g(S,{action:"",accept:r.accept,showFileList:!1,beforeUpload:q},{default:P(()=>[g(M,{type:"primary",class:"ele-btn-icon",icon:_(gt)},{default:P(()=>f[3]||(f[3]=[ne(" 上传 ")])),_:1},8,["icon"])]),_:1},8,["accept"]),y("div",Wl,[g(E,{clearable:!0,modelValue:d.value,"onUpdate:modelValue":f[0]||(f[0]=ye=>d.value=ye),placeholder:"请输入文件名",onClear:oe,onChange:oe},null,8,["modelValue"]),g(M,{type:"primary",onClick:oe},{default:P(()=>f[4]||(f[4]=[ne("搜索")])),_:1})]),g(U,{modelValue:V.value,"onUpdate:modelValue":f[1]||(f[1]=ye=>V.value=ye),items:v,validateEvent:!1},null,8,["modelValue"])]),k.value.length?(I(),L(me,{key:0},[y("div",{class:"file-picker-file-list",onScroll:ve},[g($,H({boxChoose:!0,icons:_(il),smallIcons:_(Be),contextMenuProps:T},r.fileListProps||{},{data:k.value,grid:V.value===1,selectionType:r.limit===1?"radio":"checkbox",selections:m.value,current:D.value,"onUpdate:current":f[2]||(f[2]=ye=>D.value=ye),contextMenus:p,class:[{"is-ping-top":i.value}],onItemClick:u,onItemContextMenu:n,"onUpdate:selections":B,onItemContextOpen:O}),null,16,["icons","smallIcons","contextMenuProps","data","grid","selectionType","selections","current","class"])],32),g(W,H({size:"small",teleported:!1,pageSizes:[18,24,30,36,42],layout:"total,prev,pager,next,sizes"},r.paginationProps||{},{currentPage:o.value,pageSize:s.value,total:l.value,"onUpdate:currentPage":te,"onUpdate:pageSize":fe}),null,16,["currentPage","pageSize","total"])],64)):(I(),K(Ce,H({key:1,imageSize:80,description:"无数据"},r.emptyProps||{}),null,16))]),g(jl,{ref_key:"fileSelectionsRef",ref:x,fileSelections:r.limit===1?D.value?[D.value]:[]:m.value,limit:r.limit,selectionListProps:r.selectionListProps,baseIndex:r.baseIndex,onClearSelections:j,onRemoveItem:ce},null,8,["fileSelections","limit","selectionListProps","baseIndex"])])}}}),Kl=ee({__name:"file-group-add",props:he({parentId:{},groupData:{},modalProps:{},baseIndex:{},messageIns:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:he(["done"],["update:modelValue"]),setup(e,{emit:h}){const t=e,a=h,c=_e(e,"modelValue"),C=w(null),k=w(!1),[m,D]=Xe({name:"",parentId:void 0}),V=()=>{c.value=!1},d=()=>{var l,i;(i=(l=C.value)==null?void 0:l.validate)==null||i.call(l,v=>{v&&(k.value=!0,et({...m,isDirectory:1}).then(x=>{var T,R;k.value=!1,(R=(T=t.messageIns)==null?void 0:T.success)==null||R.call(T,x),V(),a("done")}).catch(x=>{var T,R;k.value=!1,(R=(T=t.messageIns)==null?void 0:T.error)==null||R.call(T,x.message)}))})},o=()=>{var l,i;D(),(i=(l=C.value)==null?void 0:l.clearValidate)==null||i.call(l)},s=()=>{t.parentId!=null&&(m.parentId=t.parentId)};return(l,i)=>{const v=Lt,x=Qe,T=Ue,R=He,B=Ve,j=De;return I(),K(j,H({form:!0,width:460,title:"添加分组",zIndex:l.baseIndex,appendToBody:!1},l.modalProps||{},{modelValue:c.value,"onUpdate:modelValue":i[3]||(i[3]=z=>c.value=z),onOpen:s,onClosed:o}),{footer:P(()=>[g(B,{onClick:V},{default:P(()=>i[6]||(i[6]=[ne("取消")])),_:1}),g(B,{type:"primary",loading:k.value,onClick:d},{default:P(()=>i[7]||(i[7]=[ne(" 保存 ")])),_:1},8,["loading"])]),default:P(()=>[g(R,{ref_key:"formRef",ref:C,model:_(m),labelWidth:"82px",onSubmit:i[2]||(i[2]=J(()=>{},["prevent"]))},{default:P(()=>[g(x,{label:"上级分组",prop:"parentId"},{default:P(()=>[g(v,{modelValue:_(m).parentId,"onUpdate:modelValue":i[0]||(i[0]=z=>_(m).parentId=z),data:l.groupData.filter(z=>z.id!==0&&z.id!==-1),nodeKey:"id",props:{label:"name"},clearable:!0,checkStrictly:!0,defaultExpandAll:!0,placeholder:"请选择上级分组",popperOptions:{strategy:"fixed"},teleported:!1,class:"ele-fluid"},Ie({default:P(({data:z})=>[i[4]||(i[4]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1)),y("span",null,Y(z.name),1)]),_:2},[_(m).parentId?{name:"prefix",fn:P(()=>[i[5]||(i[5]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1))]),key:"0"}:void 0]),1032,["modelValue","data"])]),_:1}),g(x,{label:"分组名称",prop:"name",rules:[{required:!0,message:"请输入分组名称",type:"string",trigger:"blur"}]},{default:P(()=>[g(T,{maxlength:20,clearable:!0,modelValue:_(m).name,"onUpdate:modelValue":i[1]||(i[1]=z=>_(m).name=z),placeholder:"请输入分组名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},16,["zIndex","modelValue"])}}}),Yl=ee({__name:"file-rename",props:he({data:{},modalProps:{},baseIndex:{},messageIns:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:he(["done"],["update:modelValue"]),setup(e,{emit:h}){const t=e,a=h,c=_e(e,"modelValue"),C=w(null),k=w(!1),[m,D]=Xe({name:""}),V=()=>{c.value=!1},d=()=>{var l,i;(i=(l=C.value)==null?void 0:l.validate)==null||i.call(l,v=>{var x;v&&(k.value=!0,tt({...m,id:(x=t.data)==null?void 0:x.id}).then(T=>{var R,B;k.value=!1,(B=(R=t.messageIns)==null?void 0:R.success)==null||B.call(R,T),V(),a("done")}).catch(T=>{var R,B;k.value=!1,(B=(R=t.messageIns)==null?void 0:R.error)==null||B.call(R,T.message)}))})},o=()=>{var l,i;D(),(i=(l=C.value)==null?void 0:l.clearValidate)==null||i.call(l)},s=()=>{t.data&&(m.name=t.data.name)};return(l,i)=>{const v=Ue,x=Qe,T=He,R=Ve,B=De;return I(),K(B,H({form:!0,width:460,title:"重命名",zIndex:l.baseIndex,appendToBody:!1},l.modalProps||{},{modelValue:c.value,"onUpdate:modelValue":i[2]||(i[2]=j=>c.value=j),onOpen:s,onClosed:o}),{footer:P(()=>[g(R,{onClick:V},{default:P(()=>i[3]||(i[3]=[ne("取消")])),_:1}),g(R,{type:"primary",loading:k.value,onClick:d},{default:P(()=>i[4]||(i[4]=[ne(" 保存 ")])),_:1},8,["loading"])]),default:P(()=>[g(T,{ref_key:"formRef",ref:C,model:_(m),labelWidth:"82px",onSubmit:i[1]||(i[1]=J(()=>{},["prevent"]))},{default:P(()=>[g(x,{label:`${l.data&&l.data.isDirectory?"分组":"文件"}名称`,prop:"name",rules:[{required:!0,message:`请输入${l.data&&l.data.isDirectory?"分组":"文件"}名称`,type:"string",trigger:"blur"}]},{default:P(()=>[g(v,{maxlength:20,clearable:!0,modelValue:_(m).name,"onUpdate:modelValue":i[0]||(i[0]=j=>_(m).name=j),placeholder:`请输入${l.data&&l.data.isDirectory?"分组":"文件"}名称`},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},16,["zIndex","modelValue"])}}}),Xl={class:"file-picker-move-wrapper"},Hl=ee({__name:"file-move",props:he({data:{},groupData:{},modalProps:{},baseIndex:{},messageIns:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:he(["done"],["update:modelValue"]),setup(e,{emit:h}){const t=e,a=h,c=_e(e,"modelValue"),C=w(!1),k=w(),m=o=>{k.value=o.id},D=()=>{c.value=!1},V=()=>{var s,l,i;const o=k.value;if(o==null){(l=(s=t.messageIns)==null?void 0:s.error)==null||l.call(s,"请选择分组");return}C.value=!0,tt({id:(i=t.data)==null?void 0:i.id,parentId:o}).then(v=>{var x,T;C.value=!1,(T=(x=t.messageIns)==null?void 0:x.success)==null||T.call(x,v),D(),a("done")}).catch(v=>{var x,T;C.value=!1,(T=(x=t.messageIns)==null?void 0:x.error)==null||T.call(x,v.message)})},d=()=>{t.data&&(k.value=t.data.parentId)};return(o,s)=>{const l=Ct,i=Je,v=Ve,x=De;return I(),K(x,H({width:460,title:"移动到",zIndex:o.baseIndex,appendToBody:!1},o.modalProps||{},{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=T=>c.value=T),onOpen:d}),{footer:P(()=>[g(v,{onClick:D},{default:P(()=>s[2]||(s[2]=[ne("取消")])),_:1}),g(v,{type:"primary",loading:C.value,onClick:V},{default:P(()=>s[3]||(s[3]=[ne(" 保存 ")])),_:1},8,["loading"])]),default:P(()=>[y("div",Xl,[g(i,{data:o.groupData.filter(T=>T.id!==-1),nodeKey:"id",props:{label:"name"},expandOnClickNode:!1,defaultExpandAll:!0,class:"file-picker-move-tree",onNodeClick:m},{default:P(T=>[s[1]||(s[1]=y("img",{src:$e,class:"file-picker-tree-icon"},null,-1)),y("span",{class:re(["el-tree-node__label",{"is-active":T.data.id===k.value}])},Y(T.data.name),3),g(l,{value:!0,modelValue:T.data.id===k.value},null,8,["modelValue"])]),_:1},8,["data"])])]),_:1},16,["zIndex","modelValue"])}}}),mn=ee({name:"FilePicker",__name:"index",props:he({title:{default:"文件选择"},modalProps:{},limit:{},fileLimit:{default:100},accept:{},params:{},groupDropdownProps:{},groupAddModalProps:{},renameModalProps:{},moveModalProps:{},fileListProps:{},selectionListProps:{},emptyProps:{},paginationProps:{},baseIndex:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:he(["done","close"],["update:modelValue"]),setup(e,{expose:h,emit:t}){const a=e,c=t,C=_e(e,"modelValue"),{mobile:k}=xt(),m=w(null),D=w(null),V=w(null),d=w(!1),o=w([]),s=w(null),l=w(!1),i=w(null),v=w(!1),x=w(),T=w(!1),R=w(null),B=w(!1),j=w(),z=w(),ce=w([]);let oe=null;const te=Z(()=>{if(a.baseIndex!=null)return a.baseIndex+100}),fe=Z(()=>te.value==null?3e3:te.value+100),u=w(),n=w(),p=It({inner:!0,appendTo:u}),O=Rt({appendTo:n}),A=b=>[{title:"重命名",command:"rename",icon:xe(Ae)},{title:"添加分组",command:"add",icon:xe(Mt),iconStyle:{transform:"scale(0.92)"}},{title:"删除分组",command:"remove",icon:xe(Ye),divided:!0,danger:!0}],q=()=>{j.value&&j.value.handleClose()},ve=(b,F)=>{oe=F,!(b==null||z.value===b)&&(q(),Te(()=>{ce.value=A()||[],z.value=b,ce.value.length&&Te(()=>{j.value&&j.value.handleOpen()})}))},ge=(b,F)=>{var se,ae,ie,de;s.value!=null&&k.value&&((ae=(se=m.value)==null?void 0:se.toggleCollapse)==null||ae.call(se,!0)),b&&b.id!=null&&(F||(de=(ie=D.value)==null?void 0:ie.setSelectedGroup)==null||de.call(ie,b),(s.value==null||s.value.id!==b.id)&&(s.value=b,$(b.id)))},le=()=>{B.value?$():U()},ue=b=>{B.value=!1,x.value=b?b.id:void 0,v.value=!0},Q=(b,F)=>{B.value=!!F,i.value=b,l.value=!0},r=(b,F)=>{B.value=!!F,R.value=b,T.value=!0},f=(b,F)=>{var se,ae,ie,de,Ee;B.value=!!F,(Ee=(de=(ie=(ae=(se=O==null?void 0:O.confirm)==null?void 0:se.call(O,`确定要删除“${b.name}”吗?`,"系统提示",{type:"warning",draggable:!0}))==null?void 0:ae.then)==null?void 0:ie.call(ae,()=>{var je;const G=(je=p==null?void 0:p.loading)==null?void 0:je.call(p,{message:"请求中..",plain:!0});Ll(b.id).then(Oe=>{var Me,Se;(Me=G==null?void 0:G.close)==null||Me.call(G),(Se=p==null?void 0:p.success)==null||Se.call(p,Oe),le()}).catch(Oe=>{var Me,Se;(Me=G==null?void 0:G.close)==null||Me.call(G),(Se=p==null?void 0:p.error)==null||Se.call(p,Oe.message)})}))==null?void 0:de.catch)==null||Ee.call(de,()=>{})},M=b=>{oe!=null&&(b==="rename"?Q(oe):b==="add"?ue(oe):b==="remove"&&f(oe))},S=()=>{d.value=!1},E=()=>{d.value=!0},U=()=>{E(),Fl({isDirectory:1}).then(b=>{const F=[{id:-1,name:"全部"},{id:0,name:"未分组"},...wt({data:b,idField:"id",parentIdField:"parentId"})];o.value=F;const se=s.value==null?void 0:Pt(F,ae=>{var ie;return ae.id===((ie=s.value)==null?void 0:ie.id)});s.value=null,Te(()=>{ge(se||F[0])})}).catch(b=>{o.value=[],p.error(b.message),S()})},$=b=>{E();const F=b==null?void 0:{page:1,name:"",parentId:b};V.value&&V.value.queryData(F)},W=()=>{V.value&&V.value.clearSelections()},Ce=()=>{W(),U()},ye=()=>{W(),c("close")},lt=()=>{C.value=!1},nt=()=>{var b,F;E(),c("done",((F=(b=V.value)==null?void 0:b.getSelections)==null?void 0:F.call(b))||[])};return h({hideLoading:S}),(b,F)=>{const se=Tt,ae=St,ie=Ne,de=Ve,Ee=De;return I(),K(Ee,H({width:988,title:b.title,position:"center",zIndex:b.baseIndex},b.modalProps||{},{modelValue:C.value,"onUpdate:modelValue":F[5]||(F[5]=G=>C.value=G),class:"file-picker-modal",onOpen:Ce,onClose:ye}),{footer:P(()=>[g(de,{onClick:lt},{default:P(()=>F[6]||(F[6]=[ne("取消")])),_:1}),g(de,{type:"primary",onClick:nt},{default:P(()=>F[7]||(F[7]=[ne("确定")])),_:1})]),default:P(()=>[g(se,{ref_key:"splitRef",ref:m,space:"0px",size:"186px",flexTable:!0,allowCollapse:_(k),customStyle:{borderWidth:"0 1px 0 0"},class:"file-picker-wrapper"},{body:P(()=>[g(Nl,{ref_key:"fileListRef",ref:V,limit:b.limit,fileLimit:b.fileLimit,accept:b.accept,params:b.params,fileListProps:b.fileListProps,selectionListProps:b.selectionListProps,emptyProps:b.emptyProps,paginationProps:b.paginationProps,baseIndex:te.value,messageIns:_(p),onQueryStart:E,onQueryDone:S,onRenameFile:Q,onMoveFile:r,onRemoveFile:f,onFileItemContextOpen:q},null,8,["limit","fileLimit","accept","params","fileListProps","selectionListProps","emptyProps","paginationProps","baseIndex","messageIns"])]),default:P(()=>[g(Dl,{ref_key:"fileGroupRef",ref:D,groupData:o.value,onGroupSelect:ge,onAddBtnClick:F[0]||(F[0]=G=>ue()),onMoreIconClick:ve,onHideGroupCtxMenu:F[1]||(F[1]=G=>q())},null,8,["groupData"])]),_:1},8,["allowCollapse"]),g(ae,{loading:d.value,class:"file-picker-loading"},null,8,["loading"]),g(Kl,{modelValue:v.value,"onUpdate:modelValue":F[2]||(F[2]=G=>v.value=G),parentId:x.value,groupData:o.value,modalProps:b.groupAddModalProps,baseIndex:te.value,messageIns:_(p),onDone:le},null,8,["modelValue","parentId","groupData","modalProps","baseIndex","messageIns"]),g(Yl,{modelValue:l.value,"onUpdate:modelValue":F[3]||(F[3]=G=>l.value=G),data:i.value,modalProps:b.renameModalProps,baseIndex:te.value,messageIns:_(p),onDone:le},null,8,["modelValue","data","modalProps","baseIndex","messageIns"]),g(Hl,{modelValue:T.value,"onUpdate:modelValue":F[4]||(F[4]=G=>T.value=G),data:R.value,groupData:o.value,modalProps:b.moveModalProps,baseIndex:te.value,messageIns:_(p),onDone:le},null,8,["modelValue","data","groupData","modalProps","baseIndex","messageIns"]),g(ie,H({triggerKeys:[],persistent:!1,validateEvent:!1,zIndex:te.value,placement:"bottom-end",iconProps:{size:15},popperOptions:{strategy:"fixed",modifiers:[{name:"offset",options:{offset:[6,6]}}]}},b.groupDropdownProps||{},{ref_key:"ctxMenuDropdownRef",ref:j,trigger:"click",componentType:"pro",preventContextmenu:!0,virtualTriggering:!0,virtualRef:z.value,items:ce.value,onCommand:M}),null,16,["zIndex","virtualRef","items"]),y("div",{ref_key:"messageWrapRef",ref:u,class:"ele-message-wrapper",style:be({position:"fixed",zIndex:fe.value})},null,4),y("div",{ref_key:"messageBoxWrapRef",ref:n,class:"ele-message-box-wrapper",style:be({position:"fixed",zIndex:fe.value})},null,4)]),_:1},16,["title","zIndex","modelValue"])}}});export{mn as _,et as a,$e as b,Be as c,il as d,dl as e,Ll as f,$l as g,Fl as l,dn as r,tt as u};
