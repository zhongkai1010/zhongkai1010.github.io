import{s as B,gF as J,d as K,gy as L,aP as Q,aO as A,r as u,a as G,J as O,gG as Y,p as k,o as g,e as c,b as a,w as l,c as W,_ as X,h as C,t as f,u as t,aN as Z,aM as ee,da as ae,aH as oe,aJ as se,ao as te,cu as ne,bq as le,a5 as re,aS as ie,aC as ce,E as de,as as ue,gH as me,m as v,n as pe}from"./index-D0yT1AcU.js";import{_ as _e}from"./index-DYf50MRR.js";import{E as ge}from"./link-DFO7MjcD.js";import{_ as fe}from"./index-MAbvOff4.js";import{_ as ve}from"./index-DGSx7ihv.js";async function be(i){var _;const o=await B.post("/login",i);return o.data.code===0?(J("Bearer "+((_=o.data.data)==null?void 0:_.access_token),i.remember),o.data.message):Promise.reject(new Error(o.data.message))}async function he(){const i=await B.get("/captcha");return i.data.code===0&&i.data.data?i.data.data:Promise.reject(new Error(i.data.message))}const ye={class:"login-wrapper"},xe={class:"login-main"},we={class:"login-body"},Ve={class:"login-captcha-group"},ke=["src"],Ce={key:1,class:"login-qrcode-group"},Ee=K({__name:"index",setup(i){const{t:o}=L.useI18n(),{currentRoute:_}=Q(),{goHomeRoute:z,cleanPageTabs:N}=A(),b=u(1),h=u(null),y=u(!1),n=G({tenantId:4,username:"admin",password:"admin",code:"",remember:!0}),P=O(()=>({username:[{required:!0,message:o("login.username"),type:"string",trigger:"blur"}],password:[{required:!0,message:o("login.password"),type:"string",trigger:"blur"}],code:[{required:!0,message:o("login.code"),type:"string",trigger:"blur"}]})),x=u(""),E=u(""),q=u(""),$=()=>{var s,e;(e=(s=h.value)==null?void 0:s.validate)==null||e.call(s,d=>{if(d){if(n.code.toLowerCase()!==E.value){v.error("验证码错误");return}y.value=!0,be(n).then(m=>{v.success(m),N(),I()}).catch(m=>{y.value=!1,v.error(m.message),w()})}})},w=()=>{he().then(s=>{var e,d;x.value=s.base64,E.value=s.text,n.code=s.text,(d=(e=h.value)==null?void 0:e.clearValidate)==null||d.call(e)}).catch(s=>{v.error(s.message)})},T=()=>{q.value=`https://api.eleadmin.com/v2/auth/login?code=${Date.now()}`},R=s=>{s===2&&T()},I=()=>{const{query:s}=t(_);z(s.from)};return Y()?I():w(),(s,e)=>{const d=X,m=fe,V=se,p=oe,U=ie,H=ce,j=Z,F=ve,M=de,S=ge,D=_e;return g(),k("div",ye,[c("div",xe,[a(D,{shadow:"always",class:"login-card"},{default:l(()=>[e[6]||(e[6]=c("div",{class:"login-cover"},[c("h1",{class:"login-title"},"藏品管理系统"),c("h4",{class:"login-subtitle"},"智能化、便捷的藏品管理解决方案，助力精细化管理")],-1)),c("div",we,[a(d,{type:"heading",style:{"font-size":"24px","margin-bottom":"18px"}},{default:l(()=>[C(f(t(o)("login.title")),1)]),_:1}),a(m,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=r=>b.value=r),items:[{label:t(o)("login.passwordType"),value:1},{label:t(o)("login.qrcodeType"),value:2}],style:{"margin-bottom":"18px"},onChange:R},null,8,["modelValue","items"]),b.value==1?(g(),W(j,{key:0,ref_key:"formRef",ref:h,size:"large",model:n,rules:P.value,onKeyup:ae($,["enter"]),onSubmit:e[5]||(e[5]=ee(()=>{},["prevent"]))},{default:l(()=>[a(p,{prop:"username"},{default:l(()=>[a(V,{clearable:"",modelValue:n.username,"onUpdate:modelValue":e[1]||(e[1]=r=>n.username=r),placeholder:t(o)("login.username"),"prefix-icon":t(te)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),a(p,{prop:"password"},{default:l(()=>[a(V,{"show-password":"",modelValue:n.password,"onUpdate:modelValue":e[2]||(e[2]=r=>n.password=r),placeholder:t(o)("login.password"),"prefix-icon":t(ne)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),a(p,{prop:"code"},{default:l(()=>[c("div",Ve,[a(V,{clearable:"",modelValue:n.code,"onUpdate:modelValue":e[3]||(e[3]=r=>n.code=r),placeholder:t(o)("login.code"),"prefix-icon":t(le)},null,8,["modelValue","placeholder","prefix-icon"]),c("div",{class:"login-captcha",onClick:w},[x.value?(g(),k("img",{key:0,src:x.value},null,8,ke)):re("",!0)])])]),_:1}),a(p,null,{default:l(()=>[a(U,{modelValue:n.remember,"onUpdate:modelValue":e[4]||(e[4]=r=>n.remember=r)},{default:l(()=>[C(f(t(o)("login.remember")),1)]),_:1},8,["modelValue"])]),_:1}),a(p,null,{default:l(()=>[a(H,{size:"large",type:"primary",loading:y.value,style:{width:"100%"},onClick:$},{default:l(()=>[C(f(t(o)("login.login")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])):(g(),k("div",Ce,[a(F,{size:180,margin:2,value:q.value,class:"login-qrcode"},null,8,["value"]),a(S,{type:"primary",underline:!1,style:{"margin-top":"16px","user-select":"none"},onClick:T},{default:l(()=>[a(M,{size:15,style:{transform:"translateY(-1px)","margin-right":"6px"}},{default:l(()=>[a(t(ue))]),_:1}),c("span",null,f(t(o)("login.refreshQrcode")),1)]),_:1})]))])]),_:1})]),a(me,{style:{"padding-top":"0"}})])}}}),ze=pe(Ee,[["__scopeId","data-v-b1d47dfb"]]);export{ze as default};
