import{_ as z}from"./index-C5fuAxFq.js";import{d as B,a$ as P,r as T,c as b,o as c,w as e,b as t,aH as Y,aJ as O,u as V,aC as S,h as _,aM as U,da as q,aN as F,aZ as H,a_ as K,a as j,bM as J,aB as L,a5 as C,e as g,t as u,p as X,l as W,v as Z,n as A,s as I,b8 as G,m as D,aX as Q,aY as ee}from"./index-D0yT1AcU.js";import{_ as N}from"./index-DYf50MRR.js";import{_ as te}from"./index-C-4uNQQ4.js";import"./index-DFvHHIXI.js";import"./index-BkoA2sCN.js";import"./index-CgBmqrP9.js";import"./virtual-list-COxu24hZ.js";import"./index-CybbLoLn.js";import"./index-CZBaXWVt.js";import{E as ae}from"./link-DFO7MjcD.js";import{E as le,a as oe}from"./col-PPS4Xvy3.js";import{E as se}from"./date-picker-DvJg1hkh.js";import{E as re,a as ne}from"./descriptions-item-RLhMYRtM.js";import"./isArrayLikeObject-DbE5rAKf.js";import"./vuedraggable.umd-_mANVixF.js";import"./arrays-CDbp9jkV.js";import"./index-P44nefke.js";const ie=B({__name:"operation-record-search",emits:["search"],setup(h,{emit:n}){const k=n,[f,o]=P({username:"",module:""}),d=T(["",""]),r=()=>{const[y,a]=d.value||[];k("search",{...f,createTimeStart:y,createTimeEnd:a})},w=()=>{o(),d.value=["",""],r()};return(y,a)=>{const l=O,i=Y,p=oe,M=se,E=S,v=le,x=F,m=N;return c(),b(m,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[t(x,{"label-width":"72px",onKeyup:q(r,["enter"]),onSubmit:a[3]||(a[3]=U(()=>{},["prevent"]))},{default:e(()=>[t(v,{gutter:8},{default:e(()=>[t(p,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{label:"用户账号"},{default:e(()=>[t(l,{clearable:"",modelValue:V(f).username,"onUpdate:modelValue":a[0]||(a[0]=s=>V(f).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{label:"操作模块"},{default:e(()=>[t(l,{clearable:"",modelValue:V(f).module,"onUpdate:modelValue":a[1]||(a[1]=s=>V(f).module=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{label:"操作时间"},{default:e(()=>[t(M,{"unlink-panels":"",type:"datetimerange",modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=s=>d.value=s),"range-separator":"-","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始时间","end-placeholder":"结束时间",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(i,{"label-width":"16px"},{default:e(()=>[t(E,{type:"primary",onClick:r},{default:e(()=>a[4]||(a[4]=[_("查询")])),_:1}),t(E,{onClick:w},{default:e(()=>a[5]||(a[5]=[_("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),de={key:0},me={style:{"word-break":"break-all"}},ue={style:{"word-break":"break-all"}},pe=B({__name:"operation-record-detail",props:H({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const n=K(h,"modelValue"),k=j({popperStyle:{width:"580px",maxWidth:"90%",wordBreak:"break-all"},bodyStyle:{maxWidth:"calc(100vw - 32px)",maxHeight:"252px",overflowY:"auto","--ele-scrollbar-color":"#5e5e5e","--ele-scrollbar-hover-color":"#707070","--ele-scrollbar-size":"8px"},offset:4,placement:"top"}),{mobile:f}=J();return(o,d)=>{const r=ne,w=W,y=Z,a=re,l=L;return c(),b(l,{title:"详情",width:720,modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=i=>n.value=i)},{default:e(()=>[o.data?(c(),b(a,{key:0,border:!0,column:V(f)?1:2,class:"detail-table"},{default:e(()=>[t(r,{label:"操作人"},{default:e(()=>[g("div",null,u(o.data.nickname)+"("+u(o.data.username)+")",1)]),_:1}),t(r,{label:"IP地址"},{default:e(()=>[g("div",null,u(o.data.ip),1)]),_:1}),t(r,{label:"操作模块"},{default:e(()=>[g("div",null,u(o.data.module),1)]),_:1}),t(r,{label:"操作功能"},{default:e(()=>[g("div",null,u(o.data.description),1)]),_:1}),t(r,{label:"操作时间"},{default:e(()=>[g("div",null,u(o.data.createTime),1)]),_:1}),t(r,{label:"请求耗时"},{default:e(()=>[isNaN(o.data.spendTime)?C("",!0):(c(),X("div",de,u(o.data.spendTime/1e3)+"s",1))]),_:1}),t(r,{label:"请求方式"},{default:e(()=>[g("div",null,u(o.data.requestMethod),1)]),_:1}),t(r,{label:"请求状态"},{default:e(()=>[o.data.status===0?(c(),b(w,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>d[1]||(d[1]=[_(" 正常 ")])),_:1})):o.data.status===1?(c(),b(w,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>d[2]||(d[2]=[_(" 异常 ")])),_:1})):C("",!0)]),_:1}),t(r,{label:"请求地址",span:2},{default:e(()=>[g("div",me,u(o.data.url),1)]),_:1}),t(r,{label:"调用方法",span:2},{default:e(()=>[g("div",ue,u(o.data.method),1)]),_:1}),t(r,{label:"请求参数",span:2},{default:e(()=>[t(y,{"max-line":4,tooltip:k},{default:e(()=>[_(u(o.data.params),1)]),_:1},8,["tooltip"])]),_:1}),o.data.status===0?(c(),b(r,{key:0,label:"返回结果",span:2},{default:e(()=>[t(y,{"max-line":4,tooltip:k},{default:e(()=>[_(u(o.data.result),1)]),_:1},8,["tooltip"])]),_:1})):(c(),b(r,{key:1,label:"异常信息",span:2},{default:e(()=>[t(y,{"max-line":4,tooltip:k},{default:e(()=>[_(u(o.data.error),1)]),_:1},8,["tooltip"])]),_:1}))]),_:1},8,["column"])):C("",!0)]),_:1},8,["modelValue"])}}}),ce=A(pe,[["__scopeId","data-v-18aa4e3a"]]);async function _e(h){const n=await I.get("/system/operation-record/page",{params:h});return n.data.code===0?n.data.data:Promise.reject(new Error(n.data.message))}async function fe(h){const n=await I.get("/system/operation-record",{params:h});return n.data.code===0&&n.data.data?n.data.data:Promise.reject(new Error(n.data.message))}const We=B({name:"SystemOperationRecord",__name:"index",setup(h){const n=T(null),k=T([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"module",label:"操作模块",sortable:"custom",minWidth:110},{prop:"description",label:"操作功能",sortable:"custom",minWidth:110},{prop:"url",label:"请求地址",sortable:"custom",minWidth:110},{prop:"requestMethod",label:"请求方式",sortable:"custom",width:110,align:"center"},{prop:"status",label:"状态",sortable:"custom",width:100,align:"center",slot:"status",filters:[{text:"正常",value:"0"},{text:"异常",value:"1"}],filterMultiple:!1,formatter:a=>a.status==0?"正常":"异常"},{prop:"spendTime",label:"耗时",sortable:"custom",width:100,formatter:a=>`${a.spendTime/1e3}s`,align:"center"},{prop:"createTime",label:"操作时间",sortable:"custom",align:"center",width:180},{columnKey:"action",label:"操作",width:90,align:"center",slot:"action",fixed:"right",hideInPrint:!0,hideInExport:!0}]),f=T({module:"",description:"",url:"",requestMethod:"",method:"",params:"",result:"",error:"",spendTime:0,os:"",device:"",browser:"",ip:"",status:0,createTime:"",nickname:"",username:""}),o=T(!1),d=({pages:a,where:l,orders:i,filters:p})=>_e({...l,...i,...p,...a}),r=a=>{var l,i;(i=(l=n.value)==null?void 0:l.reload)==null||i.call(l,{page:1,where:a})},w=a=>{f.value=a,o.value=!0},y=()=>{var l,i;const a=D.loading({message:"请求中..",plain:!0});(i=(l=n.value)==null?void 0:l.fetch)==null||i.call(l,({where:p,orders:M,filters:E})=>{fe({...p,...M,...E}).then(v=>{const x=new Q.Workbook,m=x.addWorksheet("Sheet1");m.addRow(["账号","用户名","操作模块","操作功能","请求地址","请求方式","状态","耗时","操作时间"]),v.forEach(s=>{m.addRow([s.username,s.nickname,s.module,s.description,s.url,s.requestMethod,["正常","异常"][s.status],s.spendTime/1e3+"s",s.createTime])}),[16,16,18,20,28,14,14,14,24].forEach((s,R)=>{m.getColumn(R+1).width=s}),m.eachRow({includeEmpty:!0},(s,R)=>{s.height=20,s.eachCell({includeEmpty:!0},$=>{$.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},$.alignment={vertical:"middle",horizontal:"center"},$.font={size:12,bold:R===1}})}),x.xlsx.writeBuffer().then(s=>{ee(s,"操作日志.xlsx"),a.close()})}).catch(v=>{a.close(),D.error(v.message)})})};return(a,l)=>{const i=S,p=W,M=ae,E=te,v=N,x=z;return c(),b(x,null,{default:e(()=>[t(ie,{onSearch:r}),t(v,{"body-style":{paddingTop:"8px"}},{default:e(()=>[t(E,{ref_key:"tableRef",ref:n,"row-key":"id",columns:k.value,datasource:d,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"操作日志数据"},"cache-key":"systemOperationRecordTable"},{toolbar:e(()=>[t(i,{type:"primary",class:"ele-btn-icon",icon:V(G),onClick:y},{default:e(()=>l[1]||(l[1]=[_(" 导出 ")])),_:1},8,["icon"])]),status:e(({row:m})=>[m.status===0?(c(),b(p,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>l[2]||(l[2]=[_(" 正常 ")])),_:1})):m.status===1?(c(),b(p,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>l[3]||(l[3]=[_(" 异常 ")])),_:1})):C("",!0)]),action:e(({row:m})=>[t(M,{type:"primary",underline:!1,onClick:s=>w(m)},{default:e(()=>l[4]||(l[4]=[_(" 详情 ")])),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),t(ce,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=m=>o.value=m),data:f.value},null,8,["modelValue","data"])]),_:1})}}});export{We as default};
