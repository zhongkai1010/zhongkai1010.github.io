import{_ as ye}from"./index-DTO-nUKg.js";import{d as q,b2 as Z,c as f,o as _,w as l,b as t,aJ as ee,aL as te,u as o,aE as j,i as y,aO as le,d8 as ge,aP as ne,r as T,K as oe,aI as be,aK as ve,E as G,a9 as W,a6 as F,e as B,t as K,b9 as ae,n as D,b0 as Y,b1 as Ve,gL as U,aD as he,z as xe,aS as Te,l as re,g as Ie,h as L,aX as ke,V as Q,az as Ee,m as Ce,bS as Me,en as Se,gM as Ue,aG as $e}from"./index-CifDuRKA.js";import{_ as se}from"./index-DfazNGs9.js";import{_ as Ne}from"./index-C02xlazK.js";import"./index-nF8yHkQf.js";import"./index-DUd4dYFp.js";import"./index-G6TwFlU2.js";import"./virtual-list-CuBNNQah.js";import"./index-Br8TiUiO.js";import"./index-B72mtQJ5.js";import{E as ie,a as pe}from"./col-y0d7KMA1.js";import{E as De}from"./input-number-CZKLlNGD.js";import{a as we}from"./index.vue_vue_type_script_setup_true_lang-CQMd_Rzo.js";import"./tree-BoOKM6PU.js";import{E as Re}from"./tree-select-CjEc4nYN.js";import{l as de,u as ze,a as Fe,r as Oe}from"./index-BjB_wrGS.js";import"./isArrayLikeObject-DiBiimoh.js";import"./vuedraggable.umd-BrKXWqaO.js";import"./index-hMu3IOZl.js";import"./index-D-8M0QoX.js";const Be=q({__name:"menu-search",emits:["search"],setup(w,{emit:I}){const $=I,[u,C]=Z({title:"",path:"",authority:""}),g=()=>{$("search",{...u})},V=()=>{C(),g()};return(k,d)=>{const e=te,v=ee,h=pe,M=j,E=ie,R=ne,z=se;return _(),f(z,{"body-style":{paddingBottom:"2px"}},{default:l(()=>[t(R,{"label-width":"72px",onKeyup:ge(g,["enter"]),onSubmit:d[3]||(d[3]=le(()=>{},["prevent"]))},{default:l(()=>[t(E,{gutter:8},{default:l(()=>[t(h,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{label:"菜单名称"},{default:l(()=>[t(e,{clearable:"",modelValue:o(u).title,"onUpdate:modelValue":d[0]||(d[0]=r=>o(u).title=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{label:"菜单地址"},{default:l(()=>[t(e,{clearable:"",modelValue:o(u).path,"onUpdate:modelValue":d[1]||(d[1]=r=>o(u).path=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{label:"权限标识"},{default:l(()=>[t(e,{clearable:"",modelValue:o(u).authority,"onUpdate:modelValue":d[2]||(d[2]=r=>o(u).authority=r),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(v,{"label-width":"16px"},{default:l(()=>[t(M,{type:"primary",onClick:g},{default:l(()=>d[4]||(d[4]=[y("查询")])),_:1}),t(M,{onClick:V},{default:l(()=>d[5]||(d[5]=[y("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ke=q({__name:"menu-select",props:{modelValue:{},placeholder:{default:"请选择上级菜单"}},emits:["update:modelValue"],setup(w,{expose:I,emit:$}){const u=w,C=$,g=T([]),V=e=>{C("update:modelValue",e||0)},k=oe(()=>{var e;if(u.modelValue)return(e=be(g.value,v=>v.menuId==u.modelValue))==null?void 0:e.icon}),d=()=>{de().then(e=>{g.value=ae({data:e,idField:"menuId",parentIdField:"parentId"})}).catch(e=>{D.error(e.message)})};return d(),I({reload:d}),(e,v)=>{const h=G,M=Re;return _(),f(M,{clearable:"",filterable:"",data:g.value,"check-strictly":"","default-expand-all":"","node-key":"menuId",props:{label:"title"},placeholder:e.placeholder,"model-value":e.modelValue||void 0,class:"ele-fluid","popper-options":{strategy:"fixed"},"onUpdate:modelValue":V},ve({default:l(({data:E})=>[E.icon?(_(),f(h,{key:0,style:{"margin-right":"4px",transform:"translateY(-1px)"}},{default:l(()=>[(_(),f(W(E.icon)))]),_:2},1024)):F("",!0),B("span",null,K(E.title),1)]),_:2},[k.value?{name:"prefix",fn:l(()=>[t(h,{color:"var(--el-text-color-regular)",style:{"margin-right":"6px"}},{default:l(()=>[(_(),f(W(k.value)))]),_:1})]),key:"0"}:void 0]),1032,["data","placeholder","model-value"])}}}),qe=q({__name:"menu-edit",props:Y({data:{},parentId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:Y(["done"],["update:modelValue"]),setup(w,{expose:I,emit:$}){const u=w,C=$,g=Ve(w,"modelValue"),V=T(!1),k=T(!1),d=T(null),[e,v,h]=Z({menuId:void 0,parentId:void 0,title:"",menuType:0,openType:0,icon:"",path:"",component:"",authority:"",sortNumber:void 0,hide:0,meta:""}),M=oe(()=>{const s={title:[{required:!0,type:"string",message:"请输入菜单名称",trigger:"blur"}],sortNumber:[{required:!0,type:"number",message:"请输入排序号",trigger:"blur"}],meta:[{type:"string",validator:(n,i,c)=>{if(i){const p="请输入正确的JSON格式";try{const b=JSON.parse(i);if(b==null||typeof b!="object"){c(p);return}}catch(b){c(p);return}}c()},trigger:"blur"}]};return e.menuType!==2&&(s.path=[{required:!0,type:"string",message:e.openType===2?"请输入外链地址":"请输入路由地址",trigger:"blur"},{type:"string",validator:(n,i,c)=>{if(i)if(e.openType===2){if(!U(i)){c("请输入正确的链接地址");return}}else{if(i==="/"){c("路由地址不能为 /");return}if(!i.startsWith("/")){c("路由地址需要以 / 开头");return}}c()},trigger:"blur"}],e.menuType===1&&e.openType!==2&&(s.component=[{required:!0,type:"string",message:e.openType===1?"请输入内嵌地址":"请输入组件路径",trigger:"blur"},{type:"string",validator:(n,i,c)=>{if(i&&e.openType===1&&!U(i)){c("请输入正确的链接地址");return}c()},trigger:"blur"}])),s}),E=()=>{g.value=!1},R=()=>{var s,n;(n=(s=d.value)==null?void 0:s.validate)==null||n.call(s,i=>{if(!i)return;k.value=!0,(V.value?ze:Fe)({...e,menuType:e.menuType===2?1:0,parentId:e.parentId||0}).then(p=>{k.value=!1,D.success(p),E(),C("done")}).catch(p=>{k.value=!1,D.error(p.message)})})},z=()=>{var s,n;e.menuType===0?(e.authority="",e.openType=0,e.component=""):e.menuType===1?e.openType===2&&(e.authority=""):(e.openType=0,e.icon="",e.path="",e.component="",e.hide=0),(n=(s=d.value)==null?void 0:s.clearValidate)==null||n.call(s)},r=()=>{var s,n;e.openType===2&&(e.component="",e.authority=""),(n=(s=d.value)==null?void 0:s.clearValidate)==null||n.call(s)},a=s=>{e.hide=s?0:1},x=s=>{var n;return!!((n=s.children)!=null&&n.length)&&!s.component},N=()=>{if(u.data){const s=U(u.data.path),n=U(u.data.component),i=u.data.menuType===1?2:x(u.data)?0:1;h({...u.data,menuType:i,openType:s?2:n?1:0,parentId:u.data.parentId===0?void 0:u.data.parentId}),V.value=!0}else v(),e.parentId=u.parentId,V.value=!1;Q(()=>{Q(()=>{var s,n;(n=(s=d.value)==null?void 0:s.clearValidate)==null||n.call(s)})})},S=T(null);return I({reloadMenuSelectData:()=>{var s,n;(n=(s=S.value)==null?void 0:s.reload)==null||n.call(s)}}),(s,n)=>{const i=ee,c=te,p=pe,b=Te,P=xe,H=ie,ue=re,A=G,J=Ie,me=De,ce=ke,fe=ne,X=j,_e=he;return _(),f(_e,{form:"",width:740,modelValue:g.value,"onUpdate:modelValue":n[11]||(n[11]=m=>g.value=m),title:V.value?"修改菜单":"新建菜单",onOpen:N},{footer:l(()=>[t(X,{onClick:E},{default:l(()=>n[12]||(n[12]=[y("取消")])),_:1}),t(X,{type:"primary",loading:k.value,onClick:R},{default:l(()=>n[13]||(n[13]=[y(" 保存 ")])),_:1},8,["loading"])]),default:l(()=>[t(fe,{ref_key:"formRef",ref:d,model:o(e),rules:M.value,"label-width":"100px","validate-on-rule-change":!1,onSubmit:n[10]||(n[10]=le(()=>{},["prevent"]))},{default:l(()=>[t(H,{gutter:16},{default:l(()=>[t(p,{sm:12,xs:24},{default:l(()=>[t(i,{label:"上级菜单",prop:"parentId"},{default:l(()=>[t(Ke,{ref_key:"menuSelectRef",ref:S,modelValue:o(e).parentId,"onUpdate:modelValue":n[0]||(n[0]=m=>o(e).parentId=m)},null,8,["modelValue"])]),_:1}),t(i,{label:"菜单名称",prop:"title"},{default:l(()=>[t(c,{clearable:"",maxlength:20,modelValue:o(e).title,"onUpdate:modelValue":n[1]||(n[1]=m=>o(e).title=m),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{sm:12,xs:24},{default:l(()=>[t(i,{label:"菜单类型",prop:"menuType"},{default:l(()=>[t(P,{modelValue:o(e).menuType,"onUpdate:modelValue":n[2]||(n[2]=m=>o(e).menuType=m),onChange:z},{default:l(()=>[t(b,{value:0,label:"目录"}),t(b,{value:1,label:"菜单"}),t(b,{value:2,label:"按钮"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"打开方式"},{default:l(()=>[t(P,{modelValue:o(e).openType,"onUpdate:modelValue":n[3]||(n[3]=m=>o(e).openType=m),disabled:o(e).menuType===0||o(e).menuType===2,onChange:r},{default:l(()=>[t(b,{value:0,label:"组件"}),t(b,{value:1,label:"内嵌"}),t(b,{value:2,label:"外链"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(ue,{style:{margin:"8px 0 22px 0",opacity:"0.6"}}),t(H,{gutter:16},{default:l(()=>[t(p,{sm:12,xs:24},{default:l(()=>[t(i,{label:"菜单图标",prop:"icon"},{default:l(()=>[t(we,{clearable:"",filterable:"popper","popper-width":460,"popper-height":388,"popper-options":{strategy:"fixed"},placeholder:"请选择图标",modelValue:o(e).icon,"onUpdate:modelValue":n[4]||(n[4]=m=>o(e).icon=m),disabled:o(e).menuType===2},null,8,["modelValue","disabled"])]),_:1}),t(i,{prop:"path"},{label:l(()=>[o(e).openType===2?(_(),f(J,{key:0,content:"需要以`http://`、`https://`、`//`开头",placement:"top-start","popper-options":{modifiers:[{name:"offset",options:{offset:[-12,10]}}]}},{default:l(()=>[t(A,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:l(()=>[t(o(L),{style:{opacity:"0.6"}})]),_:1})]),_:1})):F("",!0),B("span",null,K(o(e).openType===2?"外链地址":"路由地址"),1)]),default:l(()=>[t(c,{clearable:"",maxlength:100,modelValue:o(e).path,"onUpdate:modelValue":n[5]||(n[5]=m=>o(e).path=m),disabled:o(e).menuType===2,placeholder:o(e).openType===2?"请输入外链地址":"请输入路由地址"},null,8,["modelValue","disabled","placeholder"])]),_:1}),t(i,{prop:"component"},{label:l(()=>[o(e).openType===1?(_(),f(J,{key:0,content:"需要以`http://`、`https://`、`//`开头",placement:"top-start","popper-options":{modifiers:[{name:"offset",options:{offset:[-12,10]}}]}},{default:l(()=>[t(A,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:l(()=>[t(o(L),{style:{opacity:"0.6"}})]),_:1})]),_:1})):F("",!0),B("span",null,K(o(e).openType===1?"内嵌地址":"组件路径"),1)]),default:l(()=>[t(c,{clearable:"",maxlength:100,modelValue:o(e).component,"onUpdate:modelValue":n[6]||(n[6]=m=>o(e).component=m),disabled:o(e).menuType===0||o(e).menuType===2||o(e).openType===2,placeholder:o(e).openType===1?"请输入内嵌地址":"请输入组件路径"},null,8,["modelValue","disabled","placeholder"])]),_:1})]),_:1}),t(p,{sm:12,xs:24},{default:l(()=>[t(i,{label:"权限标识",prop:"authority"},{default:l(()=>[t(c,{clearable:"",modelValue:o(e).authority,"onUpdate:modelValue":n[7]||(n[7]=m=>o(e).authority=m),placeholder:"请输入权限标识",disabled:o(e).menuType===0||o(e).menuType===1&&o(e).openType===2},null,8,["modelValue","disabled"])]),_:1}),t(i,{label:"排序号",prop:"sortNumber"},{default:l(()=>[t(me,{min:0,max:99999,modelValue:o(e).sortNumber,"onUpdate:modelValue":n[8]||(n[8]=m=>o(e).sortNumber=m),placeholder:"请输入排序号","controls-position":"right",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),t(i,{label:"是否展示"},{default:l(()=>[t(ce,{"inline-prompt":"","active-text":"是","inactive-text":"否","model-value":o(e).hide===0,disabled:o(e).menuType===2,onChange:a},null,8,["model-value","disabled"]),t(J,{content:"选择不展示只注册路由不展示在侧边栏, 比如添加页面应该选择不展示","popper-style":{maxWidth:"240px"}},{default:l(()=>[t(A,{size:15,style:{"margin-left":"16px",cursor:"help"}},{default:l(()=>[t(o(L),{style:{opacity:"0.6"}})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(i,{label:"路由元数据",prop:"meta"},{default:l(()=>[t(c,{rows:4,type:"textarea",maxlength:200,modelValue:o(e).meta,"onUpdate:modelValue":n[9]||(n[9]=m=>o(e).meta=m),placeholder:"请输入JSON格式的路由元数据"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),it=q({name:"SystemMenu",__name:"index",setup(w){const I=T(null),$=T([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"title",label:"菜单名称",slot:"title",minWidth:160},{prop:"path",label:"路由地址",minWidth:160},{prop:"sortNumber",label:"排序",width:100,align:"center"},{prop:"hide",label:"可见",width:100,align:"center",formatter:r=>["是","否"][r.hide]},{prop:"menuType",label:"类型",width:100,align:"center",slot:"menuType",formatter:r=>["菜单","按钮","外链","内嵌","目录"][U(r.path)?2:U(r.component)?3:R(r)?4:r.menuType]},{columnKey:"action",label:"操作",width:180,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),u=T(null),C=T(!1),g=T(),V=T(null),k=async({where:r})=>{const a=await de({...r});return ae({data:a,idField:"menuId",parentIdField:"parentId"})},d=r=>{var a,x;(x=(a=I.value)==null?void 0:a.reload)==null||x.call(a,{where:r})},e=(r,a)=>{u.value=r!=null?r:null,g.value=a,C.value=!0},v=()=>{var r,a;(a=(r=V.value)==null?void 0:r.reloadMenuSelectData)==null||a.call(r)},h=r=>{var a;if((a=r.children)!=null&&a.length){D.error("请先删除子节点");return}$e.confirm("确定要删除“"+r.title+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const x=D.loading({message:"请求中..",plain:!0});Oe(r.menuId).then(N=>{x.close(),D.success(N),d(),v()}).catch(N=>{x.close(),D.error(N.message)})}).catch(()=>{})},M=()=>{var r,a;(a=(r=I.value)==null?void 0:r.toggleRowExpansionAll)==null||a.call(r,!0)},E=()=>{var r,a;(a=(r=I.value)==null?void 0:r.toggleRowExpansionAll)==null||a.call(r,!1)},R=r=>{var a;return!!((a=r.children)!=null&&a.length)&&!r.component},z=()=>{d(),v()};return(r,a)=>{const x=j,N=G,S=Ce,O=Ee,s=re,n=Ne,i=se,c=ye;return _(),f(c,null,{default:l(()=>[t(Be,{onSearch:d}),t(i,{"body-style":{paddingTop:"8px"}},{default:l(()=>[t(n,{sticky:"",ref_key:"tableRef",ref:I,"row-key":"menuId",columns:$.value,datasource:k,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"菜单数据"},"default-expand-all":!1,pagination:!1,"cache-key":"systemMenuTable"},{toolbar:l(()=>[t(x,{type:"primary",class:"ele-btn-icon",icon:o(Me),onClick:a[0]||(a[0]=p=>e())},{default:l(()=>a[2]||(a[2]=[y(" 新建 ")])),_:1},8,["icon"]),t(x,{class:"ele-btn-icon",icon:o(Se),onClick:M},{default:l(()=>a[3]||(a[3]=[y(" 展开全部 ")])),_:1},8,["icon"]),t(x,{class:"ele-btn-icon",icon:o(Ue),onClick:E},{default:l(()=>a[4]||(a[4]=[y(" 折叠全部 ")])),_:1},8,["icon"])]),title:l(({row:p})=>[p.icon?(_(),f(N,{key:0,size:15,style:{"margin-right":"8px","vertical-align":"-2px"}},{default:l(()=>[(_(),f(W(p.icon)))]),_:2},1024)):F("",!0),B("span",null,K(p.title),1)]),menuType:l(({row:p})=>[o(U)(p.path)?(_(),f(S,{key:0,size:"small",type:"danger","disable-transitions":!0},{default:l(()=>a[5]||(a[5]=[y(" 外链 ")])),_:1})):o(U)(p.component)?(_(),f(S,{key:1,size:"small",type:"warning","disable-transitions":!0},{default:l(()=>a[6]||(a[6]=[y(" 内嵌 ")])),_:1})):R(p)?(_(),f(S,{key:2,size:"small","disable-transitions":!0},{default:l(()=>a[7]||(a[7]=[y(" 目录 ")])),_:1})):p.menuType===0?(_(),f(S,{key:3,size:"small",type:"success","disable-transitions":!0},{default:l(()=>a[8]||(a[8]=[y(" 菜单 ")])),_:1})):p.menuType===1?(_(),f(S,{key:4,size:"small",type:"info","disable-transitions":!0},{default:l(()=>a[9]||(a[9]=[y(" 按钮 ")])),_:1})):F("",!0)]),action:l(({row:p})=>[t(O,{type:"primary",underline:!1,onClick:b=>e(null,p.menuId)},{default:l(()=>a[10]||(a[10]=[y(" 添加 ")])),_:2},1032,["onClick"]),t(s,{direction:"vertical"}),t(O,{type:"primary",underline:!1,onClick:b=>e(p)},{default:l(()=>a[11]||(a[11]=[y(" 修改 ")])),_:2},1032,["onClick"]),t(s,{direction:"vertical"}),t(O,{type:"danger",underline:!1,onClick:b=>h(p)},{default:l(()=>a[12]||(a[12]=[y(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),t(qe,{ref_key:"menuEditRef",ref:V,modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=p=>C.value=p),data:u.value,"parent-id":g.value,onDone:z},null,8,["modelValue","data","parent-id"])]),_:1})}}});export{it as default};
