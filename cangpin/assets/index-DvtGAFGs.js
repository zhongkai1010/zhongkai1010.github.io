import{_ as be}from"./index-C5fuAxFq.js";import{d as W,a$ as oe,c as S,o as M,aN as ae,aM as ne,da as xe,w as o,b as e,aH as le,aJ as A,u as i,cz as re,aC as j,h as E,aZ as G,a_ as ye,r as u,a as se,aB as he,a5 as ie,m as w,U as q,R as de,p as Q,k as we,e as P,E as ue,ba as Ve,aV as ze,F as ee,q as ke,l as Ie,t as me,bP as X,au as Y,ar as pe,aE as Z,bM as Ce,b2 as $e,at as te,fa as Ue,f5 as Ee,b6 as De,ei as Re,b7 as J}from"./index-D0yT1AcU.js";import{_ as Me}from"./index-DYf50MRR.js";import{_ as Ne}from"./index-DrzgOVBe.js";import{_ as Te}from"./index-BkoA2sCN.js";import{E as Fe}from"./tree-Bo4y-hh5.js";import{_ as Se}from"./index-C-4uNQQ4.js";import"./index-DFvHHIXI.js";import"./index-CgBmqrP9.js";import"./virtual-list-COxu24hZ.js";import"./index-CybbLoLn.js";import"./index-CZBaXWVt.js";import{E as Be}from"./link-DFO7MjcD.js";import{E as ce,a as fe}from"./col-PPS4Xvy3.js";import{_ as qe}from"./role-select.vue_vue_type_script_setup_true_lang-B4pl-nZi.js";import{_ as Ke}from"./organization-select.vue_vue_type_script_setup_true_lang-4MY6zhcA.js";import{c as Oe,u as Le,a as Pe,p as We,r as je,b as He,l as Je,d as Xe}from"./index-DUSU1QTw.js";import{p as Ye,e as Ze}from"./validate-B_6HX0Io.js";import{_ as Ae}from"./organization-edit.vue_vue_type_script_setup_true_lang-DFDs1Qin.js";import{l as Ge,r as Qe}from"./index-Bm75991C.js";import"./isArrayLikeObject-DbE5rAKf.js";import"./vuedraggable.umd-_mANVixF.js";import"./index-CZqAI4Ft.js";import"./tree-select-TPDKwSbI.js";import"./input-number-CopWbHXe.js";import"./index-P44nefke.js";const et=W({__name:"user-search",emits:["search"],setup(K,{expose:N,emit:C}){const D=C,[_,g]=oe({username:"",nickname:"",sex:void 0}),m=()=>{D("search",{..._})},V=()=>{g(),m()};return N({resetFields:g}),(d,p)=>{const R=A,z=le,$=fe,U=re,k=j,c=ce,a=ae;return M(),S(a,{"label-width":"72px",onKeyup:xe(m,["enter"]),onSubmit:p[3]||(p[3]=ne(()=>{},["prevent"]))},{default:o(()=>[e(c,{gutter:8},{default:o(()=>[e($,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[e(z,{label:"用户账号"},{default:o(()=>[e(R,{clearable:"",modelValue:i(_).username,"onUpdate:modelValue":p[0]||(p[0]=s=>i(_).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[e(z,{label:"用户名"},{default:o(()=>[e(R,{clearable:"",modelValue:i(_).nickname,"onUpdate:modelValue":p[1]||(p[1]=s=>i(_).nickname=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[e(z,{label:"性别"},{default:o(()=>[e(U,{code:"sex",modelValue:i(_).sex,"onUpdate:modelValue":p[2]||(p[2]=s=>i(_).sex=s),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[e(z,{"label-width":"16px"},{default:o(()=>[e(k,{type:"primary",onClick:m},{default:o(()=>p[4]||(p[4]=[E("查询")])),_:1}),e(k,{onClick:V},{default:o(()=>p[5]||(p[5]=[E("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),tt=W({__name:"user-edit",props:G({data:{},organizationId:{},organizationData:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:G(["done"],["update:modelValue"]),setup(K,{emit:N}){const C=K,D=N,_=ye(K,"modelValue"),g=u(!1),m=u(!1),V=u(null),[d,p,R]=oe({userId:void 0,organizationId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),z=se({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(c,a,s)=>{var x;Oe("username",a,(x=C.data)==null?void 0:x.userId).then(()=>{s(new Error("账号已经存在"))}).catch(()=>{s()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"change"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"change"}],email:[{pattern:Ze,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(c,a,s)=>{if(g.value||/^[\S]{5,18}$/.test(a))return s();s(new Error("密码必须为5-18位非空白字符"))}}],phone:[{pattern:Ye,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),$=()=>{_.value=!1},U=()=>{var c,a;(a=(c=V.value)==null?void 0:c.validate)==null||a.call(c,s=>{if(!s)return;m.value=!0,(g.value?Le:Pe)(d).then(I=>{m.value=!1,w.success(I),$(),D("done")}).catch(I=>{m.value=!1,w.error(I.message)})})},k=()=>{C.data?(R({...C.data,password:""}),g.value=!0):(p(),d.organizationId=C.organizationId,g.value=!1),q(()=>{q(()=>{var c,a;(a=(c=V.value)==null?void 0:c.clearValidate)==null||a.call(c)})})};return(c,a)=>{const s=le,x=A,I=re,B=fe,r=ce,n=ae,f=j,v=he;return M(),S(v,{form:"",width:640,modelValue:_.value,"onUpdate:modelValue":a[10]||(a[10]=t=>_.value=t),title:g.value?"修改用户":"新建用户",onOpen:k},{footer:o(()=>[e(f,{onClick:$},{default:o(()=>a[11]||(a[11]=[E("取消")])),_:1}),e(f,{type:"primary",loading:m.value,onClick:U},{default:o(()=>a[12]||(a[12]=[E(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[e(n,{ref_key:"formRef",ref:V,model:i(d),rules:z,"label-width":"80px",onSubmit:a[9]||(a[9]=ne(()=>{},["prevent"]))},{default:o(()=>[e(r,{gutter:16},{default:o(()=>[e(B,{sm:12,xs:24},{default:o(()=>[e(s,{label:"所属机构"},{default:o(()=>[e(Ke,{modelValue:i(d).organizationId,"onUpdate:modelValue":a[0]||(a[0]=t=>i(d).organizationId=t),"organization-data":c.organizationData},null,8,["modelValue","organization-data"])]),_:1}),e(s,{label:"用户账号",prop:"username"},{default:o(()=>[e(x,{clearable:"",maxlength:20,modelValue:i(d).username,"onUpdate:modelValue":a[1]||(a[1]=t=>i(d).username=t),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),e(s,{label:"用户名",prop:"nickname"},{default:o(()=>[e(x,{clearable:"",maxlength:20,modelValue:i(d).nickname,"onUpdate:modelValue":a[2]||(a[2]=t=>i(d).nickname=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(s,{label:"性别",prop:"sex"},{default:o(()=>[e(I,{code:"sex",modelValue:i(d).sex,"onUpdate:modelValue":a[3]||(a[3]=t=>i(d).sex=t),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),e(s,{label:"角色",prop:"roles"},{default:o(()=>[e(qe,{modelValue:i(d).roles,"onUpdate:modelValue":a[4]||(a[4]=t=>i(d).roles=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{sm:12,xs:24},{default:o(()=>[e(s,{label:"手机号",prop:"phone"},{default:o(()=>[e(x,{clearable:"",maxlength:11,modelValue:i(d).phone,"onUpdate:modelValue":a[5]||(a[5]=t=>i(d).phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(s,{label:"邮箱",prop:"email"},{default:o(()=>[e(x,{clearable:"",maxlength:100,modelValue:i(d).email,"onUpdate:modelValue":a[6]||(a[6]=t=>i(d).email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),g.value?ie("",!0):(M(),S(s,{key:0,label:"登录密码",prop:"password"},{default:o(()=>[e(x,{"show-password":"",type:"password",maxlength:20,modelValue:i(d).password,"onUpdate:modelValue":a[7]||(a[7]=t=>i(d).password=t),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),e(s,{label:"个人简介"},{default:o(()=>[e(x,{type:"textarea",rows:3,maxlength:200,modelValue:i(d).introduction,"onUpdate:modelValue":a[8]||(a[8]=t=>i(d).introduction=t),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),ot=W({__name:"user-list",props:{organizationId:{},organizationData:{}},setup(K){const N=K,C=u(null),D=u(null),_=u([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"sexName",label:"性别",sortable:"custom",width:90,align:"center"},{columnKey:"roles",label:"角色",minWidth:120,slot:"roles",align:"center",formatter:r=>r.roles.map(n=>n.roleName).join(",")},{prop:"createTime",label:"创建时间",sortable:"custom",width:180,align:"center"},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status",formatter:r=>r.status==0?"正常":"冻结"},{columnKey:"action",label:"操作",width:128,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),g=u([]),m=u(null),V=u(!1),d=({pages:r,where:n,orders:f})=>We({...n,...f,...r,organizationId:N.organizationId}),p=r=>{var n,f;(f=(n=D.value)==null?void 0:n.reload)==null||f.call(n,{page:1,where:r})},R=r=>{m.value=r!=null?r:null,V.value=!0},z=r=>{const n=r==null?g.value:[r];if(!n.length){w.error("请至少选择一条数据");return}Z.confirm("确定要删除“"+n.map(f=>f.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const f=w.loading({message:"请求中..",plain:!0});je(n.map(v=>v.userId)).then(v=>{f.close(),w.success(v),p()}).catch(v=>{f.close(),w.error(v.message)})}).catch(()=>{})},$=(r,n)=>{const f=r?0:1;He(n.userId,f).then(v=>{n.status=f,w.success(v)}).catch(v=>{w.error(v.message)})};de(()=>N.organizationId,()=>{var r,n;(n=(r=C.value)==null?void 0:r.resetFields)==null||n.call(r),p({})});const U=({where:r,orders:n})=>Je({...r,...n,organizationId:N.organizationId}),k=u(null),c=u([]),a=u();let s=null;const x=r=>[{title:"重置密码",command:"password"},{title:"删除用户",command:"delete",divided:!0,danger:!0}],I=(r,n)=>{r==null||a.value===r||s!=null&&s===n||(k.value&&k.value.handleClose(),q(()=>{s=n,c.value=x()||[],a.value=r,c.value.length&&q(()=>{k.value&&k.value.handleOpen()})}))},B=r=>{if(s==null)return;const n=s;r==="delete"?z(n):r==="password"&&Z.prompt(`请输入用户"${n.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:f})=>{const v=w.loading({message:"请求中..",plain:!0});Xe(n.userId,f).then(t=>{v.close(),w.success(t)}).catch(t=>{v.close(),w.error(t.message)})}).catch(()=>{})};return(r,n)=>{const f=j,v=Ie,t=ze,l=Be,y=we,b=ue,O=Se,H=pe;return M(),Q(ee,null,[e(et,{ref_key:"searchRef",ref:C,style:{"margin-bottom":"-14px"},onSearch:p},null,512),e(O,{ref_key:"tableRef",ref:D,"row-key":"userId",columns:_.value,datasource:d,"show-overflow-tooltip":!0,selections:g.value,"onUpdate:selections":n[2]||(n[2]=h=>g.value=h),"highlight-current-row":!0,"export-config":{fileName:"用户数据",datasource:U},"print-config":{datasource:U},style:{paddingBottom:"16px"},"cache-key":"listUserTable"},{toolbar:o(()=>[e(f,{type:"primary",class:"ele-btn-icon",icon:i(X),onClick:n[0]||(n[0]=h=>R())},{default:o(()=>n[4]||(n[4]=[E(" 新建 ")])),_:1},8,["icon"]),e(f,{type:"danger",class:"ele-btn-icon",icon:i(Y),onClick:n[1]||(n[1]=h=>z())},{default:o(()=>n[5]||(n[5]=[E(" 删除 ")])),_:1},8,["icon"])]),roles:o(({row:h})=>[(M(!0),Q(ee,null,ke(h.roles,T=>(M(),S(v,{key:T.roleId,size:"small","disable-transitions":!0},{default:o(()=>[E(me(T.roleName),1)]),_:2},1024))),128))]),status:o(({row:h})=>[e(t,{size:"small","model-value":h.status===0,onChange:T=>$(T,h)},null,8,["model-value","onChange"])]),action:o(({row:h})=>[e(l,{type:"primary",underline:!1,onClick:T=>R(h)},{default:o(()=>n[6]||(n[6]=[E(" 修改 ")])),_:2},1032,["onClick"]),e(y,{direction:"vertical"}),e(l,{type:"primary",underline:!1,onMouseenter:T=>I(T.currentTarget,h)},{default:o(()=>[n[7]||(n[7]=P("span",null,"更多",-1)),e(b,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:o(()=>[e(i(Ve))]),_:1})]),_:2},1032,["onMouseenter"])]),_:1},8,["columns","selections","export-config","print-config"]),e(tt,{data:m.value,modelValue:V.value,"onUpdate:modelValue":n[3]||(n[3]=h=>V.value=h),"organization-id":r.organizationId,"organization-data":r.organizationData,onDone:p},null,8,["data","modelValue","organization-id","organization-data"]),e(H,{ref_key:"moreDropdownRef",ref:k,trigger:"hover",triggerKeys:[],persistent:!1,componentType:"pro",virtualTriggering:!0,virtualRef:a.value,disabled:!c.value.length,items:c.value,onCommand:B},null,8,["virtualRef","disabled","items"])],64)}}}),at={style:{padding:"0 16px 12px 0"}},nt={style:{"margin-bottom":"12px"}},lt={class:"el-tree-node__label",style:{"margin-top":"2px"}},Rt=W({name:"ListUser",__name:"index",setup(K){const{mobile:N}=Ce(),C=u(null),D=u(null),_=u(!0),g=u([]),m=u(null),V=u(""),d=u(!1),p=u(null),R=u(),z=()=>{_.value=!0,Ge().then(t=>{_.value=!1,g.value=De({data:t,idField:"organizationId",parentIdField:"parentId"}),q(()=>{$(g.value[0])})}).catch(t=>{_.value=!1,w.error(t.message)})},$=t=>{var l,y,b,O;m.value!=null&&N.value&&((y=(l=C.value)==null?void 0:l.toggleCollapse)==null||y.call(l,!0)),t&&t.organizationId?(m.value=t,(O=(b=D.value)==null?void 0:b.setCurrentKey)==null||O.call(b,t.organizationId)):m.value=null},U=(t,l)=>{p.value=t!=null?t:null,R.value=l,d.value=!0},k=t=>{const l=t;l&&Z.confirm(`确定要删除“${l.organizationName}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const y=w.loading({message:"请求中..",plain:!0});Qe(l.organizationId).then(b=>{y.close(),w.success(b),z()}).catch(b=>{y.close(),w.error(b.message)})}).catch(()=>{})},c=(t,l)=>t?!!(l.organizationName&&l.organizationName.includes(t)):!0;de(V,t=>{var l,y;(y=(l=D.value)==null?void 0:l.filter)==null||y.call(l,t)}),z();const a=u(null),s=u([]),x=u();let I=null;const B=se({marginLeft:"0px"}),r=t=>[{title:"添加下级",command:"add",icon:J(X)},{title:"修改机构",command:"edit",icon:J(te)},{title:"删除机构",command:"del",icon:J(Y),divided:!0,danger:!0}],n=(t,l)=>{a.value&&a.value.handleClose(),q(()=>{I=l,s.value=r()||[],x.value=t,s.value.length&&q(()=>{a.value&&a.value.handleOpen()})})},f=t=>{I!=null&&(t==="add"?U(void 0,I.organizationId):t==="edit"?U(I):t==="del"&&k(I))},v=(t,l)=>{const y=Re(t.currentTarget,"el-tree-node__content"),b=y.getBoundingClientRect();B.marginLeft=`${t.clientX-b.left-b.width/2}px`,n(y,l)};return(t,l)=>{const y=A,b=j,O=ue,H=Fe,h=Te,T=Ne,ge=Me,_e=pe,ve=be;return M(),S(ve,{"flex-table":"","multi-card":!1,"hide-footer":"",style:{"min-height":"420px"}},{default:o(()=>[e(ge,{"flex-table":"","body-style":{padding:"0 0 0 16px",overflow:"hidden"}},{default:o(()=>[e(T,{ref_key:"splitRef",ref:C,"flex-table":"",size:"256px","allow-collapse":"","custom-style":{borderWidth:"0 1px 0 0",padding:"16px 0"},"body-style":{padding:"16px 16px 0 0",overflow:"hidden"},style:{height:"100%",overflow:"visible"}},{body:o(()=>[m.value?(M(),S(ot,{key:0,"organization-id":m.value.organizationId,"organization-data":g.value},null,8,["organization-id","organization-data"])):ie("",!0)]),default:o(()=>[P("div",at,[e(y,{clearable:"",maxlength:20,modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=F=>V.value=F),placeholder:"左侧树还支持鼠标右键","prefix-icon":i($e)},null,8,["modelValue","prefix-icon"])]),P("div",nt,[e(b,{type:"primary",class:"ele-btn-icon",icon:i(X),onClick:l[1]||(l[1]=F=>{var L;return U(void 0,(L=m.value)==null?void 0:L.organizationId)})},{default:o(()=>l[5]||(l[5]=[E(" 新建 ")])),_:1},8,["icon"]),e(b,{type:"warning",disabled:!m.value,class:"ele-btn-icon",icon:i(te),onClick:l[2]||(l[2]=F=>U(m.value))},{default:o(()=>l[6]||(l[6]=[E(" 修改 ")])),_:1},8,["disabled","icon"]),e(b,{type:"danger",disabled:!m.value,class:"ele-btn-icon",icon:i(Y),onClick:l[3]||(l[3]=F=>k(m.value))},{default:o(()=>l[7]||(l[7]=[E(" 删除 ")])),_:1},8,["disabled","icon"])]),e(h,{loading:_.value,style:{flex:1,paddingRight:"16px",overflow:"auto"}},{default:o(()=>[e(H,{ref_key:"treeRef",ref:D,data:g.value,"highlight-current":"","node-key":"organizationId",props:{label:"organizationName"},"expand-on-click-node":!1,"default-expand-all":!0,"filter-node-method":c,style:{"--ele-tree-item-height":"34px"},onNodeClick:$,onNodeContextmenu:v},{default:o(F=>[e(O,{style:{"margin-right":"6px",color:"#ffd659","font-size":"16px"}},{default:o(()=>{var L;return[(L=F.data.children)!=null&&L.length?(M(),S(i(Ue),{key:0,style:{fill:"currentColor"}})):(M(),S(i(Ee),{key:1,style:{transform:"scale(0.9) translateY(1px)",color:"#faad14"}}))]}),_:2},1024),P("span",lt,me(F.data.organizationName),1)]),_:1},8,["data"])]),_:1},8,["loading"])]),_:1},512)]),_:1}),e(Ae,{modelValue:d.value,"onUpdate:modelValue":l[4]||(l[4]=F=>d.value=F),data:p.value,"organization-id":R.value,"organization-data":g.value,onDone:z},null,8,["modelValue","data","organization-id","organization-data"]),e(_e,{ref_key:"ctxMenuDropdownRef",ref:a,trigger:"contextmenu","trigger-keys":[],"icon-props":{size:15},"popper-options":{strategy:"fixed",modifiers:[{name:"offset",options:{offset:[0,-4]}}]},persistent:!1,"component-type":"pro","prevent-contextmenu":!0,"virtual-triggering":!0,"virtual-ref":x.value,disabled:!s.value.length,items:s.value,"popper-style":B,onCommand:f},null,8,["virtual-ref","disabled","items","popper-style"])]),_:1})}}});export{Rt as default};
