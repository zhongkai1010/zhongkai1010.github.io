import{bC as B,L as T,d as x,O as U,r as j,K as R,S as V,U as k,c as A,o as p,e as l,q as g,a6 as v,a8 as y,a2 as w,b as N,w as _,es as q,a7 as F,eA as M,V as D}from"./index-BUAqAxXK.js";const $="ele-printer-container",O="ele-printer-iframe",h="ele-printing";let S=0;function I(e,n){return e==null?n:Object.assign({},e,n)}function L(){const e=document.getElementById($);if(e)return e;const n=document.createElement("div");return n.id=$,document.body.appendChild(n),n}function C(e){const n=["@page {"];if(e.margin!=null&&e.margin!==""){const o=typeof e.margin=="number"?e.margin+"px":e.margin;n.push(`margin: ${o};`)}return e.direction!=null&&e.direction!==""&&n.push(`size: ${e.direction};`),e.orientation!=null&&e.orientation!==""&&n.push(`page-orientation: ${e.orientation};`),n.push("}"),n.join(" ")}function P(){const e=document.getElementById(O);if(e){e.parentNode&&e.parentNode.removeChild(e);const n=e.getAttribute("src");if(n)try{window.URL.revokeObjectURL(n)}catch(o){console.error(o)}}}function E(){P();const e=document.createElement("iframe");return e.id=O,e.style.width="66px",e.style.height="66px",e.style.position="fixed",e.style.left="-666px",e.style.top="-666px",document.body.appendChild(e),e.focus(),e}function H(e,n,o){var t;const s=E(),c=s.contentWindow;if(!c)return;c.focus();const i=s.contentDocument||c.document;if(!i)return;const d=L();Array.from(d.querySelectorAll('input[type="text"], input[type="number"]')).forEach(r=>{r.setAttribute("value",r.value)}),i.open();const u=e.options?`JSON.parse('${JSON.stringify(e.options)}')`:"",a=`
  <style type="text/css" media="print">
    ${C(e)}
  </style>
  <script>
    const $html = document.querySelector('html');
    if($html && $html.classList && $html.classList.add) {
      $html.classList.add('${h}');
    }
    window.onload = function() {
      if(${e.title==null?0:1}) {
        document.title = '${e.title}';
      }
      setTimeout(() => {
        window.print(${u});
        window.parent.postMessage('elePrintDone_${n}', '*');
      ${"}, "+o+");"}
    };
  <\/script>
  `,f=(((t=document.querySelector("html"))==null?void 0:t.outerHTML)||"").replace(/<script/g,'<textarea style="display:none;" ').replace(/<\/script>/g,"</textarea>").replace(/<\/html>/,a+"</html>");return i.write("<!DOCTYPE html>"+f),i.close(),c}function W(e){S++;const n=S,o=500,[t]=B(o),s=(i,d)=>{if(d==="_iframe"){H(i,n,o);return}const u=document.querySelector("html");if(!u){e&&e();return}u.classList.add(h);const a=document.createElement("style");a.setAttribute("type","text/css"),a.setAttribute("media","print"),a.innerHTML=C(i),document.body.appendChild(a);const m=document.title;i.title!=null&&i.title!==""&&(document.title=i.title),t(()=>{window.print(i.options),t(()=>{u.classList.remove(h),document.body.removeChild(a),i.title!=null&&(document.title=m),e&&e()})})},c=i=>{i.data===`elePrintDone_${n}`&&t(()=>{P(),e&&e()})};return T(()=>{window.removeEventListener("message",c)}),window.addEventListener("message",c),s}function Y(e){const n=E();n.onload=()=>{const t=n.getAttribute("src");if(t){n.focus();try{n.contentWindow&&n.contentWindow.print(e.options),e.done&&e.done(),window.URL.revokeObjectURL(t);return}catch(s){console.error(s)}!e.arraybuffer&&e.url?(window.URL.revokeObjectURL(t),window.open(e.url)):window.open(t),e.done&&e.done()}};const o=t=>{const s=new window.Blob([t],{type:"application/pdf"});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(s,"print.pdf"),e.done&&e.done();return}n.setAttribute("src",window.URL.createObjectURL(s))};if(e.arraybuffer){o(e.arraybuffer);return}if(e.url){const t=new window.XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=()=>{if([200,201].indexOf(t.status)!==-1){o(t.response);return}e.error&&e.error(t.status,t.statusText)},t.send()}}const z={modelValue:Boolean,headerStyle:Object,bodyStyle:Object,footerStyle:Object,title:String,margin:[String,Number],direction:String,orientation:String,target:String,static:Boolean,options:Object},J={"update:modelValue":e=>!0,done:()=>!0},G={key:0},K={key:1},Q=x({name:"ElePrinter",__name:"index",props:z,emits:J,setup(e,{expose:n,emit:o}){const t=e,s=o,c=W(()=>{d.value=!1,f(!1),m()}),i=U(L()),d=j(!1),u=R(()=>t.static),a=r=>{d.value||(d.value=!0,D(()=>{const b={title:t.title,margin:t.margin,direction:t.direction,orientation:t.orientation,options:I(t.options,r)};c(b,t.target)}))},m=()=>{s("done")},f=r=>{s("update:modelValue",r)};return V(()=>t.modelValue,r=>{r&&a()}),k(()=>{t.modelValue&&a()}),n({print:a}),(r,b)=>(p(),A(M,{to:i.value,disabled:u.value&&!d.value},[l("table",{class:F(["ele-printer",{"is-open":d.value},{"is-static":u.value}])},[r.$slots.header?(p(),g("thead",G,[l("tr",null,[l("td",null,[l("div",{class:"ele-printer-header",style:y(r.headerStyle)},[w(r.$slots,"header")],4)])])])):v("",!0),l("tbody",null,[l("tr",null,[l("td",null,[N(q,{class:"ele-printer-body",style:y(r.bodyStyle)},{default:_(()=>[w(r.$slots,"default")]),_:3},8,["style"])])])]),r.$slots.footer?(p(),g("tfoot",K,[l("tr",null,[l("td",null,[l("div",{class:"ele-printer-footer",style:y(r.footerStyle)},[w(r.$slots,"footer")],4)])])])):v("",!0)],2)],8,["to","disabled"]))}});export{Q as _,Y as p};
