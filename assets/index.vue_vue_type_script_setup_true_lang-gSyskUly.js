import{d as V,a$ as $,b0 as M,c as B,o as E,aJ as R,q as D,w as N,a1 as F,bX as z,bY as W,m as I,r as T,R as U}from"./index-DuSeLP2O.js";import"./index-CkiP3D61.js";import"./upload-Britqp8q.js";import"./progress-CW57Qzxn.js";import{g as q}from"./index.vue_vue_type_style_index_0_lang-Bro6-fet.js";import{u as A}from"./index-BgAAIbUv.js";const j=V({name:"CommonUpload",__name:"index",props:$({fileLimit:{default:100},readonly:{type:Boolean},disabled:{type:Boolean},preview:{type:Boolean,default:!0},limit:{},multiple:{type:Boolean},drag:{type:Boolean,default:!0},accept:{default:""},itemStyle:{},buttonStyle:{},sortable:{type:[Boolean,Object],default:()=>({forceFallback:!0})},imageProps:{},progressProps:{},previewProps:{},tools:{type:Boolean,default:!0},listType:{},beforeUploadClick:{},beforeItemEdit:{},beforePreview:{},locale:{}},{modelValue:{type:Array,default:()=>[]},modelModifiers:{}}),emits:$(["itemClick","preview"],["update:modelValue"]),setup(b,{emit:v}){const y=b,p=v,d=M(b,"modelValue"),n=l=>{if(l){if(y.accept==="image/*"){if(!l.type.startsWith("image")){I.error("只能选择图片");return}}else if(y.accept===".xls,.xlsx"&&!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type)){I.error("只能选择 excel 文件");return}if(y.fileLimit&&l.size/1024/1024>y.fileLimit){I.error(`大小不能超过 ${y.fileLimit}MB`);return}return!0}},c=(l,t)=>{if(!l.file||!n(l.file))return;t||d.value.push({...l});const s=d.value.find(e=>e.key===l.key);s&&(s.status="uploading",s.progress=0,A(l.file,{onUploadProgress:e=>{e.total!=null&&s.status!=="done"&&(s.progress=e.loaded/e.total*100)}}).then(e=>{s.progress=100,s.status="done",s.url=e.url}).catch(e=>{s.status="exception",I.error(e.message)}))},P=({item:l,newItem:t})=>{if(!n(t.file))return;const s=d.value.find(e=>e.key===l.key);s&&(s.url=void 0,s.name=t.name,s.file=t.file,s.progress=0,s.status=void 0,c(s,!0))},h=l=>{d.value.splice(d.value.indexOf(l),1)},w=l=>{p("itemClick",l)},k=l=>{p("preview",l)};return(l,t)=>{const s=q;return E(),B(s,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),readonly:l.readonly,disabled:l.disabled,preview:l.preview,limit:l.limit,multiple:l.multiple,drag:l.drag,accept:l.accept,itemStyle:l.itemStyle,buttonStyle:l.buttonStyle,sortable:l.sortable,imageProps:l.imageProps,progressProps:l.progressProps,previewProps:l.previewProps,tools:l.tools,listType:l.listType,beforeUploadClick:l.beforeUploadClick,beforeItemEdit:l.beforeItemEdit,beforePreview:l.beforePreview,locale:l.locale,onUpload:c,onRetry:t[1]||(t[1]=e=>c(e,!0)),onRemove:h,onEditUpload:P,onItemClick:w,onPreview:k},R({_:2},[D(Object.keys(l.$slots),e=>({name:e,fn:N(r=>[F(l.$slots,e,z(W(r||{})))])}))]),1032,["modelValue","readonly","disabled","preview","limit","multiple","drag","accept","itemStyle","buttonStyle","sortable","imageProps","progressProps","previewProps","tools","listType","beforeUploadClick","beforeItemEdit","beforePreview","locale"])}}}),Z=V({name:"ImageUpload",__name:"index",props:{modelValue:{},fileLimit:{default:100},readonly:{type:Boolean},disabled:{type:Boolean},preview:{type:Boolean,default:!0},limit:{},multiple:{type:Boolean},drag:{type:Boolean,default:!0},accept:{default:"image/*"},itemStyle:{},buttonStyle:{},sortable:{type:[Boolean,Object],default:()=>({forceFallback:!0})},imageProps:{},progressProps:{},previewProps:{},tools:{type:Boolean,default:!0},listType:{},beforeUploadClick:{},beforeItemEdit:{},locale:{}},emits:["update:modelValue","change"],setup(b,{expose:v,emit:y}){const p=b,d=y,n=T([]),c=t=>{var r;const s=(r=p.modelValue)!=null?r:"",e=t!=null?t:"";s!==e&&(d("update:modelValue",e),d("change",t))},P=()=>{n.value=[]},h=()=>!n.value.some(t=>t.status!=="done"),w=t=>{const s=[];return t.forEach(e=>{e.status==="done"&&e.url!=null&&s.push(e.url)}),s},k=(t,s)=>{if(!t)return s.filter(r=>r.status!=="done");const e=[];if(p.limit===1)return e.push({key:`0-${t}`,url:t,status:"done"}),e;try{const r=JSON.parse(t);if(s.forEach(o=>{(o.url&&r.includes(o.url)||o.status!=="done")&&e.push(o)}),r.forEach((o,a)=>{if(o&&!e.some(u=>u.url===o)){const u=`${a}-${o}`,m=e.findIndex(i=>i.key===u);m!==-1&&e.splice(m,1),e.push({key:u,url:o,status:"done"})}}),p.limit!=null&&e.length>p.limit){const o=e.filter(a=>a.status!=="done");for(const a of o){const u=e.indexOf(a);if(e.splice(u,1),e.length<=p.limit)break}}}catch(r){console.error(r),s.forEach(o=>{o.status!=="done"&&e.push(o)})}return e},l=(t,s)=>{if(t.length!==s.length)return!0;for(let e=0;e<t.length;e++){const r=t[e],o=s[e];if(r.key!==o.key||r.url!==o.url||r.status!==o.status)return!0}return!1};return U(n,t=>{const s=w(t);if(p.limit===1){c(s.join());return}c(s.length?JSON.stringify(s):"")},{deep:!0}),U(()=>p.modelValue,t=>{const s=k(t,n.value);l(s,n.value)&&(n.value=s)},{immediate:!0}),v({clearData:P,isDone:h}),(t,s)=>(E(),B(j,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value=e),fileLimit:t.fileLimit,readonly:t.readonly,disabled:t.disabled,preview:t.preview,limit:t.limit,multiple:t.multiple,drag:t.drag,accept:t.accept,itemStyle:t.itemStyle,buttonStyle:t.buttonStyle,sortable:t.sortable,imageProps:t.imageProps,progressProps:t.progressProps,previewProps:t.previewProps,tools:t.tools,listType:t.listType,beforeUploadClick:t.beforeUploadClick,beforeItemEdit:t.beforeItemEdit,locale:t.locale},null,8,["modelValue","fileLimit","readonly","disabled","preview","limit","multiple","drag","accept","itemStyle","buttonStyle","sortable","imageProps","progressProps","previewProps","tools","listType","beforeUploadClick","beforeItemEdit","locale"]))}}),x=V({name:"FileUpload",__name:"index",props:{modelValue:{},fileLimit:{default:100},readonly:{type:Boolean},disabled:{type:Boolean},preview:{type:Boolean,default:!0},limit:{},multiple:{type:Boolean},drag:{type:Boolean,default:!0},accept:{default:""},itemStyle:{},buttonStyle:{},sortable:{type:[Boolean,Object],default:()=>({forceFallback:!0})},imageProps:{},progressProps:{},previewProps:{},tools:{type:Boolean,default:!0},listType:{default:"file"},beforeUploadClick:{},beforeItemEdit:{},locale:{}},emits:["update:modelValue","change"],setup(b,{expose:v,emit:y}){const p=b,d=y,n=T([]),c=e=>{var a,u;const r=e?e.split("."):[],o=r.length<=1||r[0]===""&&r.length===2?"":(u=(a=r.pop())==null?void 0:a.toLowerCase)==null?void 0:u.call(a);return o&&["png","jpg","jpeg","gif","svg"].includes(o)},P=e=>{if(!c(e.url))return e.url?window.open(e.url):e.file&&!e.file.type.startsWith("image")&&window.open(URL.createObjectURL(e.file)),!1},h=e=>{var a;const r=(a=p.modelValue)!=null?a:"",o=e!=null?e:"";r!==o&&(d("update:modelValue",o),d("change",e))},w=()=>{n.value=[]},k=()=>!n.value.some(e=>e.status!=="done"),l=e=>{const r=[];return e.forEach(o=>{o.status==="done"&&o.url!=null&&r.push({url:o.url,name:o.name})}),r},t=(e,r)=>{var a,u;if(!e)return r.filter(m=>m.status!=="done");const o=[];if(p.limit===1){try{const i=JSON.parse(e);if(i){const f=(a=i.url)!=null?a:"";return o.push({key:`0-${f}`,url:f,name:(u=i.name)!=null?u:"",status:"done",thumbnail:c(f)}),o}}catch(i){console.error(i)}const m=r.find(i=>i.status!=="done");return m!=null&&o.push(m),o}try{const m=JSON.parse(e);if(r.forEach(i=>{(i.url&&m.some(f=>f.url===i.url)||i.status!=="done")&&o.push(i)}),m.forEach((i,f)=>{var C,L;const g=(C=i==null?void 0:i.url)!=null?C:"";if(g&&!o.some(S=>S.url===g)){const S=`${f}-${g}`,O=o.findIndex(J=>J.key===S);O!==-1&&o.splice(O,1),o.push({key:S,url:g,name:(L=i.name)!=null?L:"",status:"done",thumbnail:c(g)})}}),p.limit!=null&&o.length>p.limit){const i=o.filter(f=>f.status!=="done");for(const f of i){const g=o.indexOf(f);if(o.splice(g,1),o.length<=p.limit)break}}}catch(m){console.error(m),r.forEach(i=>{i.status!=="done"&&o.push(i)})}return o},s=(e,r)=>{if(e.length!==r.length)return!0;for(let o=0;o<e.length;o++){const a=e[o],u=r[o];if(a.key!==u.key||a.name!==u.name||a.url!==u.url||a.status!==u.status)return!0}return!1};return U(n,e=>{const r=l(e);if(p.limit===1){h(r.length?JSON.stringify(r[0]):"");return}h(r.length?JSON.stringify(r):"")},{deep:!0}),U(()=>p.modelValue,e=>{const r=t(e,n.value);s(r,n.value)&&(n.value=r)},{immediate:!0}),v({clearData:w,isDone:k}),(e,r)=>(E(),B(j,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=o=>n.value=o),fileLimit:e.fileLimit,readonly:e.readonly,disabled:e.disabled,preview:e.preview,limit:e.limit,multiple:e.multiple,drag:e.drag,accept:e.accept,itemStyle:e.itemStyle,buttonStyle:e.buttonStyle,sortable:e.sortable,imageProps:e.imageProps,progressProps:e.progressProps,previewProps:e.previewProps,tools:e.tools,listType:e.listType,beforeUploadClick:e.beforeUploadClick,beforeItemEdit:e.beforeItemEdit,beforePreview:P,locale:e.locale},null,8,["modelValue","fileLimit","readonly","disabled","preview","limit","multiple","drag","accept","itemStyle","buttonStyle","sortable","imageProps","progressProps","previewProps","tools","listType","beforeUploadClick","beforeItemEdit","locale"]))}});export{Z as _,x as a};
