import{_ as M}from"./index-DWvwq9vJ.js";import{d as W,b1 as $,r as V,c as b,o as y,w as o,b as a,aI as z,aK as D,u as E,aD as C,h as p,aN as S,dc as B,aO as I,s as N,a as O,a5 as P,l as F,ba as L,m as R,aZ as Y,a_ as U}from"./index-CrqWW_BJ.js";import{_ as K}from"./index-CvmJHak0.js";import{_ as j}from"./index-DZfDZC4R.js";import"./index-D6CwktmT.js";import"./index-Bp1QOJoN.js";import"./index-CEM6Hg_V.js";import"./virtual-list-Ch59zG_E.js";import"./index-BQgcF97Z.js";import"./index-DKWhND12.js";import{E as J,a as Z}from"./col-CWm2Lcpo.js";import{E as q}from"./date-picker-DLDjn9lF.js";import"./isArrayLikeObject-BrHzZ_Q4.js";import"./vuedraggable.umd-gs1jzkQf.js";import"./arrays-DRUcygxz.js";import"./index-DKaHpq4_.js";const A=W({__name:"login-record-search",props:{where:{}},emits:["search"],setup(f,{emit:n}){const h=f,T=n,[u,v]=$({username:"",nickname:"",...h.where||{}}),_=V(["",""]),r=()=>{const[s,t]=_.value||[];T("search",{...u,createTimeStart:s?`${s} 00:00:00`:"",createTimeEnd:t?`${t} 23:59:59`:""})},e=()=>{v(),_.value=["",""],r()};return(s,t)=>{const g=D,d=z,i=Z,m=q,c=C,l=J,w=I,x=K;return y(),b(x,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[a(w,{"label-width":"72px",onKeyup:B(r,["enter"]),onSubmit:t[3]||(t[3]=S(()=>{},["prevent"]))},{default:o(()=>[a(l,{gutter:8},{default:o(()=>[a(i,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(d,{label:"用户账号"},{default:o(()=>[a(g,{clearable:"",modelValue:E(u).username,"onUpdate:modelValue":t[0]||(t[0]=k=>E(u).username=k),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(d,{label:"用户名"},{default:o(()=>[a(g,{clearable:"",modelValue:E(u).nickname,"onUpdate:modelValue":t[1]||(t[1]=k=>E(u).nickname=k),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(d,{label:"登录时间"},{default:o(()=>[a(m,{"unlink-panels":"",type:"daterange",modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=k=>_.value=k),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),a(i,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(d,{"label-width":"16px"},{default:o(()=>[a(c,{type:"primary",onClick:r},{default:o(()=>t[4]||(t[4]=[p("查询")])),_:1}),a(c,{onClick:e},{default:o(()=>t[5]||(t[5]=[p("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});async function G(f){const n=await N.get("/system/login-record/page",{params:f});return n.data.code===0?n.data.data:Promise.reject(new Error(n.data.message))}async function H(f){const n=await N.get("/system/login-record",{params:f});return n.data.code===0&&n.data.data?n.data.data:Promise.reject(new Error(n.data.message))}const fe=W({name:"SystemLoginRecord",__name:"index",setup(f){const n=O({username:"",nickname:""}),h=V(null),T=V([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"ip",label:"IP地址",sortable:"custom",minWidth:110},{prop:"device",label:"设备型号",sortable:"custom",minWidth:110},{prop:"os",label:"操作系统",sortable:"custom",minWidth:110},{prop:"browser",label:"浏览器",sortable:"custom",minWidth:110},{prop:"loginType",label:"操作类型",sortable:"custom",width:130,slot:"loginType",filters:[{text:"登录成功",value:"0"},{text:"登录失败",value:"1"},{text:"退出登录",value:"2"},{text:"刷新TOKEN",value:"3"}],filterMultiple:!1,align:"center",formatter:r=>["登录成功","登录失败","退出登录","刷新TOKEN"][r.loginType]},{prop:"comments",label:"备注",sortable:"custom",minWidth:110,align:"center"},{prop:"createTime",label:"登录时间",sortable:"custom",width:180,align:"center"}]),u=({pages:r,where:e,orders:s,filters:t})=>G({...e,...s,...t,...r}),v=r=>{var e,s;(s=(e=h.value)==null?void 0:e.reload)==null||s.call(e,{page:1,where:r})},_=()=>{var e,s;const r=R.loading({message:"请求中..",plain:!0});(s=(e=h.value)==null?void 0:e.fetch)==null||s.call(e,({where:t,orders:g,filters:d})=>{H({...t,...g,...d}).then(i=>{const m=new Y.Workbook,c=m.addWorksheet("Sheet1");c.addRow(["账号","用户名","IP地址","设备型号","操作系统","浏览器","操作类型","备注","登录时间"]),i.forEach(l=>{c.addRow([l.username,l.nickname,l.ip,l.device,l.os,l.browser,["登录成功","登录失败","退出登录","刷新TOKEN"][l.loginType],l.comments,l.createTime])}),[16,16,22,22,18,20,14,16,24].forEach((l,w)=>{c.getColumn(w+1).width=l}),c.eachRow({includeEmpty:!0},(l,w)=>{l.height=20,l.eachCell({includeEmpty:!0},x=>{x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},x.alignment={vertical:"middle",horizontal:"center"},x.font={size:12,bold:w===1}})}),m.xlsx.writeBuffer().then(l=>{U(l,"登录日志.xlsx"),r.close()})}).catch(i=>{r.close(),R.error(i.message)})})};return(r,e)=>{const s=C,t=F,g=j,d=K,i=M;return y(),b(i,null,{default:o(()=>[a(A,{where:n,onSearch:v},null,8,["where"]),a(d,{"body-style":{paddingTop:"8px"}},{default:o(()=>[a(g,{ref_key:"tableRef",ref:h,"row-key":"id",columns:T.value,datasource:u,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"登录日志数据"},where:n,"cache-key":"systemLoginRecordTable"},{toolbar:o(()=>[a(s,{type:"primary",class:"ele-btn-icon",icon:E(L),onClick:_},{default:o(()=>e[0]||(e[0]=[p(" 导出 ")])),_:1},8,["icon"])]),loginType:o(({row:m})=>[m.loginType===0?(y(),b(t,{key:0,size:"small",type:"success","disable-transitions":!0},{default:o(()=>e[1]||(e[1]=[p(" 登录成功 ")])),_:1})):m.loginType===1?(y(),b(t,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:o(()=>e[2]||(e[2]=[p(" 登录失败 ")])),_:1})):m.loginType===2?(y(),b(t,{key:2,size:"small",type:"info","disable-transitions":!0},{default:o(()=>e[3]||(e[3]=[p(" 退出登录 ")])),_:1})):m.loginType===3?(y(),b(t,{key:3,size:"small",type:"warning","disable-transitions":!0},{default:o(()=>e[4]||(e[4]=[p(" 刷新TOKEN ")])),_:1})):P("",!0)]),_:1},8,["columns","where"])]),_:1})]),_:1})}}});export{fe as default};
