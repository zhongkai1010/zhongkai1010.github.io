import{a2 as he,c4 as q,cG as be,cH as fe,a4 as ke,d as W,b9 as ye,fo as xe,fp as Te,cr as _e,a0 as Ce,fq as Re,r as b,fr as Ve,N as Ae,J as p,R as me,U as Ie,T as Se,c as le,o as w,w as g,b as i,cb as ze,e as k,a7 as ve,a6 as v,u as a,fs as $e,a5 as C,p as E,a1 as K,aN as Be,E as T,cO as Me,F as re,dj as Pe,dk as Ye,ft as De,fh as Fe,a8 as Xe,fu as He,fv as je,q as qe,c8 as Ke,c9 as We,fw as Ze,c7 as $,fx as Ge,cd as A,a9 as Le,cY as Je,fy as Qe,cW as Ue,ce as j,cQ as ea,t as aa,bT as pe,ch as ta,cf as sa,fz as na,fA as oa,fB as la,ec as ra,Z as ia,eF as ca}from"./index-BHMAnI5P.js";import{t as de}from"./throttle-CtAx5HfW.js";const Ee=he({urlList:{type:q(Array),default:()=>be([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:q(String)}}),ua={close:()=>!0,switch:c=>fe(c),rotate:c=>fe(c)},da=W({name:"ElImageViewer"}),fa=W({...da,props:Ee,emits:ua,setup(c,{expose:N,emit:f}){var R;const n=c,m={CONTAIN:{name:"contain",icon:ye(Te)},ORIGINAL:{name:"original",icon:ye(xe)}},{t:B}=_e(),s=Ce("image-viewer"),{nextZIndex:M}=Re(),O=b(),o=b([]),I=Ve(),S=b(!0),y=b(n.initialIndex),h=Ae(m.CONTAIN),r=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),P=b((R=n.zIndex)!=null?R:M()),Y=p(()=>{const{urlList:t}=n;return t.length<=1}),Z=p(()=>y.value===0),G=p(()=>y.value===n.urlList.length-1),D=p(()=>n.urlList[y.value]),ie=p(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!n.infinite&&Z.value)]),J=p(()=>[s.e("btn"),s.e("next"),s.is("disabled",!n.infinite&&G.value)]),F=p(()=>{const{scale:t,deg:d,offsetX:l,offsetY:_,enableTransition:z}=r.value;let L=l/t,x=_/t;const H=d*Math.PI/180,ge=Math.cos(H),we=Math.sin(H);L=L*ge+x*we,x=x*ge-l/t*we;const ue={transform:`scale(${t}) rotate(${d}deg) translate(${L}px, ${x}px)`,transition:z?"transform .3s":""};return h.value.name===m.CONTAIN.name&&(ue.maxWidth=ue.maxHeight="100%"),ue});function V(){Q(),f("close")}function ce(){const t=de(l=>{switch(l.code){case A.esc:n.closeOnPressEscape&&V();break;case A.space:se();break;case A.left:ne();break;case A.up:u("zoomIn");break;case A.right:e();break;case A.down:u("zoomOut");break}}),d=de(l=>{const _=l.deltaY||l.deltaX;u(_<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});I.run(()=>{$(document,"keydown",t),$(document,"wheel",d)})}function Q(){I.stop()}function U(){S.value=!1}function ee(t){S.value=!1,t.target.alt=B("el.image.error")}function ae(t){if(S.value||t.button!==0||!O.value)return;r.value.enableTransition=!1;const{offsetX:d,offsetY:l}=r.value,_=t.pageX,z=t.pageY,L=de(H=>{r.value={...r.value,offsetX:d+H.pageX-_,offsetY:l+H.pageY-z}}),x=$(document,"mousemove",L);$(document,"mouseup",()=>{x()}),t.preventDefault()}function te(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function se(){if(S.value)return;const t=Ge(m),d=Object.values(m),l=h.value.name,z=(d.findIndex(L=>L.name===l)+1)%t.length;h.value=m[t[z]],te()}function X(t){const d=n.urlList.length;y.value=(t+d)%d}function ne(){Z.value&&!n.infinite||X(y.value-1)}function e(){G.value&&!n.infinite||X(y.value+1)}function u(t,d={}){if(S.value)return;const{minScale:l,maxScale:_}=n,{zoomRate:z,rotateDeg:L,enableTransition:x}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...d};switch(t){case"zoomOut":r.value.scale>l&&(r.value.scale=Number.parseFloat((r.value.scale/z).toFixed(3)));break;case"zoomIn":r.value.scale<_&&(r.value.scale=Number.parseFloat((r.value.scale*z).toFixed(3)));break;case"clockwise":r.value.deg+=L,f("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=L,f("rotate",r.value.deg);break}r.value.enableTransition=x}function oe(t){var d;((d=t.detail)==null?void 0:d.focusReason)==="pointer"&&t.preventDefault()}function Oe(){n.closeOnPressEscape&&V()}return me(D,()=>{Ie(()=>{const t=o.value[0];t!=null&&t.complete||(S.value=!0)})}),me(y,t=>{te(),f("switch",t)}),Se(()=>{ce()}),N({setActiveItem:X}),(t,d)=>(w(),le(a(Ze),{to:"body",disabled:!t.teleported},{default:g(()=>[i(ze,{name:"viewer-fade",appear:""},{default:g(()=>[k("div",{ref_key:"wrapper",ref:O,tabindex:-1,class:v(a(s).e("wrapper")),style:ve({zIndex:P.value})},[i(a($e),{loop:"",trapped:"","focus-trap-el":O.value,"focus-start-el":"container",onFocusoutPrevented:oe,onReleaseRequested:Oe},{default:g(()=>[k("div",{class:v(a(s).e("mask")),onClick:Be(l=>t.hideOnClickModal&&V(),["self"])},null,10,["onClick"]),C(" CLOSE "),k("span",{class:v([a(s).e("btn"),a(s).e("close")]),onClick:V},[i(a(T),null,{default:g(()=>[i(a(Me))]),_:1})],2),C(" ARROW "),a(Y)?C("v-if",!0):(w(),E(re,{key:0},[k("span",{class:v(a(ie)),onClick:ne},[i(a(T),null,{default:g(()=>[i(a(Pe))]),_:1})],2),k("span",{class:v(a(J)),onClick:e},[i(a(T),null,{default:g(()=>[i(a(Ye))]),_:1})],2)],64)),C(" ACTIONS "),k("div",{class:v([a(s).e("btn"),a(s).e("actions")])},[k("div",{class:v(a(s).e("actions__inner"))},[i(a(T),{onClick:l=>u("zoomOut")},{default:g(()=>[i(a(De))]),_:1},8,["onClick"]),i(a(T),{onClick:l=>u("zoomIn")},{default:g(()=>[i(a(Fe))]),_:1},8,["onClick"]),k("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(T),{onClick:se},{default:g(()=>[(w(),le(Xe(a(h).icon)))]),_:1}),k("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(T),{onClick:l=>u("anticlockwise")},{default:g(()=>[i(a(He))]),_:1},8,["onClick"]),i(a(T),{onClick:l=>u("clockwise")},{default:g(()=>[i(a(je))]),_:1},8,["onClick"])],2)],2),C(" CANVAS "),k("div",{class:v(a(s).e("canvas"))},[(w(!0),E(re,null,qe(t.urlList,(l,_)=>Ke((w(),E("img",{ref_for:!0,ref:z=>o.value[_]=z,key:l,src:l,style:ve(a(F)),class:v(a(s).e("img")),crossorigin:t.crossorigin,onLoad:U,onError:ee,onMousedown:ae},null,46,["src","crossorigin"])),[[We,_===y.value]])),128))],2),K(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ma=ke(fa,[["__file","image-viewer.vue"]]);const Ne=Le(ma),va=he({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:q([String,Object])},previewSrcList:{type:q(Array),default:()=>be([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:q(String)}}),pa={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>fe(c),close:()=>!0,show:()=>!0},ga=W({name:"ElImage",inheritAttrs:!1}),wa=W({...ga,props:va,emits:pa,setup(c,{emit:N}){const f=c;let R="";const{t:n}=_e(),m=Ce("image"),B=Je(),s=p(()=>Qe(Object.entries(B).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),M=Ue({excludeListeners:!0,excludeKeys:p(()=>Object.keys(s.value))}),O=b(),o=b(!1),I=b(!0),S=b(!1),y=b(),h=b(),r=j&&"loading"in HTMLImageElement.prototype;let P,Y;const Z=p(()=>[m.e("inner"),D.value&&m.e("preview"),I.value&&m.is("loading")]),G=p(()=>{const{fit:e}=f;return j&&e?{objectFit:e}:{}}),D=p(()=>{const{previewSrcList:e}=f;return ea(e)&&e.length>0}),ie=p(()=>{const{previewSrcList:e,initialIndex:u}=f;let oe=u;return u>e.length-1&&(oe=0),oe}),J=p(()=>f.loading==="eager"?!1:!r&&f.loading==="lazy"||f.lazy),F=()=>{j&&(I.value=!0,o.value=!1,O.value=f.src)};function V(e){I.value=!1,o.value=!1,N("load",e)}function ce(e){I.value=!1,o.value=!0,N("error",e)}function Q(){la(y.value,h.value)&&(F(),ae())}const U=oa(Q,200,!0);async function ee(){var e;if(!j)return;await Ie();const{scrollContainer:u}=f;ta(u)?h.value=u:sa(u)&&u!==""?h.value=(e=document.querySelector(u))!=null?e:void 0:y.value&&(h.value=na(y.value)),h.value&&(P=$(h,"scroll",U),setTimeout(()=>Q(),100))}function ae(){!j||!h.value||!U||(P==null||P(),h.value=void 0)}function te(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function se(){D.value&&(Y=$("wheel",te,{passive:!1}),R=document.body.style.overflow,document.body.style.overflow="hidden",S.value=!0,N("show"))}function X(){Y==null||Y(),document.body.style.overflow=R,S.value=!1,N("close")}function ne(e){N("switch",e)}return me(()=>f.src,()=>{J.value?(I.value=!0,o.value=!1,ae(),ee()):F()}),Se(()=>{J.value?ee():F()}),(e,u)=>(w(),E("div",pe({ref_key:"container",ref:y},a(s),{class:[a(m).b(),e.$attrs.class]}),[o.value?K(e.$slots,"error",{key:0},()=>[k("div",{class:v(a(m).e("error"))},aa(a(n)("el.image.error")),3)]):(w(),E(re,{key:1},[O.value!==void 0?(w(),E("img",pe({key:0},a(M),{src:O.value,loading:e.loading,style:a(G),class:a(Z),crossorigin:e.crossorigin,onClick:se,onLoad:V,onError:ce}),null,16,["src","loading","crossorigin"])):C("v-if",!0),I.value?(w(),E("div",{key:1,class:v(a(m).e("wrapper"))},[K(e.$slots,"placeholder",{},()=>[k("div",{class:v(a(m).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),a(D)?(w(),E(re,{key:2},[S.value?(w(),le(a(Ne),{key:0,"z-index":e.zIndex,"initial-index":a(ie),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:X,onSwitch:ne},{default:g(()=>[e.$slots.viewer?(w(),E("div",{key:0},[K(e.$slots,"viewer")])):C("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var ya=ke(wa,[["__file","image.vue"]]);const Ca=Le(ya),ha={...Ee,teleported:{type:Boolean,default:!0},modelValue:Boolean,customClass:String,customStyle:Object,transitionName:{type:String,default:"ele-image-viewer-fade"},keepAlive:Boolean},ba={"update:modelValue":c=>!0,close:()=>!0,switch:c=>!0,rotate:c=>!0},Ia=W({name:"EleImageViewer",__name:"index",props:ha,emits:ba,setup(c,{expose:N,emit:f}){const R=c,n=f,m=b(null),B=p(()=>{const o=ra(R,["modelValue","customClass","customStyle","transitionName","keepAlive"]);return o.teleported=!1,o}),s=()=>{n("update:modelValue",!1),n("close")},M=o=>{n("switch",o)},O=o=>{n("rotate",o)};return ia(()=>{s()}),N({imageViewerRef:m}),(o,I)=>(w(),le(ca,{to:"body",disabled:!o.teleported},[i(ze,{name:o.transitionName,appear:!0},{default:g(()=>[o.modelValue?(w(),E("div",{key:0,class:v(["ele-image-viewer",o.customClass]),style:ve(o.customStyle)},[i(a(Ne),pe(B.value,{ref_key:"imageViewerRef",ref:m,onClose:s,onSwitch:M,onRotate:O}),{default:g(()=>[K(o.$slots,"default")]),_:3},16)],6)):C("",!0)]),_:3},8,["name"])],8,["disabled"]))}});export{Ca as E,Ia as _};
