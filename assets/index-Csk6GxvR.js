import{a3 as he,c4 as j,cC as be,cD as fe,a5 as ke,d as U,ba as ye,fl as xe,fm as Ve,cr as _e,a1 as Ce,fn as Re,r as b,fo as Te,O as $e,K as p,S as me,V as Ie,U as Se,c as le,o as w,w as g,b as i,cb as Le,e as k,a8 as ve,a7 as v,u as a,fp as Ae,a6 as C,q as E,a2 as q,aO as Me,E as V,cK as Be,F as re,df as Pe,dg as De,fq as Ye,fe as Fe,a9 as Xe,fr as He,fs as Ke,v as je,c8 as qe,c9 as Ue,ft as We,c7 as A,fu as Ze,cd as $,aa as ze,cU as Ge,fv as Je,cS as Qe,ce as K,cM as ea,t as aa,bU as pe,ch as ta,cf as sa,fw as na,fx as oa,fy as la,e8 as ra,$ as ia,eC as ca}from"./index-CohFp7-Q.js";import{t as de}from"./throttle-Cn1EruRq.js";const Ee=he({urlList:{type:j(Array),default:()=>be([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:j(String)}}),ua={close:()=>!0,switch:c=>fe(c),rotate:c=>fe(c)},da=U({name:"ElImageViewer"}),fa=U({...da,props:Ee,emits:ua,setup(c,{expose:N,emit:f}){var R;const n=c,m={CONTAIN:{name:"contain",icon:ye(Ve)},ORIGINAL:{name:"original",icon:ye(xe)}},{t:M}=_e(),s=Ce("image-viewer"),{nextZIndex:B}=Re(),O=b(),o=b([]),I=Te(),S=b(!0),y=b(n.initialIndex),h=$e(m.CONTAIN),r=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),P=b((R=n.zIndex)!=null?R:B()),D=p(()=>{const{urlList:t}=n;return t.length<=1}),W=p(()=>y.value===0),Z=p(()=>y.value===n.urlList.length-1),Y=p(()=>n.urlList[y.value]),ie=p(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!n.infinite&&W.value)]),G=p(()=>[s.e("btn"),s.e("next"),s.is("disabled",!n.infinite&&Z.value)]),F=p(()=>{const{scale:t,deg:d,offsetX:l,offsetY:_,enableTransition:L}=r.value;let z=l/t,x=_/t;const H=d*Math.PI/180,ge=Math.cos(H),we=Math.sin(H);z=z*ge+x*we,x=x*ge-l/t*we;const ue={transform:`scale(${t}) rotate(${d}deg) translate(${z}px, ${x}px)`,transition:L?"transform .3s":""};return h.value.name===m.CONTAIN.name&&(ue.maxWidth=ue.maxHeight="100%"),ue});function T(){J(),f("close")}function ce(){const t=de(l=>{switch(l.code){case $.esc:n.closeOnPressEscape&&T();break;case $.space:se();break;case $.left:ne();break;case $.up:u("zoomIn");break;case $.right:e();break;case $.down:u("zoomOut");break}}),d=de(l=>{const _=l.deltaY||l.deltaX;u(_<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});I.run(()=>{A(document,"keydown",t),A(document,"wheel",d)})}function J(){I.stop()}function Q(){S.value=!1}function ee(t){S.value=!1,t.target.alt=M("el.image.error")}function ae(t){if(S.value||t.button!==0||!O.value)return;r.value.enableTransition=!1;const{offsetX:d,offsetY:l}=r.value,_=t.pageX,L=t.pageY,z=de(H=>{r.value={...r.value,offsetX:d+H.pageX-_,offsetY:l+H.pageY-L}}),x=A(document,"mousemove",z);A(document,"mouseup",()=>{x()}),t.preventDefault()}function te(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function se(){if(S.value)return;const t=Ze(m),d=Object.values(m),l=h.value.name,L=(d.findIndex(z=>z.name===l)+1)%t.length;h.value=m[t[L]],te()}function X(t){const d=n.urlList.length;y.value=(t+d)%d}function ne(){W.value&&!n.infinite||X(y.value-1)}function e(){Z.value&&!n.infinite||X(y.value+1)}function u(t,d={}){if(S.value)return;const{minScale:l,maxScale:_}=n,{zoomRate:L,rotateDeg:z,enableTransition:x}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...d};switch(t){case"zoomOut":r.value.scale>l&&(r.value.scale=Number.parseFloat((r.value.scale/L).toFixed(3)));break;case"zoomIn":r.value.scale<_&&(r.value.scale=Number.parseFloat((r.value.scale*L).toFixed(3)));break;case"clockwise":r.value.deg+=z,f("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=z,f("rotate",r.value.deg);break}r.value.enableTransition=x}function oe(t){var d;((d=t.detail)==null?void 0:d.focusReason)==="pointer"&&t.preventDefault()}function Oe(){n.closeOnPressEscape&&T()}return me(Y,()=>{Ie(()=>{const t=o.value[0];t!=null&&t.complete||(S.value=!0)})}),me(y,t=>{te(),f("switch",t)}),Se(()=>{ce()}),N({setActiveItem:X}),(t,d)=>(w(),le(a(We),{to:"body",disabled:!t.teleported},{default:g(()=>[i(Le,{name:"viewer-fade",appear:""},{default:g(()=>[k("div",{ref_key:"wrapper",ref:O,tabindex:-1,class:v(a(s).e("wrapper")),style:ve({zIndex:P.value})},[i(a(Ae),{loop:"",trapped:"","focus-trap-el":O.value,"focus-start-el":"container",onFocusoutPrevented:oe,onReleaseRequested:Oe},{default:g(()=>[k("div",{class:v(a(s).e("mask")),onClick:Me(l=>t.hideOnClickModal&&T(),["self"])},null,10,["onClick"]),C(" CLOSE "),k("span",{class:v([a(s).e("btn"),a(s).e("close")]),onClick:T},[i(a(V),null,{default:g(()=>[i(a(Be))]),_:1})],2),C(" ARROW "),a(D)?C("v-if",!0):(w(),E(re,{key:0},[k("span",{class:v(a(ie)),onClick:ne},[i(a(V),null,{default:g(()=>[i(a(Pe))]),_:1})],2),k("span",{class:v(a(G)),onClick:e},[i(a(V),null,{default:g(()=>[i(a(De))]),_:1})],2)],64)),C(" ACTIONS "),k("div",{class:v([a(s).e("btn"),a(s).e("actions")])},[k("div",{class:v(a(s).e("actions__inner"))},[i(a(V),{onClick:l=>u("zoomOut")},{default:g(()=>[i(a(Ye))]),_:1},8,["onClick"]),i(a(V),{onClick:l=>u("zoomIn")},{default:g(()=>[i(a(Fe))]),_:1},8,["onClick"]),k("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(V),{onClick:se},{default:g(()=>[(w(),le(Xe(a(h).icon)))]),_:1}),k("i",{class:v(a(s).e("actions__divider"))},null,2),i(a(V),{onClick:l=>u("anticlockwise")},{default:g(()=>[i(a(He))]),_:1},8,["onClick"]),i(a(V),{onClick:l=>u("clockwise")},{default:g(()=>[i(a(Ke))]),_:1},8,["onClick"])],2)],2),C(" CANVAS "),k("div",{class:v(a(s).e("canvas"))},[(w(!0),E(re,null,je(t.urlList,(l,_)=>qe((w(),E("img",{ref_for:!0,ref:L=>o.value[_]=L,key:l,src:l,style:ve(a(F)),class:v(a(s).e("img")),crossorigin:t.crossorigin,onLoad:Q,onError:ee,onMousedown:ae},null,46,["src","crossorigin"])),[[Ue,_===y.value]])),128))],2),q(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ma=ke(fa,[["__file","image-viewer.vue"]]);const Ne=ze(ma),va=he({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:j([String,Object])},previewSrcList:{type:j(Array),default:()=>be([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:j(String)}}),pa={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>fe(c),close:()=>!0,show:()=>!0},ga=U({name:"ElImage",inheritAttrs:!1}),wa=U({...ga,props:va,emits:pa,setup(c,{emit:N}){const f=c;let R="";const{t:n}=_e(),m=Ce("image"),M=Ge(),s=p(()=>Je(Object.entries(M).filter(([e])=>/^(data-|on[A-Z])/i.test(e)||["id","style"].includes(e)))),B=Qe({excludeListeners:!0,excludeKeys:p(()=>Object.keys(s.value))}),O=b(),o=b(!1),I=b(!0),S=b(!1),y=b(),h=b(),r=K&&"loading"in HTMLImageElement.prototype;let P,D;const W=p(()=>[m.e("inner"),Y.value&&m.e("preview"),I.value&&m.is("loading")]),Z=p(()=>{const{fit:e}=f;return K&&e?{objectFit:e}:{}}),Y=p(()=>{const{previewSrcList:e}=f;return ea(e)&&e.length>0}),ie=p(()=>{const{previewSrcList:e,initialIndex:u}=f;let oe=u;return u>e.length-1&&(oe=0),oe}),G=p(()=>f.loading==="eager"?!1:!r&&f.loading==="lazy"||f.lazy),F=()=>{K&&(I.value=!0,o.value=!1,O.value=f.src)};function T(e){I.value=!1,o.value=!1,N("load",e)}function ce(e){I.value=!1,o.value=!0,N("error",e)}function J(){la(y.value,h.value)&&(F(),ae())}const Q=oa(J,200,!0);async function ee(){var e;if(!K)return;await Ie();const{scrollContainer:u}=f;ta(u)?h.value=u:sa(u)&&u!==""?h.value=(e=document.querySelector(u))!=null?e:void 0:y.value&&(h.value=na(y.value)),h.value&&(P=A(h,"scroll",Q),setTimeout(()=>J(),100))}function ae(){!K||!h.value||!Q||(P==null||P(),h.value=void 0)}function te(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function se(){Y.value&&(D=A("wheel",te,{passive:!1}),R=document.body.style.overflow,document.body.style.overflow="hidden",S.value=!0,N("show"))}function X(){D==null||D(),document.body.style.overflow=R,S.value=!1,N("close")}function ne(e){N("switch",e)}return me(()=>f.src,()=>{G.value?(I.value=!0,o.value=!1,ae(),ee()):F()}),Se(()=>{G.value?ee():F()}),(e,u)=>(w(),E("div",pe({ref_key:"container",ref:y},a(s),{class:[a(m).b(),e.$attrs.class]}),[o.value?q(e.$slots,"error",{key:0},()=>[k("div",{class:v(a(m).e("error"))},aa(a(n)("el.image.error")),3)]):(w(),E(re,{key:1},[O.value!==void 0?(w(),E("img",pe({key:0},a(B),{src:O.value,loading:e.loading,style:a(Z),class:a(W),crossorigin:e.crossorigin,onClick:se,onLoad:T,onError:ce}),null,16,["src","loading","crossorigin"])):C("v-if",!0),I.value?(w(),E("div",{key:1,class:v(a(m).e("wrapper"))},[q(e.$slots,"placeholder",{},()=>[k("div",{class:v(a(m).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),a(Y)?(w(),E(re,{key:2},[S.value?(w(),le(a(Ne),{key:0,"z-index":e.zIndex,"initial-index":a(ie),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:X,onSwitch:ne},{default:g(()=>[e.$slots.viewer?(w(),E("div",{key:0},[q(e.$slots,"viewer")])):C("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var ya=ke(wa,[["__file","image.vue"]]);const Ca=ze(ya),ha={...Ee,teleported:{type:Boolean,default:!0},modelValue:Boolean,customClass:String,customStyle:Object,transitionName:{type:String,default:"ele-image-viewer-fade"},keepAlive:Boolean},ba={"update:modelValue":c=>!0,close:()=>!0,switch:c=>!0,rotate:c=>!0},Ia=U({name:"EleImageViewer",__name:"index",props:ha,emits:ba,setup(c,{expose:N,emit:f}){const R=c,n=f,m=b(null),M=p(()=>{const o=ra(R,["modelValue","customClass","customStyle","transitionName","keepAlive"]);return o.teleported=!1,o}),s=()=>{n("update:modelValue",!1),n("close")},B=o=>{n("switch",o)},O=o=>{n("rotate",o)};return ia(()=>{s()}),N({imageViewerRef:m}),(o,I)=>(w(),le(ca,{to:"body",disabled:!o.teleported},[i(Le,{name:o.transitionName,appear:!0},{default:g(()=>[o.modelValue?(w(),E("div",{key:0,class:v(["ele-image-viewer",o.customClass]),style:ve(o.customStyle)},[i(a(Ne),pe(M.value,{ref_key:"imageViewerRef",ref:m,onClose:s,onSwitch:B,onRotate:O}),{default:g(()=>[q(o.$slots,"default")]),_:3},16)],6)):C("",!0)]),_:3},8,["name"])],8,["disabled"]))}});export{Ca as E,Ia as _};
