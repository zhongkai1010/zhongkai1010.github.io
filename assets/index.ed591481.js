var Se=Object.defineProperty,De=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var ae=(w,C,M)=>C in w?Se(w,C,{enumerable:!0,configurable:!0,writable:!0,value:M}):w[C]=M,z=(w,C)=>{for(var M in C||(C={}))Ge.call(C,M)&&ae(w,M,C[M]);if(le)for(var M of le(C))Je.call(C,M)&&ae(w,M,C[M]);return w},X=(w,C)=>De(w,Be(C));import{a3 as j,_ as B,d as O,ao as T,c as G,B as x,r as n,T as Y,o as E,b as te,U as J,u as s,f as $,w as a,i as R,l as Z,h as e,ap as oe,e as Le,C as ze,y as ee,k as P,E as K,__tla as Ze}from"./index.35a750f6.js";import{g as Ke,R as H,D as de,a as He,b as Qe,c as ue,d as We,__tla as Xe}from"./helps.76aab304.js";let ne,Ye=Promise.all([(()=>{try{return Ze}catch{}})(),(()=>{try{return Xe}catch{}})()]).then(async()=>{var w={getAllModels:()=>j.get({url:"/api/tools/model/getAllModels"}),getModel:y=>j.get({url:"/api/tools/model/getModel",params:{id:y}}),deleteModel:y=>j.post({url:"/api/tools/model/deleteModel",params:{id:y}}),saveModel:y=>j.post({url:"/api/tools/model/saveModel",data:y}),getModelProperties:y=>j.get({url:"/api/tools/model/getAllModelProperties",params:y}),saveProperty:y=>j.post({url:"/api/tools/model/saveModelProperty",data:y}),deleteProperty:y=>j.post({url:"/api/tools/model/deleteModelProperty",data:{id:y}})};const C={class:"container"},M=["title"],se={key:0,class:"button"},ie=O({name:"ModelTree",props:{data:null},emits:["select","edit","remove"],setup(y,{expose:g,emit:i}){const u=y,{confirm:r}=ee(),m=T(w.deleteModel),k=G(()=>[Ke(u.data)]),v=x([H]),l=x(H),_=t=>{!t.isLeaf||(i("select",t),l.value=t.id,o(t))},p=t=>{r(`\u786E\u8BA4\u662F\u5426\u5220\u9664,"${t.displayName}"!`).then(async()=>{await m.execute(t.id),i("remove",t),o(t)})},o=t=>{t.group?v.value=[`${H}_${t.group}`]:v.value=[H]};return g({selectNode:_}),(t,h)=>{const c=n("iconify-icon"),V=n("el-tree"),A=Y("loading");return E(),te("div",C,[J((E(),$(V,{data:s(k),"highlight-current":"",onNodeClick:_,"default-expanded-keys":v.value,"node-key":"id",props:{label:"displayName"}},{default:a(({node:N})=>[R("div",{class:ze(["tree-node",{"is-select":N.data.id==l.value}])},[R("span",{title:`${N.data.label}(${N.data.name})`},Z(N.label),9,M),N.isLeaf?(E(),te("div",se,[e(c,{icon:"ant-design:edit-outlined",class:"edit",onClick:oe(F=>i("edit",N.data),["stop"])},null,8,["onClick"]),e(c,{icon:"ant-design:delete-outlined",class:"del",onClick:oe(F=>p(N.data),["stop"])},null,8,["onClick"])])):Le("",!0)],2)]),_:1},8,["data","default-expanded-keys"])),[[A,s(m).isFetching.value]])])}}});var re=B(ie,[["__scopeId","data-v-73424356"]]);function pe(y,g,i,u="children",r){var v;const m=l=>{const _=[];for(let p=0;p<l.length;p++){const o=l[p],t=o[g];let h=y.filter(c=>c[i]===t);r&&(h=h.sort((c,V)=>c[r]-V[r])),h.length>0&&(o[u]=m(h)),_.push(o)}return _};let k=y.filter(l=>!l[i]);return r&&(k=k.sort((l,_)=>l[r]-_[r])),(v=m(k))!=null?v:y}const ce=P(" \u7F16\u8F91 "),me=P(" \u5220\u9664 "),ve=O({name:"PropertyGrid",props:{data:null},emits:["edit","remove","update"],setup(y,{emit:g}){const i=y,{confirm:u}=ee(),r=G(()=>pe(i.data,"id","parentId","children","order")),m=(l,_)=>{_.required=l,g("update",_)},k=l=>{u(`\u786E\u8BA4\u662F\u5426\u5220\u9664,"${l.displayName}"!`).then(async()=>{g("remove",l)})},v=l=>l+1;return(l,_)=>{const p=n("el-table-column"),o=n("el-switch"),t=n("el-button"),h=n("el-table");return E(),$(h,{rowKey:"id",data:s(r),stripe:""},{default:a(()=>[e(p,{type:"index",label:"\u5E8F\u53F7",width:"60",index:v}),e(p,{label:"\u5C5E\u6027\u540D\u79F0",prop:"name","show-overflow-tooltip":!0}),e(p,{label:"\u663E\u793A\u540D\u79F0",prop:"displayName"}),e(p,{label:"\u5C5E\u6027\u7C7B\u578B",prop:"propertyType"}),e(p,{label:"\u6570\u7EC4\u7C7B\u578B",prop:"arrayType"},{default:a(c=>[P(Z(c.row.propertyType==="array"?c.row.arrayType:""),1)]),_:1}),e(p,{label:"\u9ED8\u8BA4\u503C",prop:"defaultValue"}),e(p,{label:"\u662F\u5426\u5FC5\u586B",prop:"required"},{default:a(c=>[e(o,{modelValue:c.row.required,"onUpdate:modelValue":V=>c.row.required=V,onChange:V=>m(V,c.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(p,{label:"\u63CF\u8FF0",prop:"remark"}),e(p,{label:"\u6240\u5C5E\u7EC4\u7EC7",prop:"objectName"}),e(p,{prop:"operate",label:"\u64CD\u4F5C",align:"center"},{default:a(c=>[e(t,{link:"",type:"primary",onClick:V=>g("edit",c.row)},{default:a(()=>[ce]),_:2},1032,["onClick"]),e(t,{link:"",type:"primary",onClick:V=>k(c.row)},{default:a(()=>[me]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])}}}),fe={class:"header"},ye=P("\u63D0\u4EA4"),_e=P("\u5173\u95ED"),ge=O({name:"ModelEditDialog",emits:["save"],setup(y,{expose:g,emit:i}){const{message:u}=ee(),r=T(w.saveModel),m=T(w.getModel),k=x(),v=x(!1),l=G({get:()=>{var o;return(o=m.data.value)!=null?o:de},set:o=>{m.data.value=o}}),_=x([]),p=async o=>{await o.validate(async(t,h)=>{if(!t){K("submit model verification failed",h),u("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25\uFF01","error");return}const c=X(z({},l.value),{properties:_.value.map(He)}),V=await r.execute(c);v.value=!1,u("\u63D0\u4EA4\u6210\u529F\uFF01","success"),i("save",V)})};return g({open:async o=>{var t;if(v.value=!0,o){const h=await m.execute(o.id);l.value=h,_.value=((t=h.properties)!=null?t:[]).map(Qe)}else l.value=z({},de),_.value=[]}}),(o,t)=>{const h=n("iconify-icon"),c=n("el-input"),V=n("el-form-item"),A=n("FormModel"),N=n("el-form"),F=n("el-button"),S=n("el-dialog"),f=Y("loading");return E(),$(S,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=U=>v.value=U),"show-close":!s(r).isFetching.value,"close-on-click-modal":!s(r).isFetching.value,"close-on-press-escape":!s(r).isFetching.value},{header:a(()=>[R("div",fe,[e(h,{icon:"akar-icons:edit",size:32}),R("span",null,Z(s(l).id?"\u4FEE\u6539\u6A21\u578B":"\u521B\u5EFA\u6A21\u578B"),1)])]),footer:a(()=>[R("span",null,[e(F,{type:"primary",loading:s(r).isFetching.value,onClick:t[4]||(t[4]=U=>p(k.value))},{default:a(()=>[ye]),_:1},8,["loading"]),e(F,{onClick:t[5]||(t[5]=U=>v.value=!1),disabled:s(r).isFetching.value},{default:a(()=>[_e]),_:1},8,["disabled"])])]),default:a(()=>[J((E(),$(N,{ref_key:"formRef",ref:k,model:s(l),"label-position":"top"},{default:a(()=>[e(V,{label:"\u6A21\u578B\u540D\u79F0",prop:"name",required:!0,rules:{required:!0,message:"\u6A21\u578B\u540D\u79F0\u662F\u5FC5\u586B\u9879\uFF01"}},{default:a(()=>[e(c,{modelValue:s(l).name,"onUpdate:modelValue":t[0]||(t[0]=U=>s(l).name=U)},null,8,["modelValue"])]),_:1}),e(V,{label:"\u663E\u793A\u540D\u79F0",prop:"displayName",rules:{required:!0,message:"\u663E\u793A\u540D\u79F0\u662F\u5FC5\u586B\u9879\uFF01"}},{default:a(()=>[e(c,{modelValue:s(l).displayName,"onUpdate:modelValue":t[1]||(t[1]=U=>s(l).displayName=U)},null,8,["modelValue"])]),_:1}),e(V,{label:"\u5206\u7EC4",prop:"displayName"},{default:a(()=>[e(c,{modelValue:s(l).group,"onUpdate:modelValue":t[2]||(t[2]=U=>s(l).group=U)},null,8,["modelValue"])]),_:1}),e(V,{label:"\u6A21\u578B\u5C5E\u6027",prop:"fields"},{default:a(()=>[e(A,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=U=>_.value=U)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[f,s(m).isFetching.value]])]),_:1},8,["modelValue","show-close","close-on-click-modal","close-on-press-escape"])}}});var be=B(ge,[["__scopeId","data-v-cacc49be"]]);const Ve={class:"header"},he=P("\u63D0\u4EA4"),we=P("\u5173\u95ED"),ke=O({name:"PropertyEditDialog",emits:["save"],setup(y,{expose:g,emit:i}){const u=x(),r=x(!1),m=T(w.saveProperty),k=async()=>{const v=await m.execute(u.value);r.value=!1,i("save",v)};return g({open:v=>{r.value=!0,u.value=v}}),(v,l)=>{const _=n("iconify-icon"),p=n("el-input"),o=n("el-form-item"),t=n("FormPropertyType"),h=n("el-col"),c=n("el-row"),V=n("el-switch"),A=n("FormSelectDictionary"),N=n("el-form"),F=n("el-button"),S=n("el-dialog");return E(),$(S,{modelValue:r.value,"onUpdate:modelValue":l[10]||(l[10]=f=>r.value=f),"show-close":!s(m).isFetching.value,"close-on-click-modal":!s(m).isFetching.value,"close-on-press-escape":!s(m).isFetching.value},{header:a(()=>[R("div",Ve,[e(_,{icon:"carbon:model-alt",size:32}),R("span",null,Z(u.value.id?"\u4FEE\u6539\u6A21\u578B":"\u521B\u5EFA\u6A21\u578B"),1)])]),footer:a(()=>[R("span",null,[e(F,{type:"primary",onClick:k,loading:s(m).isFetching.value},{default:a(()=>[he]),_:1},8,["loading"]),e(F,{onClick:l[9]||(l[9]=f=>r.value=!1),disabled:s(m).isFetching.value},{default:a(()=>[we]),_:1},8,["disabled"])])]),default:a(()=>[e(N,{modelValue:u.value,"onUpdate:modelValue":l[8]||(l[8]=f=>u.value=f),"label-position":"top"},{default:a(()=>[e(o,{label:"\u5C5E\u6027\u540D\u79F0"},{default:a(()=>[e(p,{modelValue:u.value.name,"onUpdate:modelValue":l[0]||(l[0]=f=>u.value.name=f)},null,8,["modelValue"])]),_:1}),e(o,{label:"\u663E\u793A\u540D\u79F0"},{default:a(()=>[e(p,{modelValue:u.value.displayName,"onUpdate:modelValue":l[1]||(l[1]=f=>u.value.displayName=f)},null,8,["modelValue"])]),_:1}),e(c,{gutter:20},{default:a(()=>[e(h,{span:12,offset:0},{default:a(()=>[e(o,{label:"\u5C5E\u6027\u7C7B\u578B"},{default:a(()=>[e(t,{modelValue:u.value.propertyType,"onUpdate:modelValue":l[2]||(l[2]=f=>u.value.propertyType=f),disabled:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:12,offset:0},{default:a(()=>[e(o,{label:"\u6570\u7EC4\u7C7B\u578B"},{default:a(()=>[e(t,{modelValue:u.value.arrayType,"onUpdate:modelValue":l[3]||(l[3]=f=>u.value.arrayType=f),disabled:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(o,{label:"\u662F\u5426\u5FC5\u586B"},{default:a(()=>[e(V,{modelValue:u.value.required,"onUpdate:modelValue":l[4]||(l[4]=f=>u.value.required=f)},null,8,["modelValue"])]),_:1}),e(o,{label:"\u9ED8\u8BA4\u503C"},{default:a(()=>[e(p,{modelValue:u.value.defaultValue,"onUpdate:modelValue":l[5]||(l[5]=f=>u.value.defaultValue=f)},null,8,["modelValue"])]),_:1}),e(o,{label:"\u5907\u6CE8"},{default:a(()=>[e(p,{modelValue:u.value.remark,"onUpdate:modelValue":l[6]||(l[6]=f=>u.value.remark=f)},null,8,["modelValue"])]),_:1}),e(o,{label:"\u7EC4\u7EC7\u7F16\u53F7"},{default:a(()=>[e(A,{name:s(ue).ORGANIZATION,modelValue:u.value.objectId,"onUpdate:modelValue":l[7]||(l[7]=f=>u.value.objectId=f),style:{"margin-right":"5px",width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u7EC4\u7EC7",clearable:""},null,8,["name","modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","show-close","close-on-click-modal","close-on-press-escape"])}}});var xe=B(ke,[["__scopeId","data-v-bd1ecb88"]]);const Ce=O({name:"JsonPreview",setup(y,{expose:g}){const i=x(!1),u=x("");return g({open:r=>{i.value=!0,u.value=r}}),(r,m)=>{const k=n("form-json"),v=n("el-dialog");return E(),$(v,{modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=l=>i.value=l),title:"\u4EE3\u7801",width:"60%",class:"abc"},{default:a(()=>[e(k,{"model-value":u.value},null,8,["model-value"])]),_:1},8,["modelValue"])}}});var Ne=B(Ce,[["__scopeId","data-v-9b4f1ce8"]]);const Ue=P("\u521B\u5EFA"),Ie=P(" \u751F\u6210\u4EE3\u7801 "),Me=P("\u8868\u5355\u914D\u7F6E"),Pe=P("\u8868\u683C\u914D\u7F6E"),Fe=P("JSON"),Ee=O({name:"index",setup(y){const g=T(w.getAllModels,null,{immediate:!0}),i=T(w.getModelProperties),u=T(w.deleteProperty),r=T(w.saveProperty),m=x(),k=x(),v=x(),l=x(),_=G({get:()=>{var d;return(d=i.data.value)!=null?d:[]},set:d=>{i.data.value=d}}),p=x(),o=x(),t=G(()=>o.value?`${o.value.displayName}(${o.value.name}) - \u6A21\u578B\u5C5E\u6027`:"\u6A21\u578B\u5C5E\u6027"),h=async d=>{var b;K("select model",d),((b=o.value)==null?void 0:b.id)!=d.id&&(o.value=d,await i.execute({modelId:d.id,objectId:p.value}))},c=d=>{m.value.open(d)},V=d=>{const b=g.data.value.findIndex(I=>I.id==d.id);g.data.value.splice(b,1),(o==null?void 0:o.value.id)===d.id&&(_.value=[],o.value=null)},A=async d=>{var I,q;const b=g.data.value.findIndex(L=>L.id==d.id);b>=0?g.data.value.splice(b,1,d):g.data.value.push(d),v.value.selectNode(X(z({},d),{isLeaf:!0})),d.id==((I=o.value)==null?void 0:I.id)&&(o.value=d,i.data.value=(q=d.properties)!=null?q:[]),K("save model",d)},N=async d=>{await u.execute(d.id);const b=i.data.value.findIndex(I=>I.id==d.id);i.data.value.splice(b,1)},F=d=>{K("start edit property",d),k.value.open(d)},S=async d=>{await r.execute(d)},f=d=>{const b=i.data.value.findIndex(I=>I.id===d.id);i.data.value.splice(b,1,d)},U=async d=>{o.value&&await i.execute({modelId:o.value.id,objectId:d})},Te=d=>{var b;if(d==="json"){const I=We((b=i.data.value)!=null?b:[]),q=JSON.stringify(I,null,"	");l.value.open(q)}};return(d,b)=>{const I=n("el-button"),q=n("CardTitle"),L=n("el-col"),Re=n("FormSelectDictionary"),Q=n("el-dropdown-item"),Ae=n("el-dropdown-menu"),qe=n("el-dropdown"),je=n("el-row"),$e=n("page-view"),W=Y("loading");return J((E(),$($e,{class:"container",gutter:0,bgColor:!1},{default:a(()=>[e(je,{gutter:20},{default:a(()=>[e(L,{span:4},{default:a(()=>[e(q,{title:"\u6570\u636E\u6A21\u578B",icon:"carbon:model-alt"},{button:a(()=>[e(I,{type:"primary",onClick:b[0]||(b[0]=D=>c())},{default:a(()=>[Ue]),_:1})]),default:a(()=>{var D;return[J(e(re,{ref_key:"modelTreeRef",ref:v,data:(D=s(g).data.value)!=null?D:[],onSelect:h,onEdit:b[1]||(b[1]=Oe=>c(Oe)),onRemove:V},null,8,["data"]),[[W,s(g).isFetching.value]])]}),_:1})]),_:1}),e(L,{span:20},{default:a(()=>[e(q,{title:s(t),icon:"carbon:property-relationship"},{button:a(()=>[e(Re,{name:s(ue).ORGANIZATION,modelValue:p.value,"onUpdate:modelValue":b[2]||(b[2]=D=>p.value=D),style:{"margin-right":"5px"},placeholder:"\u8BF7\u9009\u62E9\u7EC4\u7EC7",clearable:"",onChange:U},null,8,["name","modelValue"]),e(qe,{onCommand:Te},{dropdown:a(()=>[e(Ae,null,{default:a(()=>[e(Q,{command:"form"},{default:a(()=>[Me]),_:1}),e(Q,{command:"table"},{default:a(()=>[Pe]),_:1}),e(Q,{command:"json"},{default:a(()=>[Fe]),_:1})]),_:1})]),default:a(()=>[e(I,{type:"primary"},{default:a(()=>[Ie]),_:1})]),_:1})]),default:a(()=>[J(e(ve,{data:s(_),onRemove:N,onEdit:F,onUpdate:S},null,8,["data"]),[[W,s(u).isFetching.value]])]),_:1},8,["title"])]),_:1})]),_:1}),e(be,{ref_key:"modelEditRef",ref:m,onSave:A},null,512),e(xe,{ref_key:"propertyEditRef",ref:k,onSave:f},null,512),e(Ne,{ref_key:"jsonPreviewRef",ref:l},null,512)]),_:1})),[[W,s(i).isFetching.value]])}}});ne=B(Ee,[["__scopeId","data-v-365acb60"]])});export{Ye as __tla,ne as default};
