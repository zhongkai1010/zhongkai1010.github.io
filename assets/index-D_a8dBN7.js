import{_ as ie}from"./index-bKQdkVeu.js";import{d as D,b2 as Q,c as B,o as C,aP as X,aO as A,d8 as de,w as l,b as e,aJ as H,aL as L,u as o,cB as Z,aE as W,i as E,b0 as K,b1 as ee,r as y,a as ue,aD as le,a6 as te,z as me,aS as pe,n as h,V as O,c8 as ce,e as T,q as j,f as fe,gN as _e,az as ae,p as ge,aR as ve,aQ as be,S as oe,l as xe,as as ye,E as Ve,bd as he,aX as ke,F as Y,v as we,m as Ie,t as G,bS as Ue,av as ze,b3 as Ee,aG as J,bP as $e,b5 as Ce,b9 as Re}from"./index-XXV2p779.js";import{_ as Ne}from"./index-B_1-vMac.js";import{_ as Me}from"./index-Cx-mWHPA.js";import{v as Se,_ as Be}from"./index-De8rpVbL.js";import{E as De}from"./tree-Dh5fhCAu.js";import{_ as Fe}from"./index-CTGseU9v.js";import"./index-DE3dm6cX.js";import"./index-Dcv0XHyM.js";import"./virtual-list-Bwu1XHnz.js";import"./index-CBJ_SlPK.js";import"./index-D8Lg7UAl.js";import{E as ne,a as se}from"./col--9z3uc62.js";import{E as Te}from"./date-picker-DY6dhcMV.js";import{_ as qe}from"./role-select.vue_vue_type_script_setup_true_lang-B0O2qb6C.js";import{_ as Pe}from"./organization-select.vue_vue_type_script_setup_true_lang-CINHodoQ.js";import{c as Ke,u as Oe,a as je,i as Le,p as We,r as Ye,b as Ge,d as Je,l as Qe}from"./index-B-XTfgo1.js";import{p as Xe,e as Ae}from"./validate-B_6HX0Io.js";import{E as He}from"./upload-DZZeeTi9.js";import"./progress-D18Ic3rJ.js";import{l as Ze}from"./index-B9WZ7xEW.js";import"./isArrayLikeObject--goJ6ciw.js";import"./vuedraggable.umd-B5w0r7mM.js";import"./arrays-CThhjjm2.js";import"./index-D5-LIP95.js";import"./index-D23vSZpF.js";import"./tree-select-CJkPKTE6.js";const el=D({__name:"user-search",emits:["search"],setup(N,{expose:$,emit:I}){const k=I,[p,v]=Q({username:"",nickname:"",sex:void 0}),f=()=>{k("search",{...p})},d=()=>{v(),f()};return $({resetFields:v}),(n,c)=>{const U=L,u=H,r=se,V=Z,w=W,_=ne,a=X;return C(),B(a,{"label-width":"72px",onKeyup:de(f,["enter"]),onSubmit:c[3]||(c[3]=A(()=>{},["prevent"]))},{default:l(()=>[e(_,{gutter:8},{default:l(()=>[e(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(u,{label:"用户账号"},{default:l(()=>[e(U,{clearable:"",modelValue:o(p).username,"onUpdate:modelValue":c[0]||(c[0]=i=>o(p).username=i),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(u,{label:"用户名"},{default:l(()=>[e(U,{clearable:"",modelValue:o(p).nickname,"onUpdate:modelValue":c[1]||(c[1]=i=>o(p).nickname=i),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(u,{label:"性别"},{default:l(()=>[e(V,{code:"sex",modelValue:o(p).sex,"onUpdate:modelValue":c[2]||(c[2]=i=>o(p).sex=i),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[e(u,{"label-width":"16px"},{default:l(()=>[e(w,{type:"primary",onClick:f},{default:l(()=>c[4]||(c[4]=[E("查询")])),_:1}),e(w,{onClick:d},{default:l(()=>c[5]||(c[5]=[E("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),ll=D({__name:"user-edit",props:K({data:{},organizationId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:K(["done"],["update:modelValue"]),setup(N,{emit:$}){const I=N,k=$,p=ee(N,"modelValue"),v=y(!1),f=y(!1),d=y(null),[n,c,U]=Q({userId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:"",birthday:"",organizationId:void 0,status:0}),u=ue({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(_,a,i)=>{if(v.value){i();return}Ke("username",a).then(()=>{i(new Error("账号已经存在"))}).catch(()=>{i()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"change"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"change"}],email:[{pattern:Ae,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(_,a,i)=>{if(v.value||/^[\S]{5,18}$/.test(a))return i();i(new Error("密码必须为5-18位非空白字符"))}}],phone:[{required:!0,message:"请输入手机号",type:"string",trigger:"blur"},{pattern:Xe,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),r=()=>{p.value=!1},V=()=>{var _,a;(a=(_=d.value)==null?void 0:_.validate)==null||a.call(_,i=>{if(!i)return;f.value=!0,(v.value?Oe:je)(n).then(R=>{f.value=!1,h.success(R),r(),k("done")}).catch(R=>{f.value=!1,h.error(R.message)})})},w=()=>{I.data?(U({...I.data,password:""}),v.value=!0):(c(),n.organizationId=I.organizationId,v.value=!1),O(()=>{O(()=>{var _,a;(a=(_=d.value)==null?void 0:_.clearValidate)==null||a.call(_)})})};return(_,a)=>{const i=H,z=L,R=Z,s=se,t=Te,g=pe,b=me,S=ne,q=X,F=W,P=le;return C(),B(P,{form:"",width:680,modelValue:p.value,"onUpdate:modelValue":a[12]||(a[12]=m=>p.value=m),title:v.value?"修改用户":"新建用户",onOpen:w},{footer:l(()=>[e(F,{onClick:r},{default:l(()=>a[13]||(a[13]=[E("取消")])),_:1}),e(F,{type:"primary",loading:f.value,onClick:V},{default:l(()=>a[14]||(a[14]=[E(" 保存 ")])),_:1},8,["loading"])]),default:l(()=>[e(q,{ref_key:"formRef",ref:d,model:o(n),rules:u,"label-width":"80px",onSubmit:a[11]||(a[11]=A(()=>{},["prevent"]))},{default:l(()=>[e(S,{gutter:16},{default:l(()=>[e(s,{sm:12,xs:24},{default:l(()=>[e(i,{label:"所属机构"},{default:l(()=>[e(Pe,{modelValue:o(n).organizationId,"onUpdate:modelValue":a[0]||(a[0]=m=>o(n).organizationId=m)},null,8,["modelValue"])]),_:1}),e(i,{label:"用户账号",prop:"username"},{default:l(()=>[e(z,{clearable:"",maxlength:20,modelValue:o(n).username,"onUpdate:modelValue":a[1]||(a[1]=m=>o(n).username=m),placeholder:"请输入用户账号",disabled:v.value},null,8,["modelValue","disabled"])]),_:1}),e(i,{label:"用户名",prop:"nickname"},{default:l(()=>[e(z,{clearable:"",maxlength:20,modelValue:o(n).nickname,"onUpdate:modelValue":a[2]||(a[2]=m=>o(n).nickname=m),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(i,{label:"性别",prop:"sex"},{default:l(()=>[e(R,{code:"sex",modelValue:o(n).sex,"onUpdate:modelValue":a[3]||(a[3]=m=>o(n).sex=m),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),e(i,{label:"角色",prop:"roles"},{default:l(()=>[e(qe,{modelValue:o(n).roles,"onUpdate:modelValue":a[4]||(a[4]=m=>o(n).roles=m)},null,8,["modelValue"])]),_:1}),e(i,{label:"邮箱",prop:"email"},{default:l(()=>[e(z,{clearable:"",maxlength:100,modelValue:o(n).email,"onUpdate:modelValue":a[5]||(a[5]=m=>o(n).email=m),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{sm:12,xs:24},{default:l(()=>[e(i,{label:"手机号",prop:"phone"},{default:l(()=>[e(z,{clearable:"",maxlength:11,modelValue:o(n).phone,"onUpdate:modelValue":a[6]||(a[6]=m=>o(n).phone=m),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(i,{label:"出生日期"},{default:l(()=>[e(t,{modelValue:o(n).birthday,"onUpdate:modelValue":a[7]||(a[7]=m=>o(n).birthday=m),"value-format":"YYYY-MM-DD",placeholder:"请选择出生日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),v.value?te("",!0):(C(),B(i,{key:0,label:"登录密码",prop:"password"},{default:l(()=>[e(z,{"show-password":"",type:"password",maxlength:20,modelValue:o(n).password,"onUpdate:modelValue":a[8]||(a[8]=m=>o(n).password=m),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),e(i,{label:"状态"},{default:l(()=>[e(b,{modelValue:o(n).status,"onUpdate:modelValue":a[9]||(a[9]=m=>o(n).status=m)},{default:l(()=>[e(g,{value:0,label:"正常"}),e(g,{value:1,label:"冻结"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"个人简介"},{default:l(()=>[e(z,{type:"textarea",rows:3,maxlength:200,modelValue:o(n).introduction,"onUpdate:modelValue":a[10]||(a[10]=m=>o(n).introduction=m),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),tl={class:"user-import-upload"},al={style:{display:"flex","align-items":"center","justify-content":"center"}},ol=D({__name:"user-import",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:K(["done"],["update:modelValue"]),setup(N,{emit:$}){const I=$,k=ee(N,"modelValue"),p=y(!1),v=f=>["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(f.type)?f.size/1024/1024>10?(h.error("大小不能超过 10MB"),!1):(p.value=!0,Le(f).then(d=>{p.value=!1,h.success(d),k.value=!1,I("done")}).catch(d=>{p.value=!1,h.error(d.message)}),!1):(h.error("只能选择 excel 文件"),!1);return(f,d)=>{const n=fe,c=He,U=ae,u=le,r=Se;return C(),B(u,{width:460,title:"导入用户",modelValue:k.value,"onUpdate:modelValue":d[0]||(d[0]=V=>k.value=V)},{default:l(()=>[ce((C(),j("div",tl,[e(c,{drag:"",action:"",accept:".xls,.xlsx","show-file-list":!1,"before-upload":v},{default:l(()=>[e(n,{type:"primary",icon:o(_e),"icon-props":{size:52},style:{"margin-bottom":"10px"}},null,8,["icon"]),e(n,{type:"placeholder"},{default:l(()=>d[1]||(d[1]=[E("将文件拖到此处, 或点击上传")])),_:1})]),_:1})])),[[r,p.value]]),T("div",al,[d[3]||(d[3]=T("span",{style:{"padding-right":"8px"}},"只能上传 xls、xlsx 文件,",-1)),e(U,{type:"primary",underline:!1,href:"https://cdn.eleadmin.com/20200610/用户导入模板.xlsx",download:"用户导入模板.xlsx"},{default:l(()=>d[2]||(d[2]=[E(" 下载模板 ")])),_:1})])]),_:1},8,["modelValue"])}}}),nl=ge(ol,[["__scopeId","data-v-1e636363"]]),sl=D({__name:"user-list",props:{organizationId:{}},setup(N){const $=N,{push:I}=ve(),{addPageTab:k}=be(),p=y(null),v=y(null),f=y([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110,slot:"nickname"},{prop:"sexName",label:"性别",sortable:"custom",width:90,align:"center"},{columnKey:"roles",label:"角色",minWidth:110,slot:"roles",align:"center",formatter:s=>s.roles.map(t=>t.roleName).join(",")},{prop:"createTime",label:"创建时间",sortable:"custom",width:180,align:"center"},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status",formatter:s=>s.status==0?"正常":"冻结"},{columnKey:"action",label:"操作",width:128,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),d=y([]),n=y(null),c=y(!1),U=y(!1),u=({pages:s,where:t,orders:g})=>We({...t,...g,...s,organizationId:$.organizationId}),r=s=>{var t,g;d.value=[],(g=(t=v.value)==null?void 0:t.reload)==null||g.call(t,{page:1,where:s})},V=s=>{n.value=s!=null?s:null,c.value=!0},w=()=>{U.value=!0},_=s=>{const t=s==null?d.value:[s];if(!t.length){h.error("请至少选择一条数据");return}J.confirm("确定要删除“"+t.map(g=>g.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const g=h.loading({message:"请求中..",plain:!0});Ye(t.map(b=>b.userId)).then(b=>{g.close(),h.success(b),r()}).catch(b=>{g.close(),h.error(b.message)})}).catch(()=>{})},a=(s,t)=>{const g=s?0:1;Ge(t.userId,g).then(b=>{t.status=g,h.success(b)}).catch(b=>{h.error(b.message)})},i=(s,t)=>{s==="password"?J.prompt(`请输入用户"${t.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:g})=>{const b=h.loading({message:"请求中..",plain:!0});Je(t.userId,g).then(S=>{b.close(),h.success(S)}).catch(S=>{b.close(),h.error(S.message)})}).catch(()=>{}):s==="delete"&&_(t)};oe(()=>$.organizationId,()=>{var s,t;(t=(s=p.value)==null?void 0:s.resetFields)==null||t.call(s),r({})});const z=({where:s,orders:t})=>Qe({...s,...t,organizationId:$.organizationId}),R=s=>{const t=`/system/user/details/${s.userId}`;k({title:`用户详情[${s.nickname}]`,key:t,closable:!0,meta:{icon:"UserOutlined"}}),I(t)};return(s,t)=>{const g=W,b=ae,S=Ie,q=ke,F=xe,P=Ve,m=ye,re=Fe;return C(),j(Y,null,[e(el,{ref_key:"searchRef",ref:p,style:{"margin-bottom":"-14px"},onSearch:r},null,512),e(re,{ref_key:"tableRef",ref:v,"row-key":"userId",columns:f.value,datasource:u,"show-overflow-tooltip":!0,selections:d.value,"onUpdate:selections":t[2]||(t[2]=x=>d.value=x),"highlight-current-row":!0,"export-config":{fileName:"用户数据",datasource:z},"print-config":{datasource:z},style:{paddingBottom:"16px"},"cache-key":"systemUserTable"},{toolbar:l(()=>[e(g,{type:"primary",class:"ele-btn-icon",icon:o(Ue),onClick:t[0]||(t[0]=x=>V())},{default:l(()=>t[5]||(t[5]=[E(" 新建 ")])),_:1},8,["icon"]),e(g,{type:"danger",class:"ele-btn-icon",icon:o(ze),onClick:t[1]||(t[1]=x=>_())},{default:l(()=>t[6]||(t[6]=[E(" 删除 ")])),_:1},8,["icon"]),e(g,{class:"ele-btn-icon",icon:o(Ee),onClick:w},{default:l(()=>t[7]||(t[7]=[E(" 导入 ")])),_:1},8,["icon"])]),nickname:l(({row:x})=>[e(b,{type:"primary",underline:!1,onClick:M=>R(x)},{default:l(()=>[E(G(x.nickname),1)]),_:2},1032,["onClick"])]),roles:l(({row:x})=>[(C(!0),j(Y,null,we(x.roles,M=>(C(),B(S,{key:M.roleId,size:"small","disable-transitions":!0},{default:l(()=>[E(G(M.roleName),1)]),_:2},1024))),128))]),status:l(({row:x})=>[e(q,{size:"small","model-value":x.status===0,onChange:M=>a(M,x)},null,8,["model-value","onChange"])]),action:l(({row:x})=>[e(b,{type:"primary",underline:!1,onClick:M=>V(x)},{default:l(()=>t[8]||(t[8]=[E(" 修改 ")])),_:2},1032,["onClick"]),e(F,{direction:"vertical"}),e(m,{items:[{title:"重置密码",command:"password"},{title:"删除用户",command:"delete",danger:!0,divided:!0}],style:{display:"inline"},onCommand:M=>i(M,x)},{default:l(()=>[e(b,{type:"primary",underline:!1},{default:l(()=>[t[9]||(t[9]=T("span",null,"更多",-1)),e(P,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:l(()=>[e(o(he))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1},8,["columns","selections","export-config","print-config"]),e(ll,{data:n.value,modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=x=>c.value=x),"organization-id":s.organizationId,onDone:r},null,8,["data","modelValue","organization-id"]),e(nl,{modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=x=>U.value=x),onDone:r},null,8,["modelValue"])],64)}}}),rl={style:{padding:"0 16px 12px 0"}},Bl=D({name:"SystemUser",__name:"index",setup(N){const{mobile:$}=$e(),I=y(null),k=y(null),p=y(!0),v=y([]),f=y(null),d=y(""),n=()=>{p.value=!0,Ze().then(u=>{p.value=!1,v.value=Re({data:u,idField:"organizationId",parentIdField:"parentId"}),O(()=>{c(v.value[0])})}).catch(u=>{p.value=!1,h.error(u.message)})},c=u=>{var r,V,w,_;f.value!=null&&$.value&&((V=(r=I.value)==null?void 0:r.toggleCollapse)==null||V.call(r,!0)),u&&u.organizationId?(f.value=u,(_=(w=k.value)==null?void 0:w.setCurrentKey)==null||_.call(w,u.organizationId)):f.value=null},U=(u,r)=>u?!!(r.organizationName&&r.organizationName.includes(u)):!0;return oe(d,u=>{var r,V;(V=(r=k.value)==null?void 0:r.filter)==null||V.call(r,u)}),n(),(u,r)=>{const V=L,w=De,_=Be,a=Me,i=Ne,z=ie;return C(),B(z,{"flex-table":"","multi-card":!1,"hide-footer":"",style:{"min-height":"420px"}},{default:l(()=>[e(i,{"flex-table":"","body-style":{padding:"0 0 0 16px",overflow:"hidden"}},{default:l(()=>[e(a,{ref_key:"splitRef",ref:I,"flex-table":"",size:"256px","allow-collapse":"","custom-style":{borderWidth:"0 1px 0 0",padding:"16px 0"},"body-style":{padding:"16px 16px 0 0",overflow:"hidden"},style:{height:"100%",overflow:"visible"}},{body:l(()=>[f.value&&f.value.organizationId?(C(),B(sl,{key:0,"organization-id":f.value.organizationId},null,8,["organization-id"])):te("",!0)]),default:l(()=>[T("div",rl,[e(V,{clearable:"",maxlength:20,modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=R=>d.value=R),placeholder:"输入机构名称搜索","prefix-icon":o(Ce)},null,8,["modelValue","prefix-icon"])]),e(_,{loading:p.value,style:{flex:1,paddingRight:"16px",overflow:"auto"}},{default:l(()=>[e(w,{ref_key:"treeRef",ref:k,data:v.value,"highlight-current":"","node-key":"organizationId",props:{label:"organizationName"},"expand-on-click-node":!1,"default-expand-all":!0,"filter-node-method":U,style:{"--ele-tree-item-height":"34px"},onNodeClick:c},null,8,["data"])]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1})}}});export{Bl as default};
