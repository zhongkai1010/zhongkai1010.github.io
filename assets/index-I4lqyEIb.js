import{_ as re}from"./index-DWvwq9vJ.js";import{d as S,a$ as B,b0 as z,r as u,b1 as H,a as Q,c as U,o as x,aC as G,w as i,b as r,aO as X,aN as Y,u as C,aI as Z,aK as J,aD as W,h as E,m as b,p as R,b2 as ie,b3 as de,e as $,au as ee,b4 as ce,E as ue,b5 as me,b6 as pe,F as P,aF as oe,n as L,a5 as N,_ as fe,a6 as j,b7 as K,q as _e,t as q,aR as ve,aG as ge,b8 as ye,a7 as be,aE as he,b9 as O,at as Ve,ax as ke,ba as A}from"./index-CrqWW_BJ.js";import{_ as Ie}from"./index-CvmJHak0.js";import{_ as te}from"./index-Bp1QOJoN.js";import{_ as xe}from"./index-D6CwktmT.js";import{E as Ce}from"./upload-8Foq0W5z.js";import"./progress-Bi25YwRJ.js";import{u as we}from"./index-BCy7AkVf.js";import{a as le,_ as $e,r as Fe,u as ae,b as De,l as ne,c as Ue,d as Ee,e as Se,f as Be}from"./index.vue_vue_type_style_index_0_lang-Dy2NhK0H.js";import{_ as Me}from"./index-Cdv7qJv9.js";import{E as Te}from"./tree-B4uLK92a.js";import"./index-m0vNeDuu.js";import"./index-CEM6Hg_V.js";import"./index-Hp0cvjp7.js";import"./vuedraggable.umd-gs1jzkQf.js";import"./tree-select-s_mGcoXC.js";import"./message-box-CntH5Fk1.js";import"./throttle-e7cDqVe4.js";const Oe=S({__name:"folder-edit",props:B({parentId:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:B(["done"],["update:modelValue"]),setup(w,{emit:I}){const d=w,v=I,p=z(w,"modelValue"),m=u(null),c=u(!1),[s,_]=H({name:""}),f=Q({name:[{required:!0,message:"请输入文件夹名称",type:"string",trigger:"blur"}]}),g=()=>{p.value=!1},h=()=>{var y,t;(t=(y=m.value)==null?void 0:y.validate)==null||t.call(y,e=>{e&&(c.value=!0,le({...s,parentId:d.parentId,isDirectory:1}).then(o=>{c.value=!1,b.success(o),g(),v("done")}).catch(o=>{c.value=!1,b.error(o.message)}))})},F=()=>{var y,t;_(),(t=(y=m.value)==null?void 0:y.clearValidate)==null||t.call(y)};return(y,t)=>{const e=J,o=Z,n=X,V=W,D=G;return x(),U(D,{form:"",width:460,title:"新建文件夹",modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=l=>p.value=l),onClosed:F},{footer:i(()=>[r(V,{onClick:g},{default:i(()=>t[3]||(t[3]=[E("取消")])),_:1}),r(V,{type:"primary",loading:c.value,onClick:h},{default:i(()=>t[4]||(t[4]=[E(" 保存 ")])),_:1},8,["loading"])]),default:i(()=>[r(n,{ref_key:"formRef",ref:m,model:C(s),rules:f,"label-width":"100px",onSubmit:t[1]||(t[1]=Y(()=>{},["prevent"]))},{default:i(()=>[r(o,{label:"文件夹名称",prop:"name"},{default:i(()=>[r(e,{clearable:"",maxlength:20,modelValue:C(s).name,"onUpdate:modelValue":t[0]||(t[0]=l=>C(s).name=l),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),Ne={style:{"max-width":"240px"},class:"hidden-sm-and-down"},Re=S({__name:"file-toolbar",props:{grid:{type:Boolean},selections:{},parentId:{}},emits:["update:grid","done"],setup(w,{emit:I}){const d=w,v=I,p=u(""),m=u(!1),c=t=>{if(t.size/1024/1024>100)return b.error("大小不能超过 100MB"),!1;const e=b.loading({message:"上传中..",plain:!0});return we(t).then(o=>{le({name:o.name,isDirectory:0,parentId:d.parentId,path:o.path,length:o.length,contentType:o.contentType}).then(()=>{e.close(),b.success("上传成功"),f()}).catch(n=>{e.close(),b.error(n.message)})}).catch(o=>{e.close(),b.error(o.message)}),!1},s=()=>{m.value=!0},_=()=>{const t=d.selections;oe.confirm("确定要删除“"+t.map(e=>e.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const e=b.loading({message:"请求中..",plain:!0});Fe(t.map(o=>o.id)).then(o=>{e.close(),b.success(o),f()}).catch(o=>{e.close(),b.error(o.message)})}).catch(()=>{})},f=()=>{v("done")},g=()=>{v("update:grid",!d.grid)},h=u(!1),F=()=>{h.value=!0},y=t=>{h.value=!1,t.length&&(console.log(JSON.parse(JSON.stringify(t))),b.success(t.length+"条数据已打印在控制台"))};return(t,e)=>{const o=W,n=Ce,V=J,D=ue,l=xe;return x(),R(P,null,[r(l,{theme:"plain",class:"demo-file-toolbar"},{tools:i(()=>[$("div",Ne,[r(V,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),placeholder:"搜索您的文件","prefix-icon":C(ce)},null,8,["modelValue","prefix-icon"])]),r(D,{class:"demo-file-tool",onClick:g},{default:i(()=>[t.grid?(x(),U(C(me),{key:0})):(x(),U(C(pe),{key:1}))]),_:1})]),default:i(()=>[r(n,{action:"","show-file-list":!1,"before-upload":c,style:{display:"inline-block","vertical-align":"middle"}},{default:i(()=>[r(o,{type:"primary",class:"ele-btn-icon",icon:C(ie)},{default:i(()=>e[3]||(e[3]=[E(" 上传 ")])),_:1},8,["icon"])]),_:1}),r(o,{class:"ele-btn-icon",icon:C(de),style:{"margin-left":"12px"},onClick:s},{default:i(()=>e[4]||(e[4]=[$("span",null,"新建",-1),$("span",{class:"hidden-sm-and-down"},"文件夹",-1)])),_:1},8,["icon"]),r(o,{plain:"",type:"danger",icon:C(ee),disabled:!t.selections.length,class:"ele-btn-icon hidden-xs-only",onClick:_},{default:i(()=>e[5]||(e[5]=[E(" 删除 ")])),_:1},8,["icon","disabled"]),r(o,{class:"ele-btn-icon",style:{"margin-left":"12px"},onClick:F},{default:i(()=>e[6]||(e[6]=[$("span",{class:"hidden-sm-and-down"},"打开",-1),$("span",null,"文件选择",-1)])),_:1})]),_:1}),r(Oe,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),"parent-id":t.parentId,onDone:f},null,8,["modelValue","parent-id"]),r($e,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=a=>h.value=a),onDone:y},null,8,["modelValue"])],64)}}}),We=L(Re,[["__scopeId","data-v-4a3cef06"]]),Le={class:"demo-breadcrumb"},je={class:"demo-breadcrumb-body"},qe={class:"demo-breadcrumb-list"},ze=["onClick"],Ge={class:"hidden-xs-only"},Je=S({__name:"file-header",props:{directorys:{},total:{}},emits:["update:directorys"],setup(w,{emit:I}){const d=w,v=I,p=()=>{v("update:directorys",d.directorys.slice(0,d.directorys.length-1))},m=()=>{d.directorys.length&&v("update:directorys",[])},c=s=>{s!==d.directorys.length-1&&v("update:directorys",d.directorys.slice(0,s+1))};return(s,_)=>{const f=fe;return x(),R("div",Le,[$("div",je,[s.directorys.length?(x(),U(f,{key:0,type:"primary",class:"demo-breadcrumb-back",onClick:p},{default:i(()=>_[0]||(_[0]=[E(" 返回上一级 ")])),_:1})):N("",!0),$("div",qe,[r(f,{type:s.directorys.length?"primary":void 0,class:"demo-breadcrumb-item"},{default:i(()=>[$("div",{class:j({"demo-breadcrumb-link":!!s.directorys.length}),onClick:m}," 全部文件 ",2),s.directorys.length?(x(),U(f,{key:0,icon:C(K),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):N("",!0)]),_:1},8,["type"]),(x(!0),R(P,null,_e(s.directorys,(g,h)=>(x(),U(f,{key:g.id,class:"demo-breadcrumb-item",type:h!==s.directorys.length-1?"primary":"default"},{default:i(()=>[$("div",{class:j({"demo-breadcrumb-link":h!==s.directorys.length-1}),onClick:F=>c(h)},q(g.name),11,ze),h!==s.directorys.length-1?(x(),U(f,{key:0,icon:C(K),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):N("",!0)]),_:2},1032,["type"]))),128))])]),$("div",Ge,"已全部加载，共 "+q(s.total)+" 个",1)])}}}),Pe=L(Je,[["__scopeId","data-v-aa7461e4"]]),Ke=S({__name:"name-edit",props:B({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:B(["done"],["update:modelValue"]),setup(w,{emit:I}){const d=w,v=I,p=z(w,"modelValue"),m=u(null),c=u(!1),[s,_]=H({name:""}),f=Q({name:[{required:!0,message:"请输入文件/夹名称",type:"string",trigger:"blur"}]}),g=()=>{p.value=!1},h=()=>{var t,e;(e=(t=m.value)==null?void 0:t.validate)==null||e.call(t,o=>{var n;o&&(c.value=!0,ae({...s,id:(n=d.data)==null?void 0:n.id}).then(V=>{c.value=!1,b.success(V),g(),v("done")}).catch(V=>{c.value=!1,b.error(V.message)}))})},F=()=>{var t,e;_(),(e=(t=m.value)==null?void 0:t.clearValidate)==null||e.call(t)},y=()=>{d.data&&(s.name=d.data.name)};return(t,e)=>{const o=J,n=Z,V=X,D=W,l=G;return x(),U(l,{form:"",width:460,title:"重命名",modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=a=>p.value=a),onOpen:y,onClosed:F},{footer:i(()=>[r(D,{onClick:g},{default:i(()=>e[3]||(e[3]=[E("取消")])),_:1}),r(D,{type:"primary",loading:c.value,onClick:h},{default:i(()=>e[4]||(e[4]=[E(" 保存 ")])),_:1},8,["loading"])]),default:i(()=>[r(V,{ref_key:"formRef",ref:m,model:C(s),rules:f,"label-width":"100px",onSubmit:e[1]||(e[1]=Y(()=>{},["prevent"]))},{default:i(()=>[r(n,{label:"文件/夹名称",prop:"name"},{default:i(()=>[r(o,{clearable:"",maxlength:20,modelValue:C(s).name,"onUpdate:modelValue":e[0]||(e[0]=a=>C(s).name=a),placeholder:"请输入文件/夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),Ae={class:"demo-file-move-tree"},He=S({__name:"file-move",props:B({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:B(["done"],["update:modelValue"]),setup(w,{emit:I}){const d=w,v=I,p=z(w,"modelValue"),m=u(!1),c=u(),s=u([]),_=u(!1),f=t=>{c.value=t.id},g=()=>{p.value=!1},h=()=>{var e;const t=c.value;if(t==null){b.error("请选择分组");return}m.value=!0,ae({id:(e=d.data)==null?void 0:e.id,parentId:t}).then(o=>{m.value=!1,b.success(o),g(),v("done")}).catch(o=>{m.value=!1,b.error(o.message)})},F=()=>{_.value=!0,ne({isDirectory:1}).then(t=>{const e=[{id:0,name:"未分组"},...ge(ye({data:t,idField:"id",parentIdField:"parentId"}),o=>{var n;return o.id===((n=d.data)==null?void 0:n.id)?void 0:o})];s.value=e,_.value=!1}).catch(t=>{s.value=[],b.error(t.message),_.value=!1})},y=()=>{F(),d.data&&(c.value=d.data.parentId)};return(t,e)=>{const o=ve,n=Te,V=te,D=W,l=G;return x(),U(l,{width:460,title:"移动到",modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),onOpen:y},{footer:i(()=>[r(D,{onClick:g},{default:i(()=>e[2]||(e[2]=[E("取消")])),_:1}),r(D,{type:"primary",loading:m.value,onClick:h},{default:i(()=>e[3]||(e[3]=[E(" 保存 ")])),_:1},8,["loading"])]),default:i(()=>[$("div",Ae,[r(n,{data:s.value,nodeKey:"id",props:{label:"name"},"expand-on-click-node":!1,"default-expand-all":!0,onNodeClick:f},{default:i(a=>[e[1]||(e[1]=$("img",{src:De,style:{width:"18px",height:"18px","margin-right":"6px"}},null,-1)),$("span",{class:j(["el-tree-node__label",{"is-active":a.data.id===c.value}])},q(a.data.name),3),r(o,{value:!0,"model-value":a.data.id===c.value},null,8,["model-value"])]),_:1},8,["data"])]),_.value?(x(),U(V,{key:0,loading:_.value,style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"var(--el-border-radius-base)",overflow:"hidden"}},null,8,["loading"])):N("",!0)]),_:1},8,["modelValue"])}}}),Qe=L(He,[["__scopeId","data-v-fc6be7ac"]]),Xe={class:"demo-file-list"},Ye={key:0,class:"demo-file-list-empty"},Ze=S({__name:"file-list",props:{parentId:{},data:{},sort:{},order:{},selections:{},grid:{type:Boolean}},emits:["sort-change","update:selections","go-directory","done"],setup(w,{emit:I}){const d=w,v=I,p=u(!1),m=u(),c=u(!1),s=u(),_=u(!1),f=u([]),g=u(0),h=l=>{v("sort-change",l)},F=l=>{v("update:selections",l)},y=l=>{console.log("onItemClick:",JSON.parse(JSON.stringify(l))),l.isDirectory?v("go-directory",l):n(l)?V(l):F(d.selections.includes(l)?d.selections.filter(a=>a!==l):[...d.selections,l])},t=l=>{const{key:a,item:k}=l;a==="open"?k.isDirectory||n(k)?y(k):window.open(k.url):a==="download"?typeof k.downloadUrl=="string"&&window.open(k.downloadUrl):a==="edit"?(m.value=k,p.value=!0):a==="remove"?e(k):a==="move"&&(s.value=k,c.value=!0)},e=l=>{oe.confirm(`确定要删除“${l.name}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const a=b.loading({message:"请求中..",plain:!0});Be(l.id).then(k=>{a.close(),b.success(k),o()}).catch(k=>{a.close(),b.error(k.message)})}).catch(()=>{})},o=()=>{v("done")},n=l=>typeof l.contentType=="string"&&l.contentType.startsWith("image/")&&l.url,V=l=>{const a=d.data.filter(M=>n(M)),k=a.indexOf(l);k!==-1&&(f.value=a.map(M=>M.url),g.value=k,_.value=!0)},D=l=>{if(!l)return[];const a=[{title:"重命名",command:"edit",icon:O(Ve),divided:!0},{title:"移动到",command:"move",icon:O(ke)},{title:"删除",command:"remove",icon:O(ee),divided:!0,danger:!0}];return l.isDirectory?a.unshift({title:"打开",command:"open"}):n(l)||typeof l.contentType=="string"&&(l.contentType.startsWith("video/")||l.contentType.startsWith("text/")||l.contentType.startsWith("application/pdf")||l.contentType.startsWith("application/json")||l.contentType.startsWith("application/javascript"))?(a[0].divided=!1,a.unshift({title:"下载",command:"download",icon:O(A),divided:!0}),a.unshift({title:"预览",command:"open"})):a.unshift({title:"下载",command:"download",icon:O(A)}),a};return(l,a)=>{const k=Se,M=he,se=Me;return x(),R(P,null,[$("div",Xe,[r(k,{data:l.data,grid:l.grid,sort:l.sort,order:l.order,sortable:!0,"box-choose":!0,"selection-type":"checkbox",selections:l.selections,"context-menus":D,"context-menu-props":{menuStyle:{minWidth:"120px"},iconProps:{size:15},popperOptions:{strategy:"fixed"}},icons:C(Ee),"small-icons":C(Ue),style:be({minHeight:"400px",minWidth:l.grid?"auto":"456px"}),onItemClick:y,onSortChange:h,"onUpdate:selections":F,onItemContextMenu:t},null,8,["data","grid","sort","order","selections","icons","small-icons","style"]),l.data.length?N("",!0):(x(),R("div",Ye,[r(M,{description:"无数据","image-size":80})]))]),r(se,{modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=T=>_.value=T),urlList:f.value,initialIndex:g.value,infinite:!1,"hide-on-click-modal":!0},null,8,["modelValue","urlList","initialIndex"]),r(Ke,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=T=>p.value=T),data:m.value,onDone:o},null,8,["modelValue","data"]),r(Qe,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=T=>c.value=T),data:s.value,onDone:o},null,8,["modelValue","data"])],64)}}}),eo=L(Ze,[["__scopeId","data-v-8390a67e"]]),oo={style:{padding:"8px 16px"}},Vo=S({name:"ExtensionFile",__name:"index",setup(w){const I=u(!0),d=u([]),v=u(""),p=u(""),m=u([]),c=u([]),s=u(0),_=u(!0),f=u(0),g=()=>{d.value=[],m.value=[],I.value=!0,ne({sort:p.value?v.value:"",order:p.value,parentId:f.value}).then(o=>{I.value=!1,d.value=o.map(n=>Object.assign(n,{key:n.id,isDirectory:n.isDirectory===1,length:e(n.length)})),s.value=o.length}).catch(o=>{I.value=!1,b.error(o.message)})},h=()=>{g()},F=o=>{var n;p.value=(n=o.order)!=null?n:"",v.value=o.sort,g()},y=o=>{t([...c.value,o])},t=o=>{var n,V;c.value=o,f.value=(V=(n=c.value[c.value.length-1])==null?void 0:n.id)!=null?V:0,g()},e=o=>o==null?"-":o<1024?o+"B":o<1024*1024?(o/1024).toFixed(1)+"KB":o<1024*1024*1024?(o/1024/1024).toFixed(1)+"M":(o/1024/1024/1024).toFixed(1)+"G";return g(),(o,n)=>{const V=te,D=Ie,l=re;return x(),U(l,{"multi-card":!1},{default:i(()=>[r(D,{"body-style":{padding:0}},{default:i(()=>[$("div",oo,[r(We,{grid:_.value,"onUpdate:grid":n[0]||(n[0]=a=>_.value=a),selections:m.value,parentId:f.value,onDone:h},null,8,["grid","selections","parentId"]),r(Pe,{total:s.value,directorys:c.value,"onUpdate:directorys":t},null,8,["total","directorys"])]),r(V,{loading:I.value},{default:i(()=>[r(eo,{grid:_.value,data:d.value,sort:v.value,order:p.value,parentId:f.value,selections:m.value,"onUpdate:selections":n[1]||(n[1]=a=>m.value=a),onSortChange:F,onGoDirectory:y,onDone:h},null,8,["grid","data","sort","order","parentId","selections"])]),_:1},8,["loading"])]),_:1})]),_:1})}}});export{Vo as default};
