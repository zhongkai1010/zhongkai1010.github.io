import{d as I,aQ as T,aP as B,r as g,b1 as M,a as N,R as Y,c as _,o as v,w as n,b as l,a5 as O,aI as $,aK as K,u as r,cB as S,aD as Q,h as x,aN as j,aO as z,m as y}from"./index-BZ7jWUbG.js";import{E as A}from"./date-picker-CMoOyU9F.js";import{_ as G}from"./role-select.vue_vue_type_script_setup_true_lang-CDKhMmOy.js";import{c as H,u as J,a as L}from"./index-D3_IVDYR.js";import{p as W,e as X}from"./validate-B_6HX0Io.js";const te=I({__name:"edit-form",props:{data:{}},setup(w){const p=w,{push:h}=T(),{routeTabKey:V,removePageTab:c,reloadPageTab:U}=B(),d=g(!1),i=g(!1),f=g(null),[a,k,E]=M({userId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),C=N({username:[{required:!0,type:"string",trigger:"blur",validator:(u,e,o)=>{var s;if(!e)return o(new Error("请输入用户账号"));H("username",e,(s=p.data)==null?void 0:s.userId).then(()=>{o(new Error("账号已经存在"))}).catch(()=>{o()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"change"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"change"}],email:[{pattern:X,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,type:"string",trigger:"blur",validator:(u,e,o)=>{if(d.value||/^[\S]{5,18}$/.test(e))return o();o(new Error("密码必须为5-18位非空白字符"))}}],phone:[{pattern:W,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),D=()=>{var u,e;(e=(u=f.value)==null?void 0:u.validate)==null||e.call(u,o=>{if(!o)return;i.value=!0,(d.value?J:L)(a).then(m=>{i.value=!1,y.success(m),R()}).catch(m=>{i.value=!1,y.error(m.message)})})},P=()=>{c({key:V}),h("/list/basic")},R=()=>{c({key:V}),U({fullPath:"/list/basic"})};return Y(()=>p.data,()=>{var u,e;p.data?(E({...p.data,password:""}),d.value=!0):(d.value=!1,k(),(e=(u=f.value)==null?void 0:u.clearValidate)==null||e.call(u))},{immediate:!0}),(u,e)=>{const o=K,s=$,m=S,q=A,b=Q,F=z;return v(),_(F,{ref_key:"formRef",ref:f,model:r(a),rules:C,"label-width":"80px",style:{"max-width":"600px",margin:"10px auto"},onSubmit:e[9]||(e[9]=j(()=>{},["prevent"]))},{default:n(()=>[l(s,{label:"用户账号",prop:"username"},{default:n(()=>[l(o,{clearable:"",maxlength:20,modelValue:r(a).username,"onUpdate:modelValue":e[0]||(e[0]=t=>r(a).username=t),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),l(s,{label:"用户名",prop:"nickname"},{default:n(()=>[l(o,{clearable:"",maxlength:20,modelValue:r(a).nickname,"onUpdate:modelValue":e[1]||(e[1]=t=>r(a).nickname=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(s,{label:"性别",prop:"sex"},{default:n(()=>[l(m,{code:"sex",modelValue:r(a).sex,"onUpdate:modelValue":e[2]||(e[2]=t=>r(a).sex=t),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),l(s,{label:"角色",prop:"roles"},{default:n(()=>[l(G,{modelValue:r(a).roles,"onUpdate:modelValue":e[3]||(e[3]=t=>r(a).roles=t)},null,8,["modelValue"])]),_:1}),l(s,{label:"邮箱",prop:"email"},{default:n(()=>[l(o,{clearable:"",maxlength:100,modelValue:r(a).email,"onUpdate:modelValue":e[4]||(e[4]=t=>r(a).email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(s,{label:"手机号",prop:"phone"},{default:n(()=>[l(o,{clearable:"",maxlength:11,modelValue:r(a).phone,"onUpdate:modelValue":e[5]||(e[5]=t=>r(a).phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(s,{label:"出生日期"},{default:n(()=>[l(q,{modelValue:r(a).birthday,"onUpdate:modelValue":e[6]||(e[6]=t=>r(a).birthday=t),"value-format":"YYYY-MM-DD",placeholder:"请选择出生日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),d.value?O("",!0):(v(),_(s,{key:0,label:"登录密码",prop:"password"},{default:n(()=>[l(o,{"show-password":"",type:"password",maxlength:20,modelValue:r(a).password,"onUpdate:modelValue":e[7]||(e[7]=t=>r(a).password=t),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),l(s,{label:"个人简介"},{default:n(()=>[l(o,{type:"textarea",rows:4,modelValue:r(a).introduction,"onUpdate:modelValue":e[8]||(e[8]=t=>r(a).introduction=t),maxlength:200,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1}),l(s,null,{default:n(()=>[l(b,{onClick:P},{default:n(()=>e[10]||(e[10]=[x("关闭")])),_:1}),l(b,{type:"primary",loading:i.value,onClick:D},{default:n(()=>e[11]||(e[11]=[x(" 保存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}});export{te as _};
