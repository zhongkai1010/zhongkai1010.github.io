import{_ as L}from"./index-CXupB9Mu.js";import{d as U,b1 as D,c as $,o as w,w as a,b as t,aI as O,aK as S,u as v,aD as M,h as y,aN as K,dc as j,aO as q,a$ as F,b0 as H,r as _,a as z,aC as W,m as R,U as B,e as T,a5 as P,E as G,a8 as J,t as Q,b8 as X,eg as Y,ay as Z,k as ee,bR as le,au as te,aF as oe}from"./index-DuSeLP2O.js";import{_ as A}from"./index-BKdEAPQW.js";import{_ as ae}from"./index-VIHKlQnV.js";import"./index-BzkfvoRI.js";import{_ as ne}from"./index-Oupfp0tU.js";import"./index-BgvxhPgN.js";import"./virtual-list-CRnh5OqY.js";import"./index-DevatPPZ.js";import"./index-CL4AVeLh.js";import{E as se,a as re}from"./col-DPin1CZR.js";import{u as de,a as ue,b as ie,c as me,p as pe,r as ce,l as fe}from"./index-om60dLmC.js";import{E as _e}from"./tree-vKRw4LZ_.js";import"./isArrayLikeObject-D8-JhZDJ.js";import"./vuedraggable.umd-rVDiD-f6.js";const ve=U({__name:"role-search",emits:["search"],setup(I,{emit:b}){const x=b,[u,m]=D({roleName:"",roleCode:"",comments:""}),r=()=>{x("search",{...u})},p=()=>{m(),r()};return(k,s)=>{const V=S,E=O,h=re,c=M,o=se,e=q,n=A;return w(),$(n,{"body-style":{paddingBottom:"2px"}},{default:a(()=>[t(e,{"label-width":"72px",onKeyup:j(K(r,["prevent"]),["enter"]),onSubmit:s[2]||(s[2]=K(()=>{},["prevent"]))},{default:a(()=>[t(o,{gutter:8},{default:a(()=>[t(h,{lg:6,md:8,sm:12,xs:24},{default:a(()=>[t(E,{label:"角色名称"},{default:a(()=>[t(V,{clearable:"",modelValue:v(u).roleName,"onUpdate:modelValue":s[0]||(s[0]=l=>v(u).roleName=l),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{lg:6,md:8,sm:12,xs:24},{default:a(()=>[t(E,{label:"角色标识"},{default:a(()=>[t(V,{clearable:"",modelValue:v(u).roleCode,"onUpdate:modelValue":s[1]||(s[1]=l=>v(u).roleCode=l),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(h,{lg:12,md:8,sm:24,xs:24},{default:a(()=>[t(E,{"label-width":"16px"},{default:a(()=>[t(c,{type:"primary",onClick:r},{default:a(()=>s[3]||(s[3]=[y("查询")])),_:1}),t(c,{onClick:p},{default:a(()=>s[4]||(s[4]=[y("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["onKeyup"])]),_:1})}}}),ge=U({__name:"role-edit",props:F({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:F(["done"],["update:modelValue"]),setup(I,{emit:b}){const x=I,u=b,m=H(I,"modelValue"),r=_(!1),p=_(!1),k=_(null),[s,V,E]=D({roleId:void 0,roleName:"",roleCode:"",comments:""}),h=z({roleName:[{required:!0,message:"请输入角色名称",type:"string",trigger:"blur"}],roleCode:[{required:!0,message:"请输入角色标识",type:"string",trigger:"blur"}]}),c=()=>{m.value=!1},o=()=>{var n,l;(l=(n=k.value)==null?void 0:n.validate)==null||l.call(n,f=>{if(!f)return;p.value=!0,(r.value?de:ue)(s).then(i=>{p.value=!1,R.success(i),c(),u("done")}).catch(i=>{p.value=!1,R.error(i.message)})})},e=()=>{x.data?(E(x.data),r.value=!0):(V(),r.value=!1),B(()=>{B(()=>{var n,l;(l=(n=k.value)==null?void 0:n.clearValidate)==null||l.call(n)})})};return(n,l)=>{const f=S,g=O,i=q,N=M,d=W;return w(),$(d,{form:"",width:460,modelValue:m.value,"onUpdate:modelValue":l[4]||(l[4]=C=>m.value=C),title:r.value?"修改角色":"添加角色",onOpen:e},{footer:a(()=>[t(N,{onClick:c},{default:a(()=>l[5]||(l[5]=[y("取消")])),_:1}),t(N,{type:"primary",loading:p.value,onClick:o},{default:a(()=>l[6]||(l[6]=[y(" 保存 ")])),_:1},8,["loading"])]),default:a(()=>[t(i,{ref_key:"formRef",ref:k,model:v(s),rules:h,"label-width":"80px",onSubmit:l[3]||(l[3]=K(()=>{},["prevent"]))},{default:a(()=>[t(g,{label:"角色名称",prop:"roleName"},{default:a(()=>[t(f,{clearable:"",maxlength:20,modelValue:v(s).roleName,"onUpdate:modelValue":l[0]||(l[0]=C=>v(s).roleName=C),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"角色标识",prop:"roleCode"},{default:a(()=>[t(f,{clearable:"",maxlength:20,modelValue:v(s).roleCode,"onUpdate:modelValue":l[1]||(l[1]=C=>v(s).roleCode=C),placeholder:"请输入角色标识"},null,8,["modelValue"])]),_:1}),t(g,{label:"备注"},{default:a(()=>[t(f,{rows:4,type:"textarea",modelValue:v(s).comments,"onUpdate:modelValue":l[2]||(l[2]=C=>v(s).comments=C),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),ye={style:{"vertical-align":"-2px"}},be=U({__name:"role-auth",props:F({data:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:["update:modelValue"],setup(I){const b=I,x=H(I,"modelValue"),u=_(null),m=_([]),r=_(!1),p=_(!1),k=_([]),s=()=>{m.value=[],k.value=[],b.data&&(r.value=!0,me(b.data.roleId).then(c=>{r.value=!1,m.value=X({data:c,idField:"menuId",parentIdField:"parentId"}),B(()=>{const o=[];Y(m.value,e=>{var n;e.menuId&&e.checked&&!((n=e.children)!=null&&n.length)&&o.push(e.menuId)}),k.value=o})}).catch(c=>{r.value=!1,R.error(c.message)}))},V=()=>{x.value=!1},E=()=>{var o,e,n,l,f,g,i,N;p.value=!0;const c=(i=((n=(e=(o=u.value)==null?void 0:o.getCheckedKeys)==null?void 0:e.call(o))!=null?n:[]).concat((g=(f=(l=u.value)==null?void 0:l.getHalfCheckedKeys)==null?void 0:f.call(l))!=null?g:[]))!=null?i:[];ie((N=b.data)==null?void 0:N.roleId,c).then(d=>{p.value=!1,R.success(d),V()}).catch(d=>{p.value=!1,R.error(d.message)})},h=()=>{s()};return(c,o)=>{const e=G,n=_e,l=ne,f=M,g=W;return w(),$(g,{width:460,title:"分配权限",position:"center",modelValue:x.value,"onUpdate:modelValue":o[0]||(o[0]=i=>x.value=i),"body-style":{padding:"12px 0 12px 22px"},onOpen:h},{footer:a(()=>[t(f,{onClick:V},{default:a(()=>o[1]||(o[1]=[y("取消")])),_:1}),t(f,{type:"primary",loading:p.value,onClick:E},{default:a(()=>o[2]||(o[2]=[y(" 保存 ")])),_:1},8,["loading"])]),default:a(()=>[t(l,{loading:r.value,"spinner-style":{background:"transparent"},style:{paddingRight:"20px",height:"calc(100vh - 192px)",maxHeight:"calc(100dvh - 192px)",minHeight:"100px",overflow:"auto"}},{default:a(()=>[t(n,{ref_key:"treeRef",ref:u,"show-checkbox":"",data:m.value,"node-key":"menuId","default-expand-all":!0,props:{label:"title"},"default-checked-keys":k.value,style:{"--ele-tree-item-height":"28px"}},{default:a(i=>[T("div",null,[i.data.icon?(w(),$(e,{key:0,size:16,style:{"margin-right":"6px","vertical-align":"-5px"}},{default:a(()=>[(w(),$(J(i.data.icon)))]),_:2},1024)):P("",!0),T("span",ye,Q(i.data.title),1)])]),_:1},8,["data","default-checked-keys"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])}}}),Be=U({name:"SystemRole",__name:"index",setup(I){const b=_(null),x=_([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"roleName",label:"角色名称",sortable:"custom",minWidth:120},{prop:"roleCode",label:"角色标识",sortable:"custom",minWidth:120},{prop:"comments",label:"备注",sortable:"custom",minWidth:140},{prop:"createTime",label:"创建时间",sortable:"custom",width:180,align:"center"},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),u=_([]),m=_(null),r=_(!1),p=_(!1),k=({pages:o,where:e,orders:n})=>pe({...e,...n,...o}),s=o=>{var e,n;u.value=[],(n=(e=b.value)==null?void 0:e.reload)==null||n.call(e,{page:1,where:o})},V=o=>{m.value=o!=null?o:null,r.value=!0},E=o=>{m.value=o!=null?o:null,p.value=!0},h=o=>{const e=o==null?u.value:[o];if(!e.length){R.error("请至少选择一条数据");return}oe.confirm("确定要删除“"+e.map(n=>n.roleName).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const n=R.loading({message:"请求中..",plain:!0});ce(e.map(l=>l.roleId)).then(l=>{n.close(),R.success(l),s()}).catch(l=>{n.close(),R.error(l.message)})}).catch(()=>{})},c=({where:o,orders:e})=>fe({...o,...e});return(o,e)=>{const n=M,l=Z,f=ee,g=ae,i=A,N=L;return w(),$(N,null,{default:a(()=>[t(ve,{onSearch:s}),t(i,{"body-style":{paddingTop:"8px"}},{default:a(()=>[t(g,{ref_key:"tableRef",ref:b,"row-key":"roleId",columns:x.value,datasource:k,"show-overflow-tooltip":!0,selections:u.value,"onUpdate:selections":e[2]||(e[2]=d=>u.value=d),"highlight-current-row":!0,"export-config":{fileName:"角色数据",datasource:c},"print-config":{datasource:c},"cache-key":"systemRoleTable"},{toolbar:a(()=>[t(n,{type:"primary",class:"ele-btn-icon",icon:v(le),onClick:e[0]||(e[0]=d=>V())},{default:a(()=>e[5]||(e[5]=[y(" 新建 ")])),_:1},8,["icon"]),t(n,{type:"danger",class:"ele-btn-icon",icon:v(te),onClick:e[1]||(e[1]=d=>h())},{default:a(()=>e[6]||(e[6]=[y(" 删除 ")])),_:1},8,["icon"])]),action:a(({row:d})=>[t(l,{type:"primary",underline:!1,onClick:C=>V(d)},{default:a(()=>e[7]||(e[7]=[y(" 修改 ")])),_:2},1032,["onClick"]),t(f,{direction:"vertical"}),t(l,{type:"primary",underline:!1,onClick:C=>E(d)},{default:a(()=>e[8]||(e[8]=[y(" 分配权限 ")])),_:2},1032,["onClick"]),t(f,{direction:"vertical"}),t(l,{type:"danger",underline:!1,onClick:C=>h(d)},{default:a(()=>e[9]||(e[9]=[y(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections","export-config","print-config"])]),_:1}),t(ge,{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=d=>r.value=d),data:m.value,onDone:s},null,8,["modelValue","data"]),t(be,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=d=>p.value=d),data:m.value},null,8,["modelValue","data"])]),_:1})}}});export{Be as default};
